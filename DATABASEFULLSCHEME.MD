-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.armcare_sessions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  athlete_id uuid,
  exam_date date NOT NULL,
  exam_time time without time zone,
  exam_type text,
  armcare_email text,
  armcare_first_name text,
  armcare_last_name text,
  arm_score numeric,
  total_strength numeric,
  irtarm_strength numeric,
  ertarm_strength numeric,
  starm_strength numeric,
  gtarm_strength numeric,
  shoulder_balance numeric,
  trunk_balance numeric,
  irtarm_recovery_status text,
  ertarm_recovery_status text,
  starm_recovery_status text,
  gtarm_recovery_status text,
  shoulder_recovery_status text,
  trunk_recovery_status text,
  irtarm_percent numeric,
  ertarm_percent numeric,
  starm_percent numeric,
  gtarm_percent numeric,
  upload_id uuid,
  manually_mapped boolean DEFAULT false,
  mapping_notes text,
  raw_csv_data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  gender text,
  dob date,
  height_ft integer,
  height_in integer,
  weight_lbs numeric,
  country text,
  state_prov text,
  position_1 text,
  position_2 text,
  position_3 text,
  playing_level text,
  throws text,
  bats text,
  surgery text,
  velo numeric,
  svr numeric,
  irtarm_rom numeric,
  irntarm_rom numeric,
  ertarm_rom numeric,
  erntarm_rom numeric,
  tarm_tarc numeric,
  ntarm_tarc numeric,
  ftarm_rom numeric,
  fntarm_rom numeric,
  total_strength_post numeric,
  post_strength_loss numeric,
  total_percent_fresh numeric,
  irtarm_post_strength numeric,
  irtarm_post_loss numeric,
  irtarm_percent_fresh numeric,
  ertarm_post_strength numeric,
  ertarm_post_loss numeric,
  ertarm_percent_fresh numeric,
  starm_post_strength numeric,
  starm_post_loss numeric,
  starm_percent_fresh numeric,
  gtarm_post_strength numeric,
  gtarm_post_loss numeric,
  gtarm_percent_fresh numeric,
  irtarm_max_lbs numeric,
  irntarm_max_lbs numeric,
  ertarm_max_lbs numeric,
  erntarm_max_lbs numeric,
  starm_max_lbs numeric,
  sntarm_max_lbs numeric,
  gtarm_max_lbs numeric,
  gntarm_max_lbs numeric,
  accel_max_lbs numeric,
  decel_max_lbs numeric,
  total_primer_max_lbs numeric,
  fresh_last_outing text,
  fresh_threw_today text,
  fresh_rpe integer,
  fresh_arm_feels text,
  fresh_location text,
  fresh_warmed_up text,
  post_threw_today text,
  post_throwing_activity text,
  post_throwing_time text,
  post_pitch_count integer,
  post_high_intent_throws integer,
  post_rpe integer,
  armcare_id text,
  timezone text,
  armshield_eligibility text,
  org_id uuid,
  CONSTRAINT armcare_sessions_pkey PRIMARY KEY (id),
  CONSTRAINT armcare_sessions_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.armcare_unmapped_rows (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  upload_id uuid,
  csv_email text,
  csv_first_name text,
  csv_last_name text,
  csv_exam_date date NOT NULL,
  csv_exam_time time without time zone,
  csv_row_number integer,
  raw_csv_data jsonb NOT NULL,
  status text NOT NULL DEFAULT 'pending'::text,
  mapped_to_athlete_id uuid,
  mapped_at timestamp with time zone,
  mapped_by uuid,
  mapping_notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT armcare_unmapped_rows_pkey PRIMARY KEY (id),
  CONSTRAINT armcare_unmapped_rows_upload_id_fkey FOREIGN KEY (upload_id) REFERENCES public.armcare_uploads(id),
  CONSTRAINT armcare_unmapped_rows_mapped_to_athlete_id_fkey FOREIGN KEY (mapped_to_athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT armcare_unmapped_rows_mapped_by_fkey FOREIGN KEY (mapped_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.armcare_uploads (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  uploaded_by uuid,
  filename text NOT NULL,
  file_size_bytes integer,
  total_rows integer NOT NULL DEFAULT 0,
  rows_auto_mapped integer NOT NULL DEFAULT 0,
  rows_unmapped integer NOT NULL DEFAULT 0,
  rows_duplicates integer NOT NULL DEFAULT 0,
  rows_errors integer NOT NULL DEFAULT 0,
  status text NOT NULL DEFAULT 'processing'::text,
  processing_started_at timestamp with time zone,
  processing_completed_at timestamp with time zone,
  error_message text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT armcare_uploads_pkey PRIMARY KEY (id),
  CONSTRAINT armcare_uploads_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.assessments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  org_id uuid NOT NULL,
  started_at timestamp with time zone NOT NULL DEFAULT now(),
  ended_at timestamp with time zone,
  status text NOT NULL DEFAULT 'active'::text CHECK (status = ANY (ARRAY['active'::text, 'completed'::text, 'cancelled'::text])),
  date_of_birth date,
  play_level text,
  height_inches numeric,
  wingspan_inches numeric,
  arm_length_inches numeric,
  forearm_length_inches numeric,
  thigh_length_inches numeric,
  shank_length_inches numeric,
  torso_length_inches numeric,
  throws text CHECK (throws = ANY (ARRAY['Right'::text, 'Left'::text, 'Both'::text])),
  bats text CHECK (bats = ANY (ARRAY['Right'::text, 'Left'::text, 'Both'::text])),
  weight_lbs numeric,
  cmj_test_id uuid,
  sj_test_id uuid,
  hj_test_id uuid,
  ppu_test_id uuid,
  imtp_test_id uuid,
  blast_swing_ids ARRAY DEFAULT '{}'::uuid[],
  trackman_session_id bigint,
  command_session_id uuid,
  hittrax_session_ids ARRAY DEFAULT '{}'::uuid[],
  dynamo_test_ids ARRAY DEFAULT '{}'::uuid[],
  created_by uuid,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  assessment_type text CHECK (assessment_type = ANY (ARRAY['hitting'::text, 'pitching'::text])),
  max_velo_mph numeric,
  max_exit_velo_mph numeric,
  max_distance_ft numeric,
  max_bat_speed_mph numeric,
  avg_miss_distance_inches numeric,
  avg_miss_angle_degrees numeric,
  hand_length_inches numeric,
  hand_width_inches numeric,
  CONSTRAINT assessments_pkey PRIMARY KEY (id),
  CONSTRAINT assessments_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT assessments_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT assessments_cmj_test_id_fkey FOREIGN KEY (cmj_test_id) REFERENCES public.cmj_tests(id),
  CONSTRAINT assessments_sj_test_id_fkey FOREIGN KEY (sj_test_id) REFERENCES public.sj_tests(id),
  CONSTRAINT assessments_hj_test_id_fkey FOREIGN KEY (hj_test_id) REFERENCES public.hj_tests(id),
  CONSTRAINT assessments_ppu_test_id_fkey FOREIGN KEY (ppu_test_id) REFERENCES public.ppu_tests(id),
  CONSTRAINT assessments_imtp_test_id_fkey FOREIGN KEY (imtp_test_id) REFERENCES public.imtp_tests(id),
  CONSTRAINT assessments_trackman_session_id_fkey FOREIGN KEY (trackman_session_id) REFERENCES public.trackman_session(id),
  CONSTRAINT assessments_command_session_id_fkey FOREIGN KEY (command_session_id) REFERENCES public.command_training_sessions(id),
  CONSTRAINT assessments_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.athlete_baselines (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  metric_name text NOT NULL,
  value numeric NOT NULL,
  unit text NOT NULL,
  measured_at date NOT NULL,
  verified_by uuid,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT athlete_baselines_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_baselines_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT athlete_baselines_verified_by_fkey FOREIGN KEY (verified_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.athlete_guardians (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  athlete_id uuid NOT NULL,
  guardian_id uuid NOT NULL,
  relationship text DEFAULT 'parent'::text CHECK (relationship = ANY (ARRAY['parent'::text, 'guardian'::text, 'self'::text])),
  can_book boolean DEFAULT true,
  can_purchase boolean DEFAULT true,
  can_view_data boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT athlete_guardians_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_guardians_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.profiles(id),
  CONSTRAINT athlete_guardians_guardian_id_fkey FOREIGN KEY (guardian_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.athlete_kpi_values (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_kpi_id uuid,
  value numeric NOT NULL,
  measured_at timestamp with time zone DEFAULT now(),
  recorded_by uuid,
  notes text,
  org_id uuid,
  CONSTRAINT athlete_kpi_values_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_kpi_values_athlete_kpi_id_fkey FOREIGN KEY (athlete_kpi_id) REFERENCES public.athlete_kpis(id),
  CONSTRAINT athlete_kpi_values_recorded_by_fkey FOREIGN KEY (recorded_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.athlete_kpis (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  kpi_definition_id uuid,
  target_value numeric,
  target_date date,
  is_active boolean DEFAULT true,
  assigned_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT athlete_kpis_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_kpis_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT athlete_kpis_kpi_definition_id_fkey FOREIGN KEY (kpi_definition_id) REFERENCES public.kpi_definitions(id)
);
CREATE TABLE public.athlete_maxes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  exercise_id uuid,
  metric_id text NOT NULL,
  max_value numeric NOT NULL,
  reps_at_max integer,
  achieved_on date NOT NULL DEFAULT CURRENT_DATE,
  source text DEFAULT 'manual'::text,
  notes text,
  verified_by_coach boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT athlete_maxes_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_maxes_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT athlete_maxes_exercise_id_fkey FOREIGN KEY (exercise_id) REFERENCES public.exercises(id)
);
CREATE TABLE public.athlete_reports (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  org_id uuid,
  created_by uuid,
  title text NOT NULL,
  subtitle text,
  report_date date DEFAULT CURRENT_DATE,
  config jsonb NOT NULL DEFAULT '{}'::jsonb,
  snapshot_data jsonb,
  token text DEFAULT encode(gen_random_bytes(32), 'hex'::text) UNIQUE,
  is_public boolean DEFAULT false,
  is_shared_with_athlete boolean DEFAULT false,
  sent_at timestamp with time zone,
  sent_to ARRAY,
  pdf_url text,
  pdf_generated_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT athlete_reports_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_reports_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT athlete_reports_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT athlete_reports_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.athlete_tag_assignments (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  athlete_id uuid NOT NULL,
  tag_id uuid NOT NULL,
  assigned_via character varying NOT NULL,
  assigned_by uuid,
  booking_id uuid,
  notes text,
  assigned_at timestamp with time zone DEFAULT now(),
  CONSTRAINT athlete_tag_assignments_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_tag_assignments_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT athlete_tag_assignments_tag_id_fkey FOREIGN KEY (tag_id) REFERENCES public.restriction_tags(id),
  CONSTRAINT athlete_tag_assignments_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.profiles(id),
  CONSTRAINT athlete_tag_assignments_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.scheduling_bookings(id)
);
CREATE TABLE public.athlete_tags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  tag_name text NOT NULL,
  tag_type text NOT NULL CHECK (tag_type = ANY (ARRAY['plan'::text, 'workout'::text, 'exercise'::text])),
  created_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT athlete_tags_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_tags_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.athletes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  date_of_birth date,
  height_inches integer,
  weight_lbs numeric,
  dominant_hand text CHECK (dominant_hand = ANY (ARRAY['left'::text, 'right'::text, 'switch'::text])),
  primary_position text,
  secondary_position text,
  grad_year integer,
  bio text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  training_tags ARRAY DEFAULT '{}'::text[],
  vald_external_id uuid,
  vald_profile_id text,
  vald_sync_id uuid,
  vald_synced_at timestamp with time zone,
  vald_composite_score double precision,
  vald_composite_history jsonb DEFAULT '[]'::jsonb,
  first_name text,
  last_name text,
  email text,
  play_level text CHECK (play_level = ANY (ARRAY['Youth'::text, 'High School'::text, 'College'::text, 'Pro'::text])),
  notes text,
  phone text,
  blast_user_id text,
  blast_player_id integer,
  blast_external_id text,
  blast_synced_at timestamp with time zone,
  blast_sync_error text,
  guardian_name text,
  guardian_email text,
  client_lifecycle character varying CHECK (client_lifecycle::text = ANY (ARRAY['assessment_scheduled'::character varying, 'assessment_completed'::character varying, 'member'::character varying, 'cancelled_membership'::character varying]::text[])),
  stripe_customer_id text,
  restriction_tag_ids ARRAY DEFAULT '{}'::uuid[],
  trackman_pitcher_name text,
  trackman_pitcher_id text,
  trackman_synced_at timestamp with time zone,
  trackman_sync_error text,
  last_viewed_resources_at timestamp with time zone,
  last_viewed_reports_at timestamp with time zone,
  dynamo_synced_at timestamp with time zone,
  CONSTRAINT athletes_pkey PRIMARY KEY (id),
  CONSTRAINT athletes_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT athletes_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.attendance_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  event_id uuid NOT NULL,
  booking_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  status text NOT NULL CHECK (status = ANY (ARRAY['attended'::text, 'no_show'::text, 'late'::text, 'partial'::text])),
  checked_in_at timestamp with time zone NOT NULL DEFAULT now(),
  checked_out_at timestamp with time zone,
  checked_in_by uuid NOT NULL,
  minutes_late integer DEFAULT 0,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT attendance_logs_pkey PRIMARY KEY (id),
  CONSTRAINT attendance_logs_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT attendance_logs_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.scheduling_events(id),
  CONSTRAINT attendance_logs_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.scheduling_bookings(id),
  CONSTRAINT attendance_logs_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT attendance_logs_checked_in_by_fkey FOREIGN KEY (checked_in_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.blast_averages_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  period_start date NOT NULL,
  period_end date NOT NULL,
  total_actions integer NOT NULL DEFAULT 0,
  total_actions_extended integer,
  averages jsonb NOT NULL,
  captured_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT blast_averages_history_pkey PRIMARY KEY (id),
  CONSTRAINT blast_averages_history_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_swings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  blast_id text NOT NULL,
  swing_id integer,
  academy_id text,
  recorded_date date NOT NULL,
  recorded_time time without time zone NOT NULL,
  created_at_utc timestamp with time zone NOT NULL,
  sport_id integer,
  handedness integer,
  equipment_id text,
  equipment_name text,
  equipment_nickname text,
  has_video boolean DEFAULT false,
  video_id integer,
  video_url text,
  metrics jsonb NOT NULL,
  synced_at timestamp with time zone DEFAULT now(),
  bat_speed numeric,
  attack_angle numeric,
  time_to_contact numeric,
  peak_hand_speed numeric,
  on_plane_efficiency numeric,
  vertical_bat_angle numeric,
  plane_score numeric,
  connection_score numeric,
  rotation_score numeric,
  power numeric,
  rotational_acceleration numeric,
  connection_at_impact numeric,
  early_connection numeric,
  swing_details text,
  org_id uuid,
  CONSTRAINT blast_swings_pkey PRIMARY KEY (id, recorded_date),
  CONSTRAINT blast_swings_new_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_swings_2024_h1 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  blast_id text NOT NULL,
  swing_id integer,
  academy_id text,
  recorded_date date NOT NULL,
  recorded_time time without time zone NOT NULL,
  created_at_utc timestamp with time zone NOT NULL,
  sport_id integer,
  handedness integer,
  equipment_id text,
  equipment_name text,
  equipment_nickname text,
  has_video boolean DEFAULT false,
  video_id integer,
  video_url text,
  metrics jsonb NOT NULL,
  synced_at timestamp with time zone DEFAULT now(),
  bat_speed numeric,
  attack_angle numeric,
  time_to_contact numeric,
  peak_hand_speed numeric,
  on_plane_efficiency numeric,
  vertical_bat_angle numeric,
  plane_score numeric,
  connection_score numeric,
  rotation_score numeric,
  power numeric,
  rotational_acceleration numeric,
  connection_at_impact numeric,
  early_connection numeric,
  swing_details text,
  org_id uuid,
  CONSTRAINT blast_swings_2024_h1_pkey PRIMARY KEY (id, recorded_date),
  CONSTRAINT blast_swings_new_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_swings_2024_h2 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  blast_id text NOT NULL,
  swing_id integer,
  academy_id text,
  recorded_date date NOT NULL,
  recorded_time time without time zone NOT NULL,
  created_at_utc timestamp with time zone NOT NULL,
  sport_id integer,
  handedness integer,
  equipment_id text,
  equipment_name text,
  equipment_nickname text,
  has_video boolean DEFAULT false,
  video_id integer,
  video_url text,
  metrics jsonb NOT NULL,
  synced_at timestamp with time zone DEFAULT now(),
  bat_speed numeric,
  attack_angle numeric,
  time_to_contact numeric,
  peak_hand_speed numeric,
  on_plane_efficiency numeric,
  vertical_bat_angle numeric,
  plane_score numeric,
  connection_score numeric,
  rotation_score numeric,
  power numeric,
  rotational_acceleration numeric,
  connection_at_impact numeric,
  early_connection numeric,
  swing_details text,
  org_id uuid,
  CONSTRAINT blast_swings_2024_h2_pkey PRIMARY KEY (id, recorded_date),
  CONSTRAINT blast_swings_new_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_swings_2025_h1 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  blast_id text NOT NULL,
  swing_id integer,
  academy_id text,
  recorded_date date NOT NULL,
  recorded_time time without time zone NOT NULL,
  created_at_utc timestamp with time zone NOT NULL,
  sport_id integer,
  handedness integer,
  equipment_id text,
  equipment_name text,
  equipment_nickname text,
  has_video boolean DEFAULT false,
  video_id integer,
  video_url text,
  metrics jsonb NOT NULL,
  synced_at timestamp with time zone DEFAULT now(),
  bat_speed numeric,
  attack_angle numeric,
  time_to_contact numeric,
  peak_hand_speed numeric,
  on_plane_efficiency numeric,
  vertical_bat_angle numeric,
  plane_score numeric,
  connection_score numeric,
  rotation_score numeric,
  power numeric,
  rotational_acceleration numeric,
  connection_at_impact numeric,
  early_connection numeric,
  swing_details text,
  org_id uuid,
  CONSTRAINT blast_swings_2025_h1_pkey PRIMARY KEY (id, recorded_date),
  CONSTRAINT blast_swings_new_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_swings_2025_h2 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  blast_id text NOT NULL,
  swing_id integer,
  academy_id text,
  recorded_date date NOT NULL,
  recorded_time time without time zone NOT NULL,
  created_at_utc timestamp with time zone NOT NULL,
  sport_id integer,
  handedness integer,
  equipment_id text,
  equipment_name text,
  equipment_nickname text,
  has_video boolean DEFAULT false,
  video_id integer,
  video_url text,
  metrics jsonb NOT NULL,
  synced_at timestamp with time zone DEFAULT now(),
  bat_speed numeric,
  attack_angle numeric,
  time_to_contact numeric,
  peak_hand_speed numeric,
  on_plane_efficiency numeric,
  vertical_bat_angle numeric,
  plane_score numeric,
  connection_score numeric,
  rotation_score numeric,
  power numeric,
  rotational_acceleration numeric,
  connection_at_impact numeric,
  early_connection numeric,
  swing_details text,
  org_id uuid,
  CONSTRAINT blast_swings_2025_h2_pkey PRIMARY KEY (id, recorded_date),
  CONSTRAINT blast_swings_new_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_swings_2026_h1 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  blast_id text NOT NULL,
  swing_id integer,
  academy_id text,
  recorded_date date NOT NULL,
  recorded_time time without time zone NOT NULL,
  created_at_utc timestamp with time zone NOT NULL,
  sport_id integer,
  handedness integer,
  equipment_id text,
  equipment_name text,
  equipment_nickname text,
  has_video boolean DEFAULT false,
  video_id integer,
  video_url text,
  metrics jsonb NOT NULL,
  synced_at timestamp with time zone DEFAULT now(),
  bat_speed numeric,
  attack_angle numeric,
  time_to_contact numeric,
  peak_hand_speed numeric,
  on_plane_efficiency numeric,
  vertical_bat_angle numeric,
  plane_score numeric,
  connection_score numeric,
  rotation_score numeric,
  power numeric,
  rotational_acceleration numeric,
  connection_at_impact numeric,
  early_connection numeric,
  swing_details text,
  org_id uuid,
  CONSTRAINT blast_swings_2026_h1_pkey PRIMARY KEY (id, recorded_date),
  CONSTRAINT blast_swings_new_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_swings_2026_h2 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  blast_id text NOT NULL,
  swing_id integer,
  academy_id text,
  recorded_date date NOT NULL,
  recorded_time time without time zone NOT NULL,
  created_at_utc timestamp with time zone NOT NULL,
  sport_id integer,
  handedness integer,
  equipment_id text,
  equipment_name text,
  equipment_nickname text,
  has_video boolean DEFAULT false,
  video_id integer,
  video_url text,
  metrics jsonb NOT NULL,
  synced_at timestamp with time zone DEFAULT now(),
  bat_speed numeric,
  attack_angle numeric,
  time_to_contact numeric,
  peak_hand_speed numeric,
  on_plane_efficiency numeric,
  vertical_bat_angle numeric,
  plane_score numeric,
  connection_score numeric,
  rotation_score numeric,
  power numeric,
  rotational_acceleration numeric,
  connection_at_impact numeric,
  early_connection numeric,
  swing_details text,
  org_id uuid,
  CONSTRAINT blast_swings_2026_h2_pkey PRIMARY KEY (id, recorded_date),
  CONSTRAINT blast_swings_new_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_swings_2027_h1 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  blast_id text NOT NULL,
  swing_id integer,
  academy_id text,
  recorded_date date NOT NULL,
  recorded_time time without time zone NOT NULL,
  created_at_utc timestamp with time zone NOT NULL,
  sport_id integer,
  handedness integer,
  equipment_id text,
  equipment_name text,
  equipment_nickname text,
  has_video boolean DEFAULT false,
  video_id integer,
  video_url text,
  metrics jsonb NOT NULL,
  synced_at timestamp with time zone DEFAULT now(),
  bat_speed numeric,
  attack_angle numeric,
  time_to_contact numeric,
  peak_hand_speed numeric,
  on_plane_efficiency numeric,
  vertical_bat_angle numeric,
  plane_score numeric,
  connection_score numeric,
  rotation_score numeric,
  power numeric,
  rotational_acceleration numeric,
  connection_at_impact numeric,
  early_connection numeric,
  swing_details text,
  org_id uuid,
  CONSTRAINT blast_swings_2027_h1_pkey PRIMARY KEY (id, recorded_date),
  CONSTRAINT blast_swings_new_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_swings_2027_h2 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  blast_id text NOT NULL,
  swing_id integer,
  academy_id text,
  recorded_date date NOT NULL,
  recorded_time time without time zone NOT NULL,
  created_at_utc timestamp with time zone NOT NULL,
  sport_id integer,
  handedness integer,
  equipment_id text,
  equipment_name text,
  equipment_nickname text,
  has_video boolean DEFAULT false,
  video_id integer,
  video_url text,
  metrics jsonb NOT NULL,
  synced_at timestamp with time zone DEFAULT now(),
  bat_speed numeric,
  attack_angle numeric,
  time_to_contact numeric,
  peak_hand_speed numeric,
  on_plane_efficiency numeric,
  vertical_bat_angle numeric,
  plane_score numeric,
  connection_score numeric,
  rotation_score numeric,
  power numeric,
  rotational_acceleration numeric,
  connection_at_impact numeric,
  early_connection numeric,
  swing_details text,
  org_id uuid,
  CONSTRAINT blast_swings_2027_h2_pkey PRIMARY KEY (id, recorded_date),
  CONSTRAINT blast_swings_new_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_swings_old_backup (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  blast_id text NOT NULL UNIQUE,
  swing_id integer,
  academy_id text,
  recorded_date date NOT NULL,
  recorded_time time without time zone NOT NULL,
  created_at_utc timestamp with time zone NOT NULL,
  sport_id integer,
  handedness integer,
  equipment_id text,
  equipment_name text,
  equipment_nickname text,
  has_video boolean DEFAULT false,
  video_id integer,
  video_url text,
  metrics jsonb NOT NULL,
  synced_at timestamp with time zone DEFAULT now(),
  bat_speed numeric,
  attack_angle numeric,
  time_to_contact numeric,
  peak_hand_speed numeric,
  on_plane_efficiency numeric,
  vertical_bat_angle numeric,
  plane_score numeric,
  connection_score numeric,
  rotation_score numeric,
  power numeric,
  rotational_acceleration numeric,
  connection_at_impact numeric,
  early_connection numeric,
  swing_details text,
  org_id uuid,
  CONSTRAINT blast_swings_old_backup_pkey PRIMARY KEY (id),
  CONSTRAINT blast_swings_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.blast_sync_jobs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid,
  athlete_id uuid,
  sync_type text NOT NULL CHECK (sync_type = ANY (ARRAY['team'::text, 'individual'::text, 'full'::text])),
  date_range_start date NOT NULL,
  date_range_end date NOT NULL,
  status text NOT NULL CHECK (status = ANY (ARRAY['pending'::text, 'running'::text, 'completed'::text, 'failed'::text])),
  swings_found integer DEFAULT 0,
  swings_synced integer DEFAULT 0,
  error_message text,
  started_at timestamp with time zone,
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT blast_sync_jobs_pkey PRIMARY KEY (id),
  CONSTRAINT blast_sync_jobs_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT blast_sync_jobs_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.booking_audit_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  booking_id uuid NOT NULL,
  action text NOT NULL CHECK (action = ANY (ARRAY['created'::text, 'updated'::text, 'cancelled'::text, 'checked_in'::text, 'no_show'::text])),
  old_data jsonb,
  new_data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT booking_audit_log_pkey PRIMARY KEY (id),
  CONSTRAINT booking_audit_log_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.scheduling_bookings(id)
);
CREATE TABLE public.booking_ledger (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  booking_id uuid NOT NULL UNIQUE,
  event_id uuid NOT NULL,
  source_type text NOT NULL CHECK (source_type = ANY (ARRAY['membership'::text, 'package'::text, 'drop_in'::text, 'comp'::text])),
  source_id uuid,
  service_type text CHECK (service_type = ANY (ARRAY['category'::text, 'template'::text])),
  service_id uuid,
  service_name text,
  reserved_at timestamp with time zone NOT NULL DEFAULT now(),
  attended_at timestamp with time zone,
  cancelled_at timestamp with time zone,
  no_show_at timestamp with time zone,
  consumption_status text NOT NULL DEFAULT 'reserved'::text CHECK (consumption_status = ANY (ARRAY['reserved'::text, 'attended'::text, 'cancelled'::text, 'no_show'::text])),
  refunded boolean NOT NULL DEFAULT false,
  metadata jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT booking_ledger_pkey PRIMARY KEY (id),
  CONSTRAINT booking_ledger_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT booking_ledger_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.bullpen_athletes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  name text NOT NULL,
  is_pro boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  session_type text DEFAULT 'bullpen'::text CHECK (session_type = ANY (ARRAY['bullpen'::text, 'live_ab'::text])),
  is_drop_in boolean DEFAULT false,
  uses_remaining integer,
  CONSTRAINT bullpen_athletes_pkey PRIMARY KEY (id),
  CONSTRAINT bullpen_athletes_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.bullpen_pro_times (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  day_of_week integer NOT NULL CHECK (day_of_week >= 0 AND day_of_week <= 4),
  start_time time without time zone NOT NULL,
  end_time time without time zone NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  session_type text DEFAULT 'bullpen'::text CHECK (session_type = ANY (ARRAY['bullpen'::text, 'live_ab'::text])),
  CONSTRAINT bullpen_pro_times_pkey PRIMARY KEY (id),
  CONSTRAINT bullpen_pro_times_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.bullpen_slots (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  slot_date date NOT NULL,
  slot_time time without time zone NOT NULL,
  is_pro_slot boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  session_type text DEFAULT 'bullpen'::text CHECK (session_type = ANY (ARRAY['bullpen'::text, 'live_ab'::text])),
  CONSTRAINT bullpen_slots_pkey PRIMARY KEY (id),
  CONSTRAINT bullpen_slots_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT bullpen_slots_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.bullpen_athletes(id)
);
CREATE TABLE public.calendar_hierarchy (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  parent_calendar_id uuid NOT NULL,
  child_calendar_id uuid NOT NULL,
  inherit_workouts boolean DEFAULT true,
  inherit_routines boolean DEFAULT true,
  priority integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT calendar_hierarchy_pkey PRIMARY KEY (id),
  CONSTRAINT calendar_hierarchy_parent_calendar_id_fkey FOREIGN KEY (parent_calendar_id) REFERENCES public.groups(id),
  CONSTRAINT calendar_hierarchy_child_calendar_id_fkey FOREIGN KEY (child_calendar_id) REFERENCES public.groups(id)
);
CREATE TABLE public.cmj_tests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  test_id text NOT NULL UNIQUE,
  recorded_utc timestamp with time zone NOT NULL,
  recorded_timezone text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  start_of_movement_trial_value double precision,
  start_of_movement_trial_unit text,
  start_of_movement_threshold_trial_value double precision,
  start_of_movement_threshold_trial_unit text,
  start_of_integration_trial_value double precision,
  start_of_integration_trial_unit text,
  body_weight_trial_value double precision,
  body_weight_trial_unit text,
  body_weight_lbs_trial_value double precision,
  body_weight_lbs_trial_unit text,
  begin_concentric_phase_trial_value double precision,
  begin_concentric_phase_trial_unit text,
  countermovement_depth_trial_value double precision,
  countermovement_depth_trial_unit text,
  bodymass_relative_takeoff_power_trial_value double precision,
  bodymass_relative_takeoff_power_trial_unit text,
  flight_time_trial_value double precision,
  flight_time_trial_unit text,
  jump_height_trial_value double precision,
  jump_height_trial_unit text,
  jump_height_relative_landing_rfd_trial_value double precision,
  jump_height_relative_landing_rfd_trial_unit text,
  jump_height_relative_peak_landing_force_trial_value double precision,
  jump_height_relative_peak_landing_force_trial_unit text,
  impulse_jump_height_trial_value double precision,
  impulse_jump_height_trial_unit text,
  jump_height_imp_mom_trial_value double precision,
  jump_height_imp_mom_trial_unit text,
  landing_rfd_trial_value double precision,
  landing_rfd_trial_unit text,
  landing_rfd_left_value double precision,
  landing_rfd_left_unit text,
  landing_rfd_right_value double precision,
  landing_rfd_right_unit text,
  landing_rfd_asymm_value double precision,
  landing_rfd_asymm_unit text,
  jump_height_inches_trial_value double precision,
  jump_height_inches_trial_unit text,
  jump_height_inches_imp_mom_trial_value double precision,
  jump_height_inches_imp_mom_trial_unit text,
  mean_landing_acceleration_trial_value double precision,
  mean_landing_acceleration_trial_unit text,
  mean_landing_power_trial_value double precision,
  mean_landing_power_trial_unit text,
  mean_landing_velocity_trial_value double precision,
  mean_landing_velocity_trial_unit text,
  mean_takeoff_acceleration_trial_value double precision,
  mean_takeoff_acceleration_trial_unit text,
  mean_takeoff_force_trial_value double precision,
  mean_takeoff_force_trial_unit text,
  mean_takeoff_force_left_value double precision,
  mean_takeoff_force_left_unit text,
  mean_takeoff_force_right_value double precision,
  mean_takeoff_force_right_unit text,
  mean_takeoff_force_asymm_value double precision,
  mean_takeoff_force_asymm_unit text,
  mean_eccentric_force_trial_value double precision,
  mean_eccentric_force_trial_unit text,
  mean_eccentric_force_left_value double precision,
  mean_eccentric_force_left_unit text,
  mean_eccentric_force_right_value double precision,
  mean_eccentric_force_right_unit text,
  mean_eccentric_force_asymm_value double precision,
  mean_eccentric_force_asymm_unit text,
  mean_eccentric_power_trial_value double precision,
  mean_eccentric_power_trial_unit text,
  mean_ecc_con_ratio_trial_value double precision,
  mean_ecc_con_ratio_trial_unit text,
  mean_ecc_con_ratio_left_value double precision,
  mean_ecc_con_ratio_left_unit text,
  mean_ecc_con_ratio_right_value double precision,
  mean_ecc_con_ratio_right_unit text,
  mean_ecc_con_ratio_asymm_value double precision,
  mean_ecc_con_ratio_asymm_unit text,
  mean_concentric_power_trial_value double precision,
  mean_concentric_power_trial_unit text,
  bodymass_relative_mean_concentric_power_trial_value double precision,
  bodymass_relative_mean_concentric_power_trial_unit text,
  bodymass_relative_mean_eccentric_power_trial_value double precision,
  bodymass_relative_mean_eccentric_power_trial_unit text,
  mean_takeoff_velocity_trial_value double precision,
  mean_takeoff_velocity_trial_unit text,
  peak_landing_acceleration_trial_value double precision,
  peak_landing_acceleration_trial_unit text,
  peak_landing_force_trial_value double precision,
  peak_landing_force_trial_unit text,
  peak_landing_force_left_value double precision,
  peak_landing_force_left_unit text,
  peak_landing_force_right_value double precision,
  peak_landing_force_right_unit text,
  peak_landing_force_asymm_value double precision,
  peak_landing_force_asymm_unit text,
  peak_landing_power_trial_value double precision,
  peak_landing_power_trial_unit text,
  peak_landing_velocity_trial_value double precision,
  peak_landing_velocity_trial_unit text,
  peak_takeoff_acceleration_trial_value double precision,
  peak_takeoff_acceleration_trial_unit text,
  peak_takeoff_force_trial_value double precision,
  peak_takeoff_force_trial_unit text,
  peak_takeoff_force_left_value double precision,
  peak_takeoff_force_left_unit text,
  peak_takeoff_force_right_value double precision,
  peak_takeoff_force_right_unit text,
  peak_takeoff_force_asymm_value double precision,
  peak_takeoff_force_asymm_unit text,
  peak_takeoff_power_trial_value double precision,
  peak_takeoff_power_trial_unit text,
  peak_takeoff_velocity_trial_value double precision,
  peak_takeoff_velocity_trial_unit text,
  concentric_rfd_trial_value double precision,
  concentric_rfd_trial_unit text,
  concentric_rfd_left_value double precision,
  concentric_rfd_left_unit text,
  concentric_rfd_right_value double precision,
  concentric_rfd_right_unit text,
  concentric_rfd_asymm_value double precision,
  concentric_rfd_asymm_unit text,
  concentric_rfd_100_trial_value double precision,
  concentric_rfd_100_trial_unit text,
  concentric_rfd_100_left_value double precision,
  concentric_rfd_100_left_unit text,
  concentric_rfd_100_right_value double precision,
  concentric_rfd_100_right_unit text,
  concentric_rfd_100_asymm_value double precision,
  concentric_rfd_100_asymm_unit text,
  concentric_rfd_200_trial_value double precision,
  concentric_rfd_200_trial_unit text,
  concentric_rfd_200_left_value double precision,
  concentric_rfd_200_left_unit text,
  concentric_rfd_200_right_value double precision,
  concentric_rfd_200_right_unit text,
  concentric_rfd_200_asymm_value double precision,
  concentric_rfd_200_asymm_unit text,
  concentric_rfd_50_trial_value double precision,
  concentric_rfd_50_trial_unit text,
  concentric_rfd_50_left_value double precision,
  concentric_rfd_50_left_unit text,
  concentric_rfd_50_right_value double precision,
  concentric_rfd_50_right_unit text,
  concentric_rfd_50_asymm_value double precision,
  concentric_rfd_50_asymm_unit text,
  concentric_rfd_max_trial_value double precision,
  concentric_rfd_max_trial_unit text,
  concentric_rfd_max_left_value double precision,
  concentric_rfd_max_left_unit text,
  concentric_rfd_max_right_value double precision,
  concentric_rfd_max_right_unit text,
  concentric_rfd_max_asymm_value double precision,
  concentric_rfd_max_asymm_unit text,
  time_to_peak_force_trial_value double precision,
  time_to_peak_force_trial_unit text,
  time_to_peak_force_left_value double precision,
  time_to_peak_force_left_unit text,
  time_to_peak_force_right_value double precision,
  time_to_peak_force_right_unit text,
  time_to_peak_force_asymm_value double precision,
  time_to_peak_force_asymm_unit text,
  contraction_time_trial_value double precision,
  contraction_time_trial_unit text,
  eccentric_time_trial_value double precision,
  eccentric_time_trial_unit text,
  start_to_peak_force_time_trial_value double precision,
  start_to_peak_force_time_trial_unit text,
  start_to_peak_power_time_trial_value double precision,
  start_to_peak_power_time_trial_unit text,
  weight_relative_peak_landing_force_trial_value double precision,
  weight_relative_peak_landing_force_trial_unit text,
  weight_relative_peak_takeoff_force_trial_value double precision,
  weight_relative_peak_takeoff_force_trial_unit text,
  relative_concentric_rfd_trial_value double precision,
  relative_concentric_rfd_trial_unit text,
  takeoff_velocity_trial_value double precision,
  takeoff_velocity_trial_unit text,
  concentric_duration_trial_value double precision,
  concentric_duration_trial_unit text,
  concentric_eccentric_duration_ratio_trial_value double precision,
  concentric_eccentric_duration_ratio_trial_unit text,
  eccentric_concentric_duration_ratio_trial_value double precision,
  eccentric_concentric_duration_ratio_trial_unit text,
  flight_contraction_time_ratio_trial_value double precision,
  flight_contraction_time_ratio_trial_unit text,
  flight_eccentric_time_ratio_trial_value double precision,
  flight_eccentric_time_ratio_trial_unit text,
  begin_braking_phase_trial_value double precision,
  begin_braking_phase_trial_unit text,
  min_eccentric_force_trial_value double precision,
  min_eccentric_force_trial_unit text,
  braking_phase_duration_trial_value double precision,
  braking_phase_duration_trial_unit text,
  begin_ecc_decel_phase_trial_value double precision,
  begin_ecc_decel_phase_trial_unit text,
  time_to_braking_phase_trial_value double precision,
  time_to_braking_phase_trial_unit text,
  eccentric_accel_phase_duration_trial_value double precision,
  eccentric_accel_phase_duration_trial_unit text,
  eccentric_decel_phase_duration_trial_value double precision,
  eccentric_decel_phase_duration_trial_unit text,
  beaking_contraction_duration_ratio_trial_value double precision,
  beaking_contraction_duration_ratio_trial_unit text,
  beaking_concentric_duration_ratio_trial_value double precision,
  beaking_concentric_duration_ratio_trial_unit text,
  mean_eccentric_braking_force_trial_value double precision,
  mean_eccentric_braking_force_trial_unit text,
  mean_eccentric_deceleration_force_trial_value double precision,
  mean_eccentric_deceleration_force_trial_unit text,
  force_at_peak_power_trial_value double precision,
  force_at_peak_power_trial_unit text,
  force_at_peak_power_left_value double precision,
  force_at_peak_power_left_unit text,
  force_at_peak_power_right_value double precision,
  force_at_peak_power_right_unit text,
  force_at_peak_power_asymm_value double precision,
  force_at_peak_power_asymm_unit text,
  concentric_impulse_50ms_trial_value double precision,
  concentric_impulse_50ms_trial_unit text,
  concentric_impulse_50ms_left_value double precision,
  concentric_impulse_50ms_left_unit text,
  concentric_impulse_50ms_right_value double precision,
  concentric_impulse_50ms_right_unit text,
  concentric_impulse_50ms_asymm_value double precision,
  concentric_impulse_50ms_asymm_unit text,
  concentric_impulse_100ms_trial_value double precision,
  concentric_impulse_100ms_trial_unit text,
  concentric_impulse_100ms_left_value double precision,
  concentric_impulse_100ms_left_unit text,
  concentric_impulse_100ms_right_value double precision,
  concentric_impulse_100ms_right_unit text,
  concentric_impulse_100ms_asymm_value double precision,
  concentric_impulse_100ms_asymm_unit text,
  concentric_impulse_p1_trial_value double precision,
  concentric_impulse_p1_trial_unit text,
  concentric_impulse_p1_left_value double precision,
  concentric_impulse_p1_left_unit text,
  concentric_impulse_p1_right_value double precision,
  concentric_impulse_p1_right_unit text,
  concentric_impulse_p1_asymm_value double precision,
  concentric_impulse_p1_asymm_unit text,
  concentric_impulse_p2_trial_value double precision,
  concentric_impulse_p2_trial_unit text,
  concentric_impulse_p2_left_value double precision,
  concentric_impulse_p2_left_unit text,
  concentric_impulse_p2_right_value double precision,
  concentric_impulse_p2_right_unit text,
  concentric_impulse_p2_asymm_value double precision,
  concentric_impulse_p2_asymm_unit text,
  eccentric_braking_rfd_trial_value double precision,
  eccentric_braking_rfd_trial_unit text,
  eccentric_braking_rfd_left_value double precision,
  eccentric_braking_rfd_left_unit text,
  eccentric_braking_rfd_right_value double precision,
  eccentric_braking_rfd_right_unit text,
  eccentric_braking_rfd_asymm_value double precision,
  eccentric_braking_rfd_asymm_unit text,
  relative_eccentric_braking_rfd_trial_value double precision,
  relative_eccentric_braking_rfd_trial_unit text,
  eccentric_braking_rfd_100ms_trial_value double precision,
  eccentric_braking_rfd_100ms_trial_unit text,
  eccentric_braking_rfd_100ms_left_value double precision,
  eccentric_braking_rfd_100ms_left_unit text,
  eccentric_braking_rfd_100ms_right_value double precision,
  eccentric_braking_rfd_100ms_right_unit text,
  eccentric_braking_rfd_100ms_asymm_value double precision,
  eccentric_braking_rfd_100ms_asymm_unit text,
  relative_eccentric_braking_rfd_100ms_trial_value double precision,
  relative_eccentric_braking_rfd_100ms_trial_unit text,
  eccentric_decel_rfd_trial_value double precision,
  eccentric_decel_rfd_trial_unit text,
  eccentric_decel_rfd_left_value double precision,
  eccentric_decel_rfd_left_unit text,
  eccentric_decel_rfd_right_value double precision,
  eccentric_decel_rfd_right_unit text,
  eccentric_decel_rfd_asymm_value double precision,
  eccentric_decel_rfd_asymm_unit text,
  relative_eccentric_decel_rfd_trial_value double precision,
  relative_eccentric_decel_rfd_trial_unit text,
  relative_peak_takeoff_force_trial_value double precision,
  relative_peak_takeoff_force_trial_unit text,
  peak_concentric_force_trial_value double precision,
  peak_concentric_force_trial_unit text,
  peak_concentric_force_left_value double precision,
  peak_concentric_force_left_unit text,
  peak_concentric_force_right_value double precision,
  peak_concentric_force_right_unit text,
  peak_concentric_force_asymm_value double precision,
  peak_concentric_force_asymm_unit text,
  relative_peak_concentric_force_trial_value double precision,
  relative_peak_concentric_force_trial_unit text,
  peak_eccentric_force_trial_value double precision,
  peak_eccentric_force_trial_unit text,
  peak_eccentric_force_left_value double precision,
  peak_eccentric_force_left_unit text,
  peak_eccentric_force_right_value double precision,
  peak_eccentric_force_right_unit text,
  peak_eccentric_force_asymm_value double precision,
  peak_eccentric_force_asymm_unit text,
  relative_peak_eccentric_force_trial_value double precision,
  relative_peak_eccentric_force_trial_unit text,
  relative_peak_landing_force_trial_value double precision,
  relative_peak_landing_force_trial_unit text,
  mean_ecc_con_power_time_trial_value double precision,
  mean_ecc_con_power_time_trial_unit text,
  lower_limb_stiffness_trial_value double precision,
  lower_limb_stiffness_trial_unit text,
  concentric_rpd_trial_value double precision,
  concentric_rpd_trial_unit text,
  relative_concentric_rpd_trial_value double precision,
  relative_concentric_rpd_trial_unit text,
  concentric_rpd_50ms_trial_value double precision,
  concentric_rpd_50ms_trial_unit text,
  relative_concentric_rpd_50ms_trial_value double precision,
  relative_concentric_rpd_50ms_trial_unit text,
  concentric_rpd_100ms_trial_value double precision,
  concentric_rpd_100ms_trial_unit text,
  relative_concentric_rpd_100ms_trial_value double precision,
  relative_concentric_rpd_100ms_trial_unit text,
  rsi_modified_trial_value double precision,
  rsi_modified_trial_unit text,
  total_work_trial_value double precision,
  total_work_trial_unit text,
  velocity_at_peak_power_trial_value double precision,
  velocity_at_peak_power_trial_unit text,
  eccentric_peak_velocity_trial_value double precision,
  eccentric_peak_velocity_trial_unit text,
  eccentric_peak_power_trial_value double precision,
  eccentric_peak_power_trial_unit text,
  eccentric_braking_impulse_trial_value double precision,
  eccentric_braking_impulse_trial_unit text,
  eccentric_braking_impulse_left_value double precision,
  eccentric_braking_impulse_left_unit text,
  eccentric_braking_impulse_right_value double precision,
  eccentric_braking_impulse_right_unit text,
  eccentric_braking_impulse_asymm_value double precision,
  eccentric_braking_impulse_asymm_unit text,
  eccentric_decel_impulse_trial_value double precision,
  eccentric_decel_impulse_trial_unit text,
  eccentric_decel_impulse_left_value double precision,
  eccentric_decel_impulse_left_unit text,
  eccentric_decel_impulse_right_value double precision,
  eccentric_decel_impulse_right_unit text,
  eccentric_decel_impulse_asymm_value double precision,
  eccentric_decel_impulse_asymm_unit text,
  concentric_impulse_trial_value double precision,
  concentric_impulse_trial_unit text,
  concentric_impulse_left_value double precision,
  concentric_impulse_left_unit text,
  concentric_impulse_right_value double precision,
  concentric_impulse_right_unit text,
  concentric_impulse_asymm_value double precision,
  concentric_impulse_asymm_unit text,
  force_at_zero_velocity_trial_value double precision,
  force_at_zero_velocity_trial_unit text,
  force_at_zero_velocity_left_value double precision,
  force_at_zero_velocity_left_unit text,
  force_at_zero_velocity_right_value double precision,
  force_at_zero_velocity_right_unit text,
  force_at_zero_velocity_asymm_value double precision,
  force_at_zero_velocity_asymm_unit text,
  positive_impulse_trial_value double precision,
  positive_impulse_trial_unit text,
  positive_impulse_left_value double precision,
  positive_impulse_left_unit text,
  positive_impulse_right_value double precision,
  positive_impulse_right_unit text,
  positive_impulse_asymm_value double precision,
  positive_impulse_asymm_unit text,
  eccentric_unloading_impulse_trial_value double precision,
  eccentric_unloading_impulse_trial_unit text,
  eccentric_unloading_impulse_left_value double precision,
  eccentric_unloading_impulse_left_unit text,
  eccentric_unloading_impulse_right_value double precision,
  eccentric_unloading_impulse_right_unit text,
  eccentric_unloading_impulse_asymm_value double precision,
  eccentric_unloading_impulse_asymm_unit text,
  positive_takeoff_impulse_trial_value double precision,
  positive_takeoff_impulse_trial_unit text,
  positive_takeoff_impulse_left_value double precision,
  positive_takeoff_impulse_left_unit text,
  positive_takeoff_impulse_right_value double precision,
  positive_takeoff_impulse_right_unit text,
  positive_takeoff_impulse_asymm_value double precision,
  positive_takeoff_impulse_asymm_unit text,
  cmj_stiffness_trial_value double precision,
  cmj_stiffness_trial_unit text,
  cmj_stiffness_left_value double precision,
  cmj_stiffness_left_unit text,
  cmj_stiffness_right_value double precision,
  cmj_stiffness_right_unit text,
  cmj_stiffness_asymm_value double precision,
  cmj_stiffness_asymm_unit text,
  bodymass_relative_mean_takeoff_force_trial_value double precision,
  bodymass_relative_mean_takeoff_force_trial_unit text,
  bodymass_relative_eccentric_peak_power_trial_value double precision,
  bodymass_relative_eccentric_peak_power_trial_unit text,
  ecc_con_peak_power_ratio_trial_value double precision,
  ecc_con_peak_power_ratio_trial_unit text,
  con_p2_con_p1_impulse_ratio_trial_value double precision,
  con_p2_con_p1_impulse_ratio_trial_unit text,
  con_p2_con_p1_impulse_ratio_left_value double precision,
  con_p2_con_p1_impulse_ratio_left_unit text,
  con_p2_con_p1_impulse_ratio_right_value double precision,
  con_p2_con_p1_impulse_ratio_right_unit text,
  con_p2_con_p1_impulse_ratio_asymm_value double precision,
  con_p2_con_p1_impulse_ratio_asymm_unit text,
  con_100ms_con_impulse_ratio_trial_value double precision,
  con_100ms_con_impulse_ratio_trial_unit text,
  con_100ms_con_impulse_ratio_left_value double precision,
  con_100ms_con_impulse_ratio_left_unit text,
  con_100ms_con_impulse_ratio_right_value double precision,
  con_100ms_con_impulse_ratio_right_unit text,
  con_100ms_con_impulse_ratio_asymm_value double precision,
  con_100ms_con_impulse_ratio_asymm_unit text,
  landing_impulse_trial_value double precision,
  landing_impulse_trial_unit text,
  landing_impulse_left_value double precision,
  landing_impulse_left_unit text,
  landing_impulse_right_value double precision,
  landing_impulse_right_unit text,
  landing_impulse_asymm_value double precision,
  landing_impulse_asymm_unit text,
  landing_rfd_50_trial_value double precision,
  landing_rfd_50_trial_unit text,
  bodymass_relative_ecc_decel_impulse_trial_value double precision,
  bodymass_relative_ecc_decel_impulse_trial_unit text,
  displacement_at_takeoff_trial_value double precision,
  displacement_at_takeoff_trial_unit text,
  bm_rel_force_at_zero_velocity_trial_value double precision,
  bm_rel_force_at_zero_velocity_trial_unit text,
  rsi_modified_imp_mom_trial_value double precision,
  rsi_modified_imp_mom_trial_unit text,
  bm_rel_abs_con_impulse_trial_value double precision,
  bm_rel_abs_con_impulse_trial_unit text,
  play_level text,
  org_id uuid,
  bw_rel_mean_takeoff_force_trial_value double precision,
  bw_rel_mean_takeoff_force_trial_unit text,
  bw_rel_peak_landing_force_trial_value double precision,
  bw_rel_peak_landing_force_trial_unit text,
  bw_rel_ecc_decel_mean_force_trial_value double precision,
  bw_rel_ecc_decel_mean_force_trial_unit text,
  bm_rel_ecc_decel_mean_force_trial_value double precision,
  bm_rel_ecc_decel_mean_force_trial_unit text,
  bm_rel_ecc_unloading_phase_mean_force_trial_value double precision,
  bm_rel_ecc_unloading_phase_mean_force_trial_unit text,
  bm_rel_ecc_unloading_phase_rfd_trial_value double precision,
  bm_rel_ecc_unloading_phase_rfd_trial_unit text,
  bm_rel_ecc_yielding_phase_mean_force_trial_value double precision,
  bm_rel_ecc_yielding_phase_mean_force_trial_unit text,
  bm_rel_ecc_yielding_phase_rfd_trial_value double precision,
  bm_rel_ecc_yielding_phase_rfd_trial_unit text,
  ecc_unloading_phase_duration_trial_value double precision,
  ecc_unloading_phase_duration_trial_unit text,
  ecc_unloading_phase_impulse_trial_value double precision,
  ecc_unloading_phase_impulse_trial_unit text,
  ecc_unloading_phase_impulse_left_value double precision,
  ecc_unloading_phase_impulse_left_unit text,
  ecc_unloading_phase_impulse_right_value double precision,
  ecc_unloading_phase_impulse_right_unit text,
  ecc_unloading_phase_impulse_asymm_value double precision,
  ecc_unloading_phase_impulse_asymm_unit text,
  ecc_unloading_phase_mean_force_trial_value double precision,
  ecc_unloading_phase_mean_force_trial_unit text,
  ecc_unloading_phase_mean_force_left_value double precision,
  ecc_unloading_phase_mean_force_left_unit text,
  ecc_unloading_phase_mean_force_right_value double precision,
  ecc_unloading_phase_mean_force_right_unit text,
  ecc_unloading_phase_mean_force_asymm_value double precision,
  ecc_unloading_phase_mean_force_asymm_unit text,
  ecc_unloading_phase_rfd_trial_value double precision,
  ecc_unloading_phase_rfd_trial_unit text,
  ecc_unloading_phase_rfd_left_value double precision,
  ecc_unloading_phase_rfd_left_unit text,
  ecc_unloading_phase_rfd_right_value double precision,
  ecc_unloading_phase_rfd_right_unit text,
  ecc_unloading_phase_rfd_asymm_value double precision,
  ecc_unloading_phase_rfd_asymm_unit text,
  ecc_yielding_phase_duration_trial_value double precision,
  ecc_yielding_phase_duration_trial_unit text,
  ecc_yielding_phase_impulse_trial_value double precision,
  ecc_yielding_phase_impulse_trial_unit text,
  ecc_yielding_phase_impulse_left_value double precision,
  ecc_yielding_phase_impulse_left_unit text,
  ecc_yielding_phase_impulse_right_value double precision,
  ecc_yielding_phase_impulse_right_unit text,
  ecc_yielding_phase_impulse_asymm_value double precision,
  ecc_yielding_phase_impulse_asymm_unit text,
  ecc_yielding_phase_mean_force_trial_value double precision,
  ecc_yielding_phase_mean_force_trial_unit text,
  ecc_yielding_phase_mean_force_left_value double precision,
  ecc_yielding_phase_mean_force_left_unit text,
  ecc_yielding_phase_mean_force_right_value double precision,
  ecc_yielding_phase_mean_force_right_unit text,
  ecc_yielding_phase_mean_force_asymm_value double precision,
  ecc_yielding_phase_mean_force_asymm_unit text,
  ecc_yielding_phase_rfd_trial_value double precision,
  ecc_yielding_phase_rfd_trial_unit text,
  ecc_yielding_phase_rfd_left_value double precision,
  ecc_yielding_phase_rfd_left_unit text,
  ecc_yielding_phase_rfd_right_value double precision,
  ecc_yielding_phase_rfd_right_unit text,
  ecc_yielding_phase_rfd_asymm_value double precision,
  ecc_yielding_phase_rfd_asymm_unit text,
  test_number_at_level integer DEFAULT 1,
  source_system character varying DEFAULT 'vald'::character varying,
  CONSTRAINT cmj_tests_pkey PRIMARY KEY (id),
  CONSTRAINT cmj_tests_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.coach_athletes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  coach_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  assigned_by uuid,
  assigned_at timestamp with time zone DEFAULT now(),
  is_primary boolean DEFAULT false,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT coach_athletes_pkey PRIMARY KEY (id),
  CONSTRAINT coach_athletes_coach_id_fkey FOREIGN KEY (coach_id) REFERENCES public.profiles(id),
  CONSTRAINT coach_athletes_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT coach_athletes_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.coach_notification_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  org_id uuid NOT NULL,
  email_new_bookings boolean NOT NULL DEFAULT true,
  email_booking_cancellations boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT coach_notification_settings_pkey PRIMARY KEY (id),
  CONSTRAINT coach_notification_settings_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT coach_notification_settings_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.command_training_pitches (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_id uuid NOT NULL,
  pitch_number integer NOT NULL,
  pitch_timestamp timestamp with time zone NOT NULL DEFAULT now(),
  target_x numeric NOT NULL,
  target_y numeric NOT NULL,
  actual_x numeric NOT NULL,
  actual_y numeric NOT NULL,
  miss_distance_inches numeric NOT NULL,
  miss_direction_degrees numeric NOT NULL,
  miss_cardinal text NOT NULL,
  in_target_zone boolean,
  pitch_type text NOT NULL,
  velocity_mph numeric,
  notes text,
  logged_by uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  org_id uuid,
  trackman_pitch_id bigint,
  data_source text DEFAULT 'manual'::text CHECK (data_source = ANY (ARRAY['manual'::text, 'trackman'::text, 'hybrid'::text])),
  CONSTRAINT command_training_pitches_pkey PRIMARY KEY (id),
  CONSTRAINT command_training_pitches_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.command_training_sessions(id),
  CONSTRAINT command_training_pitches_logged_by_fkey FOREIGN KEY (logged_by) REFERENCES public.profiles(id),
  CONSTRAINT command_training_pitches_trackman_pitch_id_fkey FOREIGN KEY (trackman_pitch_id) REFERENCES public.trackman_pitch_data(id)
);
CREATE TABLE public.command_training_session_athletes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  added_at timestamp with time zone NOT NULL DEFAULT now(),
  added_by uuid,
  CONSTRAINT command_training_session_athletes_pkey PRIMARY KEY (id),
  CONSTRAINT command_training_session_athletes_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.command_training_sessions(id),
  CONSTRAINT command_training_session_athletes_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT command_training_session_athletes_added_by_fkey FOREIGN KEY (added_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.command_training_sessions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  session_date date NOT NULL DEFAULT CURRENT_DATE,
  session_start timestamp with time zone NOT NULL DEFAULT now(),
  session_end timestamp with time zone,
  status text NOT NULL DEFAULT 'in_progress'::text CHECK (status = ANY (ARRAY['in_progress'::text, 'completed'::text, 'cancelled'::text])),
  total_pitches integer NOT NULL DEFAULT 0,
  avg_miss_distance_inches numeric,
  command_percentage numeric,
  notes text,
  logged_by uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  org_id uuid,
  trackman_session_id integer,
  active_athlete_id uuid,
  CONSTRAINT command_training_sessions_pkey PRIMARY KEY (id),
  CONSTRAINT command_training_sessions_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT command_training_sessions_logged_by_fkey FOREIGN KEY (logged_by) REFERENCES public.profiles(id),
  CONSTRAINT command_training_sessions_trackman_session_id_fkey FOREIGN KEY (trackman_session_id) REFERENCES public.trackman_session(id),
  CONSTRAINT command_training_sessions_active_athlete_id_fkey FOREIGN KEY (active_athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.composite_score_configs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid,
  name character varying NOT NULL,
  description text,
  metrics jsonb NOT NULL CHECK (jsonb_array_length(metrics) > 0),
  display_order integer DEFAULT 0,
  is_default boolean DEFAULT false,
  is_active boolean DEFAULT true,
  category character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT composite_score_configs_pkey PRIMARY KEY (id),
  CONSTRAINT composite_score_configs_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.conversation_participants (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  conversation_id uuid NOT NULL,
  user_id uuid NOT NULL,
  last_read_at timestamp with time zone DEFAULT now(),
  joined_at timestamp with time zone DEFAULT now(),
  is_archived boolean DEFAULT false,
  CONSTRAINT conversation_participants_pkey PRIMARY KEY (id),
  CONSTRAINT conversation_participants_conversation_id_fkey FOREIGN KEY (conversation_id) REFERENCES public.conversations(id),
  CONSTRAINT conversation_participants_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.conversations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  org_id uuid NOT NULL,
  type text NOT NULL CHECK (type = ANY (ARRAY['direct'::text, 'group'::text, 'announcement'::text])),
  title text,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  is_locked boolean DEFAULT false,
  CONSTRAINT conversations_pkey PRIMARY KEY (id),
  CONSTRAINT conversations_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT conversations_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.custom_measurements (
  id text NOT NULL,
  name text NOT NULL,
  category text NOT NULL CHECK (category = ANY (ARRAY['single'::text, 'paired'::text])),
  primary_metric_id text,
  primary_metric_name text,
  primary_metric_type text CHECK (primary_metric_type IS NULL OR (primary_metric_type = ANY (ARRAY['reps'::text, 'performance_decimal'::text, 'performance_integer'::text, 'weight'::text, 'time'::text, 'distance'::text]))),
  secondary_metric_id text,
  secondary_metric_name text,
  secondary_metric_type text CHECK (secondary_metric_type IS NULL OR (secondary_metric_type = ANY (ARRAY['reps'::text, 'performance_decimal'::text, 'performance_integer'::text, 'weight'::text, 'time'::text, 'distance'::text]))),
  is_locked boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  org_id uuid,
  CONSTRAINT custom_measurements_pkey PRIMARY KEY (id),
  CONSTRAINT custom_measurements_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.driveline_seed_data (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  test_date date,
  athlete_name text,
  playing_level text NOT NULL CHECK (playing_level = ANY (ARRAY['Youth'::text, 'High School'::text, 'College'::text, 'Pro'::text])),
  body_weight_lbs double precision,
  athlete_uid text,
  bat_speed_mph_group text,
  pitch_speed_mph_group text,
  t_spine_rom_r double precision,
  t_spine_rom_l double precision,
  shoulder_er_l double precision,
  shoulder_er_r double precision,
  shoulder_ir_l double precision,
  shoulder_ir_r double precision,
  pitching_session_date date,
  pitch_speed_mph double precision,
  pitching_max_hss double precision,
  hitting_session_date date,
  bat_speed_mph double precision,
  hitting_max_hss double precision,
  jump_height_trial_value double precision,
  stiffness_trial_value double precision,
  peak_takeoff_power_trial_value double precision,
  bodymass_relative_takeoff_power_trial_value double precision,
  eccentric_braking_rfd_trial_value double precision,
  eccentric_duration_trial_value double precision,
  concentric_duration_trial_value double precision,
  rsi_modified_trial_value double precision,
  countermovement_depth_trial_value double precision,
  concentric_peak_force_trial_value double precision,
  eccentric_peak_force_trial_value double precision,
  eccentric_minimum_force_trial_value double precision,
  stiffness_asymm_value double precision,
  eccentric_deceleration_impulse_asymm_value double precision,
  contraction_impulse_asymm_value_cmj double precision,
  concentric_impulse_asymm_value_cmj double precision,
  sj_jump_height_trial_value double precision,
  sj_peak_takeoff_power_trial_value double precision,
  sj_bodymass_relative_takeoff_power_trial_value double precision,
  sj_contraction_impulse_asymm_value double precision,
  sj_concentric_impulse_asymm_value double precision,
  peak_vertical_force_trial_value double precision,
  net_peak_vertical_force_trial_value double precision,
  relative_strength_trial_value double precision,
  force_at_100_trial_value double precision,
  force_at_150_trial_value double precision,
  force_at_200_trial_value double precision,
  hop_mean_stiffness_trial_value double precision,
  hop_mean_jump_height_trial_value double precision,
  hop_mean_rsi_trial_value double precision,
  hop_mean_contact_time_trial_value double precision,
  ppu_peak_takeoff_force_trial_value double precision,
  ppu_peak_eccentric_force_trial_value double precision,
  ppu_peak_takeoff_force_asymm_value double precision,
  ppu_peak_eccentric_force_asymm_value double precision,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT driveline_seed_data_pkey PRIMARY KEY (id)
);
CREATE TABLE public.dynamo_tests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  test_id text NOT NULL,
  org_id uuid,
  test_category text NOT NULL,
  body_region text NOT NULL,
  movement text NOT NULL,
  position text,
  custom_position text,
  laterality text NOT NULL,
  test_type_name text DEFAULT 
CASE
    WHEN (("position" IS NOT NULL) AND ("position" <> ''::text)) THEN ((((body_region || ' '::text) || movement) || ' - '::text) || "position")
    ELSE ((body_region || ' '::text) || movement)
END,
  recorded_utc timestamp with time zone NOT NULL,
  recorded_timezone text,
  duration_seconds numeric,
  analysed_utc timestamp with time zone,
  hardware_info text,
  software_info text,
  analysis_info text,
  attachments text,
  left_attachment text,
  right_attachment text,
  play_level text,
  test_number_at_level integer DEFAULT 1,
  source_system text DEFAULT 'vald'::text,
  left_rep_count integer,
  left_max_force_newtons numeric,
  left_avg_force_newtons numeric,
  left_max_impulse_newton_seconds numeric,
  left_avg_impulse_newton_seconds numeric,
  left_max_rfd_newtons_per_second numeric,
  left_avg_rfd_newtons_per_second numeric,
  left_max_rom_degrees numeric,
  left_avg_rom_degrees numeric,
  left_avg_time_to_peak_force_seconds numeric,
  left_min_time_to_peak_force_seconds numeric,
  right_rep_count integer,
  right_max_force_newtons numeric,
  right_avg_force_newtons numeric,
  right_max_impulse_newton_seconds numeric,
  right_avg_impulse_newton_seconds numeric,
  right_max_rfd_newtons_per_second numeric,
  right_avg_rfd_newtons_per_second numeric,
  right_max_rom_degrees numeric,
  right_avg_rom_degrees numeric,
  right_avg_time_to_peak_force_seconds numeric,
  right_min_time_to_peak_force_seconds numeric,
  combined_rep_count integer,
  combined_max_force_newtons numeric,
  combined_avg_force_newtons numeric,
  combined_max_impulse_newton_seconds numeric,
  combined_avg_impulse_newton_seconds numeric,
  combined_max_rfd_newtons_per_second numeric,
  combined_avg_rfd_newtons_per_second numeric,
  combined_max_rom_degrees numeric,
  combined_avg_rom_degrees numeric,
  combined_avg_time_to_peak_force_seconds numeric,
  combined_min_time_to_peak_force_seconds numeric,
  asymmetry_percentage numeric,
  ratios jsonb DEFAULT '[]'::jsonb,
  repetitions jsonb DEFAULT '[]'::jsonb,
  repetition_type_summaries jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT dynamo_tests_pkey PRIMARY KEY (id),
  CONSTRAINT dynamo_tests_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT dynamo_tests_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.email_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  resend_id text,
  from_address text NOT NULL,
  to_addresses ARRAY NOT NULL,
  subject text NOT NULL,
  email_type text NOT NULL DEFAULT 'general'::text,
  related_id uuid,
  related_type text,
  status text NOT NULL DEFAULT 'sent'::text,
  delivered_at timestamp with time zone,
  bounced_at timestamp with time zone,
  bounce_reason text,
  opened boolean DEFAULT false,
  opened_at timestamp with time zone,
  open_count integer DEFAULT 0,
  clicked boolean DEFAULT false,
  clicked_at timestamp with time zone,
  click_count integer DEFAULT 0,
  sent_by uuid,
  recipient_name text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT email_logs_pkey PRIMARY KEY (id),
  CONSTRAINT email_logs_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT email_logs_sent_by_fkey FOREIGN KEY (sent_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.email_templates (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  org_id uuid,
  name text NOT NULL,
  subject text NOT NULL,
  html_content text NOT NULL,
  variables jsonb DEFAULT '["athleteName", "firstName", "assessmentLink", "assessmentTitle", "reportDate", "coachName", "facilityName", "membershipLink"]'::jsonb,
  category text DEFAULT 'assessment'::text CHECK (category = ANY (ARRAY['assessment'::text, 'welcome'::text, 'general'::text])),
  is_default boolean DEFAULT false,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  editor_mode text DEFAULT 'simple'::text CHECK (editor_mode = ANY (ARRAY['simple'::text, 'advanced'::text])),
  simple_content jsonb DEFAULT '{"body": "Your performance assessment has been completed by {coachName} at {facilityName}. This comprehensive report includes detailed analysis of your performance metrics and personalized recommendations.", "footer": "Report Date: {reportDate}", "greeting": "Hi {firstName}, your assessment is ready!", "buttonLink": "{assessmentLink}", "buttonText": "View Your Assessment"}'::jsonb,
  notification_type text,
  sms_content text,
  is_system_template boolean DEFAULT false,
  user_type text,
  trigger_event text,
  is_locked boolean DEFAULT false,
  CONSTRAINT email_templates_pkey PRIMARY KEY (id),
  CONSTRAINT email_templates_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT email_templates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.entitlement_rules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  package_type_id uuid NOT NULL,
  scope text NOT NULL CHECK (scope = ANY (ARRAY['any'::text, 'category'::text, 'template'::text])),
  category_id uuid,
  template_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  visits_allocated integer,
  CONSTRAINT entitlement_rules_pkey PRIMARY KEY (id),
  CONSTRAINT entitlement_rules_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT entitlement_rules_package_type_id_fkey FOREIGN KEY (package_type_id) REFERENCES public.package_types(id),
  CONSTRAINT entitlement_rules_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.scheduling_categories(id),
  CONSTRAINT entitlement_rules_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.scheduling_templates(id)
);
CREATE TABLE public.events_attendance (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  team_id uuid,
  event_date date NOT NULL,
  event_type USER-DEFINED NOT NULL,
  title text,
  location text,
  start_time time without time zone,
  end_time time without time zone,
  notes text,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT events_attendance_pkey PRIMARY KEY (id),
  CONSTRAINT events_attendance_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT events_attendance_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.exercise_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  workout_instance_id uuid NOT NULL,
  routine_exercise_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  exercise_id uuid NOT NULL,
  set_number integer NOT NULL CHECK (set_number > 0),
  target_sets integer,
  target_reps integer,
  target_duration_seconds integer,
  target_weight numeric,
  target_distance numeric,
  target_intensity_percent numeric,
  target_intensity_type text,
  actual_reps integer,
  actual_duration_seconds integer,
  actual_weight numeric,
  actual_distance numeric,
  metrics jsonb DEFAULT '{}'::jsonb,
  rpe integer CHECK (rpe >= 1 AND rpe <= 10),
  notes text,
  is_complete boolean DEFAULT true,
  logged_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  metric_data jsonb,
  org_id uuid,
  CONSTRAINT exercise_logs_pkey PRIMARY KEY (id),
  CONSTRAINT exercise_logs_workout_instance_id_fkey FOREIGN KEY (workout_instance_id) REFERENCES public.workout_instances(id),
  CONSTRAINT exercise_logs_routine_exercise_id_fkey FOREIGN KEY (routine_exercise_id) REFERENCES public.routine_exercises(id),
  CONSTRAINT exercise_logs_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT exercise_logs_exercise_id_fkey FOREIGN KEY (exercise_id) REFERENCES public.exercises(id)
);
CREATE TABLE public.exercise_tags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  categories ARRAY DEFAULT ARRAY[]::text[] CHECK (array_length(categories, 1) > 0),
  org_id uuid,
  CONSTRAINT exercise_tags_pkey PRIMARY KEY (id)
);
CREATE TABLE public.exercises (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  video_url text,
  cues ARRAY,
  equipment ARRAY,
  metric_schema jsonb,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  tags ARRAY,
  is_placeholder boolean DEFAULT false,
  created_by uuid,
  categories ARRAY DEFAULT ARRAY[]::text[] CHECK (array_length(categories, 1) > 0),
  org_id uuid NOT NULL,
  CONSTRAINT exercises_pkey PRIMARY KEY (id),
  CONSTRAINT exercises_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT exercises_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.feature_flags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  key text NOT NULL UNIQUE,
  is_enabled boolean NOT NULL DEFAULT false,
  env_scope text CHECK (env_scope = ANY (ARRAY['development'::text, 'preview'::text, 'production'::text, 'all'::text])),
  description text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT feature_flags_pkey PRIMARY KEY (id)
);
CREATE TABLE public.force_plate_percentiles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  test_type character varying NOT NULL CHECK (test_type::text = ANY (ARRAY['cmj'::character varying, 'sj'::character varying, 'hj'::character varying, 'ppu'::character varying, 'imtp'::character varying]::text[])),
  test_id character varying NOT NULL UNIQUE,
  test_date timestamp with time zone NOT NULL,
  play_level character varying NOT NULL CHECK (play_level::text = ANY (ARRAY['Youth'::character varying, 'High School'::character varying, 'College'::character varying, 'Pro'::character varying]::text[])),
  percentiles jsonb NOT NULL,
  sample_sizes jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT force_plate_percentiles_pkey PRIMARY KEY (id),
  CONSTRAINT force_plate_percentiles_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.grant_ledger (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  package_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  grant_source text NOT NULL CHECK (grant_source = ANY (ARRAY['manual_grant'::text, 'purchase'::text, 'membership_allocation'::text, 'bundle_component'::text])),
  granted_by uuid,
  sessions_granted integer,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT grant_ledger_pkey PRIMARY KEY (id),
  CONSTRAINT grant_ledger_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT grant_ledger_package_id_fkey FOREIGN KEY (package_id) REFERENCES public.packages(id),
  CONSTRAINT grant_ledger_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT grant_ledger_granted_by_fkey FOREIGN KEY (granted_by) REFERENCES auth.users(id)
);
CREATE TABLE public.group_invite_links (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  group_id uuid NOT NULL,
  org_id uuid NOT NULL,
  token text NOT NULL UNIQUE,
  name text,
  max_uses integer,
  current_uses integer NOT NULL DEFAULT 0,
  expires_at timestamp with time zone,
  is_active boolean NOT NULL DEFAULT true,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT group_invite_links_pkey PRIMARY KEY (id),
  CONSTRAINT group_invite_links_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id),
  CONSTRAINT group_invite_links_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.groups(id),
  CONSTRAINT group_invite_links_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.group_invite_signups (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  invite_link_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  signed_up_at timestamp with time zone NOT NULL DEFAULT now(),
  ip_address inet,
  user_agent text,
  org_id uuid,
  CONSTRAINT group_invite_signups_pkey PRIMARY KEY (id),
  CONSTRAINT group_invite_signups_invite_link_id_fkey FOREIGN KEY (invite_link_id) REFERENCES public.group_invite_links(id),
  CONSTRAINT group_invite_signups_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.group_members (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  group_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  role text DEFAULT 'member'::text,
  joined_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  source text DEFAULT 'manual'::text CHECK (source = ANY (ARRAY['manual'::text, 'membership'::text, 'bulk'::text])),
  membership_id uuid,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT group_members_pkey PRIMARY KEY (id),
  CONSTRAINT group_members_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.groups(id),
  CONSTRAINT group_members_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT group_members_membership_id_fkey FOREIGN KEY (membership_id) REFERENCES public.memberships(id),
  CONSTRAINT group_members_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.group_tags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  group_id uuid NOT NULL,
  tag text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT group_tags_pkey PRIMARY KEY (id),
  CONSTRAINT group_tags_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.groups(id)
);
CREATE TABLE public.group_workout_schedules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  group_id uuid NOT NULL,
  workout_id uuid NOT NULL,
  scheduled_date date NOT NULL,
  scheduled_time time without time zone,
  notes text,
  auto_assign boolean DEFAULT true,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT group_workout_schedules_pkey PRIMARY KEY (id),
  CONSTRAINT group_workout_schedules_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.groups(id),
  CONSTRAINT group_workout_schedules_workout_id_fkey FOREIGN KEY (workout_id) REFERENCES public.workouts(id),
  CONSTRAINT group_workout_schedules_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.groups (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  color text DEFAULT '#3b82f6'::text,
  is_active boolean DEFAULT true,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid NOT NULL,
  CONSTRAINT groups_pkey PRIMARY KEY (id),
  CONSTRAINT groups_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT groups_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.hittrax_raw_data (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_id uuid NOT NULL,
  raw_payload jsonb NOT NULL CHECK (jsonb_typeof(raw_payload) = 'object'::text),
  received_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT hittrax_raw_data_pkey PRIMARY KEY (id),
  CONSTRAINT hittrax_raw_data_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.hittrax_sessions(id)
);
CREATE TABLE public.hittrax_sessions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  athlete_name text NOT NULL,
  session_date timestamp with time zone NOT NULL,
  email_subject text NOT NULL,
  email_received_at timestamp with time zone NOT NULL,
  total_swings integer NOT NULL DEFAULT 0 CHECK (total_swings >= 0),
  contact_swings integer DEFAULT 0 CHECK (contact_swings >= 0),
  avg_exit_velocity numeric,
  max_exit_velocity numeric,
  avg_launch_angle numeric,
  avg_distance numeric,
  max_distance numeric,
  hard_hit_count integer DEFAULT 0,
  hard_hit_rate numeric,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT hittrax_sessions_pkey PRIMARY KEY (id),
  CONSTRAINT hittrax_sessions_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.hittrax_swings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_id uuid NOT NULL,
  swing_number integer NOT NULL CHECK (swing_number > 0),
  at_bat integer,
  swing_timestamp text,
  time_in_session text,
  exit_velocity numeric CHECK (exit_velocity IS NULL OR exit_velocity >= 0::numeric AND exit_velocity <= 120::numeric),
  launch_angle numeric CHECK (launch_angle IS NULL OR launch_angle >= '-90'::integer::numeric AND launch_angle <= 90::numeric),
  distance numeric CHECK (distance IS NULL OR distance >= 0::numeric AND distance <= 600::numeric),
  horizontal_angle numeric,
  result text,
  hit_type text,
  points integer,
  pitch_velocity numeric,
  pitch_type text,
  pitch_angle numeric,
  strike_zone integer,
  strike_zone_bottom numeric,
  strike_zone_top numeric,
  strike_zone_width numeric,
  vertical_distance numeric,
  horizontal_distance numeric,
  poi_x numeric,
  poi_y numeric,
  poi_z numeric,
  spray_chart_x numeric,
  spray_chart_z numeric,
  fielded_x numeric,
  fielded_z numeric,
  bat_material text,
  user_name text,
  batting_side text,
  level text,
  opposing_player text,
  tag text,
  created_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT hittrax_swings_pkey PRIMARY KEY (id),
  CONSTRAINT hittrax_swings_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.hittrax_sessions(id)
);
CREATE TABLE public.hj_tests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  test_id text NOT NULL UNIQUE,
  recorded_utc timestamp with time zone NOT NULL,
  recorded_timezone text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  body_weight_trial_value double precision,
  body_weight_trial_unit text,
  hop_best_rsi_trial_value double precision,
  hop_best_rsi_trial_unit text,
  hop_mean_rsi_trial_value double precision,
  hop_mean_rsi_trial_unit text,
  hop_best_jump_height_trial_value double precision,
  hop_best_jump_height_trial_unit text,
  hop_mean_jump_height_trial_value double precision,
  hop_mean_jump_height_trial_unit text,
  hop_best_contact_time_trial_value double precision,
  hop_best_contact_time_trial_unit text,
  hop_mean_contact_time_trial_value double precision,
  hop_mean_contact_time_trial_unit text,
  hop_fatigue_rsi_trial_value double precision,
  hop_fatigue_rsi_trial_unit text,
  body_weight_lbs_trial_unit text,
  body_weight_lbs_trial_value double precision,
  corrected_body_mass_trial_unit text,
  corrected_body_mass_trial_value double precision,
  hop_average_force_asymm_unit text,
  hop_average_force_asymm_value double precision,
  hop_average_force_left_unit text,
  hop_average_force_left_value double precision,
  hop_average_force_right_unit text,
  hop_average_force_right_value double precision,
  hop_average_force_trial_unit text,
  hop_average_force_trial_value double precision,
  hop_average_power_trial_unit text,
  hop_average_power_trial_value double precision,
  hop_best_average_force_asymm_unit text,
  hop_best_average_force_asymm_value double precision,
  hop_best_average_force_left_unit text,
  hop_best_average_force_left_value double precision,
  hop_best_average_force_right_unit text,
  hop_best_average_force_right_value double precision,
  hop_best_average_force_trial_unit text,
  hop_best_average_force_trial_value double precision,
  hop_best_average_power_trial_unit text,
  hop_best_average_power_trial_value double precision,
  hop_best_flight_time_trial_unit text,
  hop_best_flight_time_trial_value double precision,
  hop_best_impulse_asymm_unit text,
  hop_best_impulse_asymm_value double precision,
  hop_best_impulse_left_unit text,
  hop_best_impulse_left_value double precision,
  hop_best_impulse_right_unit text,
  hop_best_impulse_right_value double precision,
  hop_best_impulse_trial_unit text,
  hop_best_impulse_trial_value double precision,
  hop_best_landing_rfd_asymm_unit text,
  hop_best_landing_rfd_asymm_value double precision,
  hop_best_landing_rfd_left_unit text,
  hop_best_landing_rfd_left_value double precision,
  hop_best_landing_rfd_right_unit text,
  hop_best_landing_rfd_right_value double precision,
  hop_best_landing_rfd_trial_unit text,
  hop_best_landing_rfd_trial_value double precision,
  hop_best_landing_trial_unit text,
  hop_best_landing_trial_value double precision,
  hop_best_peak_force_asymm_unit text,
  hop_best_peak_force_asymm_value double precision,
  hop_best_peak_force_left_unit text,
  hop_best_peak_force_left_value double precision,
  hop_best_peak_force_right_unit text,
  hop_best_peak_force_right_value double precision,
  hop_best_peak_force_trial_unit text,
  hop_best_peak_force_trial_value double precision,
  hop_best_peak_power_trial_unit text,
  hop_best_peak_power_trial_value double precision,
  hop_best_rsi_jh_trial_unit text,
  hop_best_rsi_jh_trial_value double precision,
  hop_best_stiffness_asymm_unit text,
  hop_best_stiffness_asymm_value double precision,
  hop_best_stiffness_left_unit text,
  hop_best_stiffness_left_value double precision,
  hop_best_stiffness_right_unit text,
  hop_best_stiffness_right_value double precision,
  hop_best_stiffness_trial_unit text,
  hop_best_stiffness_trial_value double precision,
  hop_best_time_to_peak_force_asymm_unit text,
  hop_best_time_to_peak_force_asymm_value double precision,
  hop_best_time_to_peak_force_left_unit text,
  hop_best_time_to_peak_force_left_value double precision,
  hop_best_time_to_peak_force_right_unit text,
  hop_best_time_to_peak_force_right_value double precision,
  hop_best_time_to_peak_force_trial_unit text,
  hop_best_time_to_peak_force_trial_value double precision,
  hop_contact_time_trial_unit text,
  hop_contact_time_trial_value double precision,
  hop_fatigue_average_force_asymm_unit text,
  hop_fatigue_average_force_asymm_value double precision,
  hop_fatigue_average_force_left_unit text,
  hop_fatigue_average_force_left_value double precision,
  hop_fatigue_average_force_right_unit text,
  hop_fatigue_average_force_right_value double precision,
  hop_fatigue_average_force_trial_unit text,
  hop_fatigue_average_force_trial_value double precision,
  hop_fatigue_average_power_trial_unit text,
  hop_fatigue_average_power_trial_value double precision,
  hop_fatigue_contact_time_trial_unit text,
  hop_fatigue_contact_time_trial_value double precision,
  hop_fatigue_flight_time_trial_unit text,
  hop_fatigue_flight_time_trial_value double precision,
  hop_fatigue_impulse_asymm_unit text,
  hop_fatigue_impulse_asymm_value double precision,
  hop_fatigue_impulse_left_unit text,
  hop_fatigue_impulse_left_value double precision,
  hop_fatigue_impulse_right_unit text,
  hop_fatigue_impulse_right_value double precision,
  hop_fatigue_impulse_trial_unit text,
  hop_fatigue_impulse_trial_value double precision,
  hop_fatigue_jump_height_trial_unit text,
  hop_fatigue_jump_height_trial_value double precision,
  hop_fatigue_landing_rfd_asymm_unit text,
  hop_fatigue_landing_rfd_asymm_value double precision,
  hop_fatigue_landing_rfd_left_unit text,
  hop_fatigue_landing_rfd_left_value double precision,
  hop_fatigue_landing_rfd_right_unit text,
  hop_fatigue_landing_rfd_right_value double precision,
  hop_fatigue_landing_rfd_trial_unit text,
  hop_fatigue_landing_rfd_trial_value double precision,
  hop_fatigue_peak_force_asymm_unit text,
  hop_fatigue_peak_force_asymm_value double precision,
  hop_fatigue_peak_force_left_unit text,
  hop_fatigue_peak_force_left_value double precision,
  hop_fatigue_peak_force_right_unit text,
  hop_fatigue_peak_force_right_value double precision,
  hop_fatigue_peak_force_trial_unit text,
  hop_fatigue_peak_force_trial_value double precision,
  hop_fatigue_peak_power_trial_unit text,
  hop_fatigue_peak_power_trial_value double precision,
  hop_fatigue_rsi_jh_trial_unit text,
  hop_fatigue_rsi_jh_trial_value double precision,
  hop_fatigue_stiffness_asymm_unit text,
  hop_fatigue_stiffness_asymm_value double precision,
  hop_fatigue_stiffness_left_unit text,
  hop_fatigue_stiffness_left_value double precision,
  hop_fatigue_stiffness_right_unit text,
  hop_fatigue_stiffness_right_value double precision,
  hop_fatigue_stiffness_trial_unit text,
  hop_fatigue_stiffness_trial_value double precision,
  hop_fatigue_time_to_peak_force_asymm_unit text,
  hop_fatigue_time_to_peak_force_asymm_value double precision,
  hop_fatigue_time_to_peak_force_left_unit text,
  hop_fatigue_time_to_peak_force_left_value double precision,
  hop_fatigue_time_to_peak_force_right_unit text,
  hop_fatigue_time_to_peak_force_right_value double precision,
  hop_fatigue_time_to_peak_force_trial_unit text,
  hop_fatigue_time_to_peak_force_trial_value double precision,
  hop_flight_time_trial_unit text,
  hop_flight_time_trial_value double precision,
  hop_impulse_asymm_unit text,
  hop_impulse_asymm_value double precision,
  hop_impulse_left_unit text,
  hop_impulse_left_value double precision,
  hop_impulse_right_unit text,
  hop_impulse_right_value double precision,
  hop_impulse_trial_unit text,
  hop_impulse_trial_value double precision,
  hop_jump_height_trial_unit text,
  hop_jump_height_trial_value double precision,
  hop_landing_rfd_asymm_unit text,
  hop_landing_rfd_asymm_value double precision,
  hop_landing_rfd_left_unit text,
  hop_landing_rfd_left_value double precision,
  hop_landing_rfd_right_unit text,
  hop_landing_rfd_right_value double precision,
  hop_landing_rfd_trial_unit text,
  hop_landing_rfd_trial_value double precision,
  hop_mean_average_force_asymm_unit text,
  hop_mean_average_force_asymm_value double precision,
  hop_mean_average_force_left_unit text,
  hop_mean_average_force_left_value double precision,
  hop_mean_average_force_right_unit text,
  hop_mean_average_force_right_value double precision,
  hop_mean_average_force_trial_unit text,
  hop_mean_average_force_trial_value double precision,
  hop_mean_average_power_trial_unit text,
  hop_mean_average_power_trial_value double precision,
  hop_mean_flight_time_trial_unit text,
  hop_mean_flight_time_trial_value double precision,
  hop_mean_impulse_asymm_unit text,
  hop_mean_impulse_asymm_value double precision,
  hop_mean_impulse_left_unit text,
  hop_mean_impulse_left_value double precision,
  hop_mean_impulse_right_unit text,
  hop_mean_impulse_right_value double precision,
  hop_mean_impulse_trial_unit text,
  hop_mean_impulse_trial_value double precision,
  hop_mean_landing_rfd_asymm_unit text,
  hop_mean_landing_rfd_asymm_value double precision,
  hop_mean_landing_rfd_left_unit text,
  hop_mean_landing_rfd_left_value double precision,
  hop_mean_landing_rfd_right_unit text,
  hop_mean_landing_rfd_right_value double precision,
  hop_mean_landing_rfd_trial_unit text,
  hop_mean_landing_rfd_trial_value double precision,
  hop_mean_peak_force_asymm_unit text,
  hop_mean_peak_force_asymm_value double precision,
  hop_mean_peak_force_left_unit text,
  hop_mean_peak_force_left_value double precision,
  hop_mean_peak_force_right_unit text,
  hop_mean_peak_force_right_value double precision,
  hop_mean_peak_force_trial_unit text,
  hop_mean_peak_force_trial_value double precision,
  hop_mean_peak_power_trial_unit text,
  hop_mean_peak_power_trial_value double precision,
  hop_mean_rsi_jh_trial_unit text,
  hop_mean_rsi_jh_trial_value double precision,
  hop_mean_stiffness_asymm_unit text,
  hop_mean_stiffness_asymm_value double precision,
  hop_mean_stiffness_left_unit text,
  hop_mean_stiffness_left_value double precision,
  hop_mean_stiffness_right_unit text,
  hop_mean_stiffness_right_value double precision,
  hop_mean_stiffness_trial_unit text,
  hop_mean_stiffness_trial_value double precision,
  hop_mean_time_to_peak_force_asymm_unit text,
  hop_mean_time_to_peak_force_asymm_value double precision,
  hop_mean_time_to_peak_force_left_unit text,
  hop_mean_time_to_peak_force_left_value double precision,
  hop_mean_time_to_peak_force_right_unit text,
  hop_mean_time_to_peak_force_right_value double precision,
  hop_mean_time_to_peak_force_trial_unit text,
  hop_mean_time_to_peak_force_trial_value double precision,
  hop_peak_force_asymm_unit text,
  hop_peak_force_asymm_value double precision,
  hop_peak_force_left_unit text,
  hop_peak_force_left_value double precision,
  hop_peak_force_right_unit text,
  hop_peak_force_right_value double precision,
  hop_peak_force_trial_unit text,
  hop_peak_force_trial_value double precision,
  hop_peak_power_trial_unit text,
  hop_peak_power_trial_value double precision,
  hop_repeat_takeoff_trial_unit text,
  hop_repeat_takeoff_trial_value double precision,
  hop_rsi_jh_trial_unit text,
  hop_rsi_jh_trial_value double precision,
  hop_rsi_trial_unit text,
  hop_rsi_trial_value double precision,
  hop_stiffness_asymm_unit text,
  hop_stiffness_asymm_value double precision,
  hop_stiffness_left_unit text,
  hop_stiffness_left_value double precision,
  hop_stiffness_right_unit text,
  hop_stiffness_right_value double precision,
  hop_stiffness_trial_unit text,
  hop_stiffness_trial_value double precision,
  hop_time_to_peak_force_asymm_unit text,
  hop_time_to_peak_force_asymm_value double precision,
  hop_time_to_peak_force_left_unit text,
  hop_time_to_peak_force_left_value double precision,
  hop_time_to_peak_force_right_unit text,
  hop_time_to_peak_force_right_value double precision,
  hop_time_to_peak_force_trial_unit text,
  hop_time_to_peak_force_trial_value double precision,
  repeat_count_trial_unit text,
  repeat_count_trial_value double precision,
  repeat_duration_trial_unit text,
  repeat_duration_trial_value double precision,
  repeat_end_trial_unit text,
  repeat_end_trial_value double precision,
  repeat_fatigue_window_trial_unit text,
  repeat_fatigue_window_trial_value double precision,
  repeat_number_order_trial_unit text,
  repeat_number_order_trial_value double precision,
  repeat_start_trial_unit text,
  repeat_start_trial_value double precision,
  start_of_movement_asymm_unit text,
  start_of_movement_asymm_value double precision,
  start_of_movement_left_unit text,
  start_of_movement_left_value double precision,
  start_of_movement_right_unit text,
  start_of_movement_right_value double precision,
  start_of_movement_threshold_trial_unit text,
  start_of_movement_threshold_trial_value double precision,
  start_of_movement_trial_unit text,
  start_of_movement_trial_value double precision,
  play_level text,
  org_id uuid,
  test_number_at_level integer DEFAULT 1,
  source_system character varying DEFAULT 'vald'::character varying,
  CONSTRAINT hj_tests_pkey PRIMARY KEY (id),
  CONSTRAINT hj_tests_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.imtp_tests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  test_id text NOT NULL UNIQUE,
  recorded_utc timestamp with time zone NOT NULL,
  recorded_timezone text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  baseline_force_trial_value double precision,
  baseline_force_trial_unit text,
  peak_vertical_force_trial_value double precision,
  peak_vertical_force_trial_unit text,
  net_peak_vertical_force_trial_value double precision,
  net_peak_vertical_force_trial_unit text,
  relative_strength_trial_value double precision,
  relative_strength_trial_unit text,
  force_at_50ms_trial_value double precision,
  force_at_50ms_trial_unit text,
  force_at_100ms_trial_value double precision,
  force_at_100ms_trial_unit text,
  force_at_150ms_trial_value double precision,
  force_at_150ms_trial_unit text,
  force_at_200ms_trial_value double precision,
  force_at_200ms_trial_unit text,
  rfd_at_50ms_trial_value double precision,
  rfd_at_50ms_trial_unit text,
  rfd_at_100ms_trial_value double precision,
  rfd_at_100ms_trial_unit text,
  baseline_force_asymm_unit text,
  baseline_force_asymm_value double precision,
  baseline_force_left_unit text,
  baseline_force_left_value double precision,
  baseline_force_right_unit text,
  baseline_force_right_value double precision,
  bw_net_force_at_100ms_trial_unit text,
  bw_net_force_at_100ms_trial_value double precision,
  bw_net_force_at_150ms_trial_unit text,
  bw_net_force_at_150ms_trial_value double precision,
  bw_net_force_at_200ms_trial_unit text,
  bw_net_force_at_200ms_trial_value double precision,
  bw_net_force_at_50ms_trial_unit text,
  bw_net_force_at_50ms_trial_value double precision,
  bw_net_force_peak_trial_unit text,
  bw_net_force_peak_trial_value double precision,
  force_at_100ms_asymm_unit text,
  force_at_100ms_asymm_value double precision,
  force_at_100ms_left_unit text,
  force_at_100ms_left_value double precision,
  force_at_100ms_right_unit text,
  force_at_100ms_right_value double precision,
  force_at_150ms_asymm_unit text,
  force_at_150ms_asymm_value double precision,
  force_at_150ms_left_unit text,
  force_at_150ms_left_value double precision,
  force_at_150ms_right_unit text,
  force_at_150ms_right_value double precision,
  force_at_200ms_asymm_unit text,
  force_at_200ms_asymm_value double precision,
  force_at_200ms_left_unit text,
  force_at_200ms_left_value double precision,
  force_at_200ms_right_unit text,
  force_at_200ms_right_value double precision,
  force_at_50ms_asymm_unit text,
  force_at_50ms_asymm_value double precision,
  force_at_50ms_left_unit text,
  force_at_50ms_left_value double precision,
  force_at_50ms_right_unit text,
  force_at_50ms_right_value double precision,
  iso_abs_impulse_100_asymm_unit text,
  iso_abs_impulse_100_asymm_value double precision,
  iso_abs_impulse_100_left_unit text,
  iso_abs_impulse_100_left_value double precision,
  iso_abs_impulse_100_right_unit text,
  iso_abs_impulse_100_right_value double precision,
  iso_abs_impulse_100_trial_unit text,
  iso_abs_impulse_100_trial_value double precision,
  iso_abs_impulse_150_asymm_unit text,
  iso_abs_impulse_150_asymm_value double precision,
  iso_abs_impulse_150_left_unit text,
  iso_abs_impulse_150_left_value double precision,
  iso_abs_impulse_150_right_unit text,
  iso_abs_impulse_150_right_value double precision,
  iso_abs_impulse_150_trial_unit text,
  iso_abs_impulse_150_trial_value double precision,
  iso_abs_impulse_200_asymm_unit text,
  iso_abs_impulse_200_asymm_value double precision,
  iso_abs_impulse_200_left_unit text,
  iso_abs_impulse_200_left_value double precision,
  iso_abs_impulse_200_right_unit text,
  iso_abs_impulse_200_right_value double precision,
  iso_abs_impulse_200_trial_unit text,
  iso_abs_impulse_200_trial_value double precision,
  iso_abs_impulse_50_asymm_unit text,
  iso_abs_impulse_50_asymm_value double precision,
  iso_abs_impulse_50_left_unit text,
  iso_abs_impulse_50_left_value double precision,
  iso_abs_impulse_50_right_unit text,
  iso_abs_impulse_50_right_value double precision,
  iso_abs_impulse_50_trial_unit text,
  iso_abs_impulse_50_trial_value double precision,
  iso_abs_impulse_75_asymm_unit text,
  iso_abs_impulse_75_asymm_value double precision,
  iso_abs_impulse_75_left_unit text,
  iso_abs_impulse_75_left_value double precision,
  iso_abs_impulse_75_right_unit text,
  iso_abs_impulse_75_right_value double precision,
  iso_abs_impulse_75_trial_unit text,
  iso_abs_impulse_75_trial_value double precision,
  iso_bm_rel_force_100_trial_unit text,
  iso_bm_rel_force_100_trial_value double precision,
  iso_bm_rel_force_150_trial_unit text,
  iso_bm_rel_force_150_trial_value double precision,
  iso_bm_rel_force_200_trial_unit text,
  iso_bm_rel_force_200_trial_value double precision,
  iso_bm_rel_force_50_trial_unit text,
  iso_bm_rel_force_50_trial_value double precision,
  iso_bm_rel_force_peak_trial_unit text,
  iso_bm_rel_force_peak_trial_value double precision,
  iso_bw_rel_force_peak_trial_unit text,
  iso_bw_rel_force_peak_trial_value double precision,
  iso_net_impulse_100_trial_unit text,
  iso_net_impulse_100_trial_value double precision,
  iso_net_impulse_150_trial_unit text,
  iso_net_impulse_150_trial_value double precision,
  iso_net_impulse_200_trial_unit text,
  iso_net_impulse_200_trial_value double precision,
  iso_net_impulse_50_trial_unit text,
  iso_net_impulse_50_trial_value double precision,
  iso_net_impulse_75_trial_unit text,
  iso_net_impulse_75_trial_value double precision,
  net_force_at_100ms_asymm_unit text,
  net_force_at_100ms_asymm_value double precision,
  net_force_at_100ms_left_unit text,
  net_force_at_100ms_left_value double precision,
  net_force_at_100ms_right_unit text,
  net_force_at_100ms_right_value double precision,
  net_force_at_100ms_trial_unit text,
  net_force_at_100ms_trial_value double precision,
  net_force_at_150ms_asymm_unit text,
  net_force_at_150ms_asymm_value double precision,
  net_force_at_150ms_left_unit text,
  net_force_at_150ms_left_value double precision,
  net_force_at_150ms_right_unit text,
  net_force_at_150ms_right_value double precision,
  net_force_at_150ms_trial_unit text,
  net_force_at_150ms_trial_value double precision,
  net_force_at_200ms_asymm_unit text,
  net_force_at_200ms_asymm_value double precision,
  net_force_at_200ms_left_unit text,
  net_force_at_200ms_left_value double precision,
  net_force_at_200ms_right_unit text,
  net_force_at_200ms_right_value double precision,
  net_force_at_200ms_trial_unit text,
  net_force_at_200ms_trial_value double precision,
  net_force_at_50ms_asymm_unit text,
  net_force_at_50ms_asymm_value double precision,
  net_force_at_50ms_left_unit text,
  net_force_at_50ms_left_value double precision,
  net_force_at_50ms_right_unit text,
  net_force_at_50ms_right_value double precision,
  net_force_at_50ms_trial_unit text,
  net_force_at_50ms_trial_value double precision,
  net_peak_vertical_force_asymm_unit text,
  net_peak_vertical_force_asymm_value double precision,
  net_peak_vertical_force_left_unit text,
  net_peak_vertical_force_left_value double precision,
  net_peak_vertical_force_right_unit text,
  net_peak_vertical_force_right_value double precision,
  peak_vertical_force_asymm_unit text,
  peak_vertical_force_asymm_value double precision,
  peak_vertical_force_left_unit text,
  peak_vertical_force_left_value double precision,
  peak_vertical_force_right_unit text,
  peak_vertical_force_right_value double precision,
  rfd_100_150ms_asymm_unit text,
  rfd_100_150ms_asymm_value double precision,
  rfd_100_150ms_left_unit text,
  rfd_100_150ms_left_value double precision,
  rfd_100_150ms_right_unit text,
  rfd_100_150ms_right_value double precision,
  rfd_100_150ms_trial_unit text,
  rfd_100_150ms_trial_value double precision,
  rfd_100_200ms_asymm_unit text,
  rfd_100_200ms_asymm_value double precision,
  rfd_100_200ms_left_unit text,
  rfd_100_200ms_left_value double precision,
  rfd_100_200ms_right_unit text,
  rfd_100_200ms_right_value double precision,
  rfd_100_200ms_trial_unit text,
  rfd_100_200ms_trial_value double precision,
  rfd_150_200ms_asymm_unit text,
  rfd_150_200ms_asymm_value double precision,
  rfd_150_200ms_left_unit text,
  rfd_150_200ms_left_value double precision,
  rfd_150_200ms_right_unit text,
  rfd_150_200ms_right_value double precision,
  rfd_150_200ms_trial_unit text,
  rfd_150_200ms_trial_value double precision,
  rfd_50_100ms_asymm_unit text,
  rfd_50_100ms_asymm_value double precision,
  rfd_50_100ms_left_unit text,
  rfd_50_100ms_left_value double precision,
  rfd_50_100ms_right_unit text,
  rfd_50_100ms_right_value double precision,
  rfd_50_100ms_trial_unit text,
  rfd_50_100ms_trial_value double precision,
  rfd_at_100ms_asymm_unit text,
  rfd_at_100ms_asymm_value double precision,
  rfd_at_100ms_left_unit text,
  rfd_at_100ms_left_value double precision,
  rfd_at_100ms_right_unit text,
  rfd_at_100ms_right_value double precision,
  rfd_at_150ms_asymm_unit text,
  rfd_at_150ms_asymm_value double precision,
  rfd_at_150ms_left_unit text,
  rfd_at_150ms_left_value double precision,
  rfd_at_150ms_right_unit text,
  rfd_at_150ms_right_value double precision,
  rfd_at_150ms_trial_unit text,
  rfd_at_150ms_trial_value double precision,
  rfd_at_200ms_asymm_unit text,
  rfd_at_200ms_asymm_value double precision,
  rfd_at_200ms_left_unit text,
  rfd_at_200ms_left_value double precision,
  rfd_at_200ms_right_unit text,
  rfd_at_200ms_right_value double precision,
  rfd_at_200ms_trial_unit text,
  rfd_at_200ms_trial_value double precision,
  rfd_at_250ms_asymm_unit text,
  rfd_at_250ms_asymm_value double precision,
  rfd_at_250ms_left_unit text,
  rfd_at_250ms_left_value double precision,
  rfd_at_250ms_right_unit text,
  rfd_at_250ms_right_value double precision,
  rfd_at_250ms_trial_unit text,
  rfd_at_250ms_trial_value double precision,
  rfd_at_30ms_asymm_unit text,
  rfd_at_30ms_asymm_value double precision,
  rfd_at_30ms_left_unit text,
  rfd_at_30ms_left_value double precision,
  rfd_at_30ms_right_unit text,
  rfd_at_30ms_right_value double precision,
  rfd_at_30ms_trial_unit text,
  rfd_at_30ms_trial_value double precision,
  rfd_at_50ms_asymm_unit text,
  rfd_at_50ms_asymm_value double precision,
  rfd_at_50ms_left_unit text,
  rfd_at_50ms_left_value double precision,
  rfd_at_50ms_right_unit text,
  rfd_at_50ms_right_value double precision,
  rfd_at_75ms_asymm_unit text,
  rfd_at_75ms_asymm_value double precision,
  rfd_at_75ms_left_unit text,
  rfd_at_75ms_left_value double precision,
  rfd_at_75ms_right_unit text,
  rfd_at_75ms_right_value double precision,
  rfd_at_75ms_trial_unit text,
  rfd_at_75ms_trial_value double precision,
  start_of_movement_asymm_unit text,
  start_of_movement_asymm_value double precision,
  start_of_movement_left_unit text,
  start_of_movement_left_value double precision,
  start_of_movement_right_unit text,
  start_of_movement_right_value double precision,
  start_of_movement_trial_unit text,
  start_of_movement_trial_value double precision,
  start_to_80pc_peak_force_asymm_unit text,
  start_to_80pc_peak_force_asymm_value double precision,
  start_to_80pc_peak_force_left_unit text,
  start_to_80pc_peak_force_left_value double precision,
  start_to_80pc_peak_force_right_unit text,
  start_to_80pc_peak_force_right_value double precision,
  start_to_80pc_peak_force_trial_unit text,
  start_to_80pc_peak_force_trial_value double precision,
  start_to_peak_force_asymm_unit text,
  start_to_peak_force_asymm_value double precision,
  start_to_peak_force_left_unit text,
  start_to_peak_force_left_value double precision,
  start_to_peak_force_right_unit text,
  start_to_peak_force_right_value double precision,
  start_to_peak_force_trial_unit text,
  start_to_peak_force_trial_value double precision,
  play_level text,
  org_id uuid,
  test_number_at_level integer DEFAULT 1,
  source_system character varying DEFAULT 'vald'::character varying,
  CONSTRAINT imtp_tests_pkey PRIMARY KEY (id),
  CONSTRAINT imtp_tests_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.in_app_notifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  user_id uuid NOT NULL,
  notification_type text NOT NULL,
  title text NOT NULL,
  message text NOT NULL,
  action_url text,
  action_label text,
  is_read boolean DEFAULT false,
  read_at timestamp with time zone,
  priority text DEFAULT 'medium'::text CHECK (priority = ANY (ARRAY['critical'::text, 'high'::text, 'medium'::text, 'low'::text])),
  icon text,
  color text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  expires_at timestamp with time zone,
  CONSTRAINT in_app_notifications_pkey PRIMARY KEY (id),
  CONSTRAINT in_app_notifications_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT in_app_notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.instance_exercise_overrides (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  workout_instance_id uuid NOT NULL,
  routine_exercise_id uuid NOT NULL,
  override_exercise_id uuid NOT NULL,
  override_intensity_percent integer,
  override_notes text,
  created_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  org_id uuid,
  CONSTRAINT instance_exercise_overrides_pkey PRIMARY KEY (id),
  CONSTRAINT instance_exercise_overrides_workout_instance_id_fkey FOREIGN KEY (workout_instance_id) REFERENCES public.workout_instances(id),
  CONSTRAINT instance_exercise_overrides_routine_exercise_id_fkey FOREIGN KEY (routine_exercise_id) REFERENCES public.routine_exercises(id),
  CONSTRAINT instance_exercise_overrides_override_exercise_id_fkey FOREIGN KEY (override_exercise_id) REFERENCES public.exercises(id),
  CONSTRAINT instance_exercise_overrides_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.kpi_definitions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  description text,
  datatype USER-DEFINED NOT NULL,
  unit text,
  category text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT kpi_definitions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.lead_form_questions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  form_id uuid NOT NULL,
  is_required boolean DEFAULT false,
  sort_order integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  question_id uuid,
  CONSTRAINT lead_form_questions_pkey PRIMARY KEY (id),
  CONSTRAINT lead_form_questions_form_id_fkey FOREIGN KEY (form_id) REFERENCES public.lead_forms(id),
  CONSTRAINT lead_form_questions_question_id_fkey FOREIGN KEY (question_id) REFERENCES public.lead_questions(id)
);
CREATE TABLE public.lead_forms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  name character varying NOT NULL,
  slug character varying NOT NULL,
  description text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  waiver_id uuid,
  sort_order integer DEFAULT 0,
  CONSTRAINT lead_forms_pkey PRIMARY KEY (id),
  CONSTRAINT lead_forms_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT lead_forms_waiver_id_fkey FOREIGN KEY (waiver_id) REFERENCES public.waivers(id)
);
CREATE TABLE public.lead_questions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  question_text character varying NOT NULL,
  question_key character varying NOT NULL,
  question_type character varying NOT NULL DEFAULT 'text'::character varying,
  options jsonb,
  placeholder character varying,
  default_required boolean DEFAULT false,
  is_profile_field boolean DEFAULT false,
  profile_field_key character varying,
  is_active boolean DEFAULT true,
  sort_order integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT lead_questions_pkey PRIMARY KEY (id),
  CONSTRAINT lead_questions_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.leads (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  form_id uuid,
  email character varying,
  first_name character varying,
  last_name character varying,
  phone character varying,
  status character varying DEFAULT 'new'::character varying,
  source character varying,
  notes text,
  responses jsonb DEFAULT '{}'::jsonb,
  converted_at timestamp with time zone,
  converted_to_athlete_id uuid,
  converted_to_profile_id uuid,
  converted_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT leads_pkey PRIMARY KEY (id),
  CONSTRAINT leads_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT leads_form_id_fkey FOREIGN KEY (form_id) REFERENCES public.lead_forms(id),
  CONSTRAINT leads_converted_to_athlete_id_fkey FOREIGN KEY (converted_to_athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT leads_converted_to_profile_id_fkey FOREIGN KEY (converted_to_profile_id) REFERENCES public.profiles(id),
  CONSTRAINT leads_converted_by_fkey FOREIGN KEY (converted_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.membership_allocation_rules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  membership_type_id uuid NOT NULL,
  package_type_id uuid NOT NULL,
  quantity_per_cycle integer NOT NULL DEFAULT 1,
  activate_on text NOT NULL DEFAULT 'grant'::text CHECK (activate_on = ANY (ARRAY['grant'::text, 'booking'::text])),
  expiry_days_override integer,
  carryover_policy text DEFAULT 'none'::text CHECK (carryover_policy = ANY (ARRAY['none'::text, 'full'::text, 'limited'::text])),
  max_carryover_uses integer,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT membership_allocation_rules_pkey PRIMARY KEY (id),
  CONSTRAINT membership_allocation_rules_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT membership_allocation_rules_membership_type_id_fkey FOREIGN KEY (membership_type_id) REFERENCES public.membership_types(id),
  CONSTRAINT membership_allocation_rules_package_type_id_fkey FOREIGN KEY (package_type_id) REFERENCES public.package_types(id)
);
CREATE TABLE public.membership_grant_ledger (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  membership_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  cycle_start timestamp with time zone NOT NULL,
  cycle_end timestamp with time zone NOT NULL,
  package_ids_issued ARRAY,
  total_packages_issued integer NOT NULL DEFAULT 0,
  carryover_credits integer DEFAULT 0,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT membership_grant_ledger_pkey PRIMARY KEY (id),
  CONSTRAINT membership_grant_ledger_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT membership_grant_ledger_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.membership_groups (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  membership_type_id uuid NOT NULL,
  athlete_count integer DEFAULT 0,
  status text NOT NULL DEFAULT 'active'::text CHECK (status = ANY (ARRAY['active'::text, 'paused'::text, 'cancelled'::text, 'expired'::text])),
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT membership_groups_pkey PRIMARY KEY (id),
  CONSTRAINT membership_groups_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT membership_groups_membership_type_id_fkey FOREIGN KEY (membership_type_id) REFERENCES public.membership_types(id),
  CONSTRAINT membership_groups_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.membership_types (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  thumbnail_url text,
  billing_interval_count integer NOT NULL DEFAULT 1,
  trial_period_days integer DEFAULT 0,
  booking_window_days integer,
  proration_policy text DEFAULT 'none'::text CHECK (proration_policy = ANY (ARRAY['none'::text, 'always'::text, 'create_only'::text])),
  is_public boolean DEFAULT true,
  is_active boolean NOT NULL DEFAULT true,
  sale_start_date date,
  sale_end_date date,
  stripe_product_id text,
  stripe_price_id text,
  features jsonb,
  thank_you_message text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  duration_months integer,
  is_seasonal boolean NOT NULL DEFAULT false,
  season_start_date date,
  season_end_date date,
  billing_period text DEFAULT 'monthly'::text CHECK (billing_period = ANY (ARRAY['monthly'::text, 'quarterly'::text, 'annual'::text, 'one_time'::text])),
  price_amount integer DEFAULT 0,
  price_currency text DEFAULT 'USD'::text,
  is_purchasable boolean NOT NULL DEFAULT true,
  display_order integer,
  metadata jsonb,
  include_processing_fee boolean DEFAULT true,
  required_restriction_tag_ids ARRAY DEFAULT '{}'::uuid[],
  auto_assign_tag_id uuid,
  auto_assign_trigger character varying DEFAULT 'purchase'::character varying CHECK (auto_assign_trigger::text = ANY (ARRAY['purchase'::character varying, 'activation'::character varying]::text[])),
  auto_assign_lifecycle_on_purchase character varying CHECK (auto_assign_lifecycle_on_purchase::text = ANY (ARRAY['assessment_scheduled'::character varying, 'assessment_completed'::character varying, 'member'::character varying, 'cancelled_membership'::character varying]::text[])),
  auto_assign_lifecycle_on_activation character varying CHECK (auto_assign_lifecycle_on_activation::text = ANY (ARRAY['assessment_scheduled'::character varying, 'assessment_completed'::character varying, 'member'::character varying, 'cancelled_membership'::character varying]::text[])),
  auto_assign_lifecycle_on_cancellation character varying CHECK (auto_assign_lifecycle_on_cancellation::text = ANY (ARRAY['assessment_scheduled'::character varying, 'assessment_completed'::character varying, 'member'::character varying, 'cancelled_membership'::character varying]::text[])),
  auto_assign_coach_ids ARRAY DEFAULT '{}'::uuid[],
  auto_assign_group_ids ARRAY,
  auto_remove_from_group_ids ARRAY,
  enable_public_signup boolean NOT NULL DEFAULT false,
  stripe_account_id text,
  stripe_sync_status text,
  stripe_synced_at timestamp with time zone,
  CONSTRAINT membership_types_pkey PRIMARY KEY (id),
  CONSTRAINT membership_types_auto_assign_tag_id_fkey FOREIGN KEY (auto_assign_tag_id) REFERENCES public.restriction_tags(id),
  CONSTRAINT membership_types_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.membership_usage_counters (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  membership_id uuid NOT NULL,
  period_start timestamp with time zone NOT NULL,
  period_end timestamp with time zone NOT NULL,
  scope_type text NOT NULL CHECK (scope_type = ANY (ARRAY['category'::text, 'template'::text])),
  scope_id uuid NOT NULL,
  scope_name text,
  visits_allocated integer NOT NULL,
  visits_used integer NOT NULL DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT membership_usage_counters_pkey PRIMARY KEY (id),
  CONSTRAINT membership_usage_counters_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT membership_usage_counters_membership_id_fkey FOREIGN KEY (membership_id) REFERENCES public.memberships(id)
);
CREATE TABLE public.memberships (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  membership_type_id uuid NOT NULL,
  status text NOT NULL DEFAULT 'active'::text CHECK (status = ANY (ARRAY['trialing'::text, 'active'::text, 'paused'::text, 'past_due'::text, 'cancelled'::text, 'expired'::text])),
  current_period_start timestamp with time zone NOT NULL,
  current_period_end timestamp with time zone NOT NULL,
  next_billing_date timestamp with time zone,
  trial_start timestamp with time zone,
  trial_end timestamp with time zone,
  cancel_at_period_end boolean DEFAULT false,
  cancelled_at timestamp with time zone,
  cancelled_by uuid,
  cancellation_reason text,
  ended_at timestamp with time zone,
  paused_at timestamp with time zone,
  pause_reason text,
  resume_at timestamp with time zone,
  stripe_subscription_id text UNIQUE,
  stripe_customer_id text,
  stripe_latest_invoice_id text,
  usage_counters jsonb,
  notes text,
  started_at timestamp with time zone NOT NULL DEFAULT now(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  membership_group_id uuid,
  is_group_parent boolean DEFAULT false,
  pause_at timestamp with time zone,
  cancel_at timestamp with time zone,
  CONSTRAINT memberships_pkey PRIMARY KEY (id),
  CONSTRAINT memberships_membership_type_id_fkey FOREIGN KEY (membership_type_id) REFERENCES public.membership_types(id),
  CONSTRAINT memberships_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT memberships_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT memberships_cancelled_by_fkey FOREIGN KEY (cancelled_by) REFERENCES public.profiles(id),
  CONSTRAINT memberships_membership_group_id_fkey FOREIGN KEY (membership_group_id) REFERENCES public.membership_groups(id)
);
CREATE TABLE public.message_read_receipts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  message_id uuid NOT NULL,
  user_id uuid NOT NULL,
  read_at timestamp with time zone DEFAULT now(),
  CONSTRAINT message_read_receipts_pkey PRIMARY KEY (id),
  CONSTRAINT message_read_receipts_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.messages(id),
  CONSTRAINT message_read_receipts_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.messages (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  conversation_id uuid NOT NULL,
  sender_id uuid,
  content text NOT NULL,
  attachments jsonb,
  reply_to_id uuid,
  is_deleted boolean DEFAULT false,
  edited_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  is_system_message boolean DEFAULT false,
  system_message_type text,
  CONSTRAINT messages_pkey PRIMARY KEY (id),
  CONSTRAINT messages_conversation_id_fkey FOREIGN KEY (conversation_id) REFERENCES public.conversations(id),
  CONSTRAINT messages_reply_to_id_fkey FOREIGN KEY (reply_to_id) REFERENCES public.messages(id),
  CONSTRAINT messages_sender_id_fkey FOREIGN KEY (sender_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.notification_automation_rules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  event_category_id uuid,
  notification_type text NOT NULL,
  email_template_id uuid,
  is_enabled boolean DEFAULT true,
  send_to_athlete boolean DEFAULT true,
  send_to_parents boolean DEFAULT true,
  reminder_hours_before integer,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT notification_automation_rules_pkey PRIMARY KEY (id),
  CONSTRAINT notification_automation_rules_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT notification_automation_rules_event_category_id_fkey FOREIGN KEY (event_category_id) REFERENCES public.scheduling_categories(id),
  CONSTRAINT notification_automation_rules_email_template_id_fkey FOREIGN KEY (email_template_id) REFERENCES public.email_templates(id)
);
CREATE TABLE public.notification_delivery_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  queue_id uuid,
  org_id uuid NOT NULL,
  notification_type text NOT NULL,
  channel text NOT NULL,
  recipient_user_id uuid,
  recipient_email text,
  recipient_phone text,
  status text NOT NULL CHECK (status = ANY (ARRAY['sent'::text, 'delivered'::text, 'bounced'::text, 'failed'::text, 'opened'::text, 'clicked'::text])),
  external_id text,
  sent_at timestamp with time zone DEFAULT now(),
  delivered_at timestamp with time zone,
  opened_at timestamp with time zone,
  clicked_at timestamp with time zone,
  error_code text,
  error_message text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT notification_delivery_log_pkey PRIMARY KEY (id),
  CONSTRAINT notification_delivery_log_queue_id_fkey FOREIGN KEY (queue_id) REFERENCES public.notification_queue(id),
  CONSTRAINT notification_delivery_log_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT notification_delivery_log_recipient_user_id_fkey FOREIGN KEY (recipient_user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.notification_preferences (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  org_id uuid NOT NULL,
  notification_type text NOT NULL,
  email_enabled boolean DEFAULT true,
  sms_enabled boolean DEFAULT false,
  in_app_enabled boolean DEFAULT true,
  frequency text DEFAULT 'immediate'::text CHECK (frequency = ANY (ARRAY['immediate'::text, 'daily_digest'::text, 'weekly_digest'::text, 'disabled'::text])),
  digest_time time without time zone DEFAULT '08:00:00'::time without time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT notification_preferences_pkey PRIMARY KEY (id),
  CONSTRAINT notification_preferences_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT notification_preferences_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.notification_queue (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  notification_type text NOT NULL,
  template_id uuid,
  recipient_user_id uuid,
  recipient_email text,
  recipient_phone text,
  channel text NOT NULL CHECK (channel = ANY (ARRAY['email'::text, 'sms'::text, 'in_app'::text])),
  priority text DEFAULT 'medium'::text CHECK (priority = ANY (ARRAY['critical'::text, 'high'::text, 'medium'::text, 'low'::text])),
  scheduled_for timestamp with time zone DEFAULT now(),
  send_after timestamp with time zone,
  send_before timestamp with time zone,
  template_data jsonb DEFAULT '{}'::jsonb,
  metadata jsonb DEFAULT '{}'::jsonb,
  status text DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'processing'::text, 'sent'::text, 'failed'::text, 'cancelled'::text])),
  attempts integer DEFAULT 0,
  max_attempts integer DEFAULT 3,
  last_attempt_at timestamp with time zone,
  sent_at timestamp with time zone,
  failed_at timestamp with time zone,
  error_message text,
  idempotency_key text UNIQUE,
  external_id text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT notification_queue_pkey PRIMARY KEY (id),
  CONSTRAINT notification_queue_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT notification_queue_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.email_templates(id),
  CONSTRAINT notification_queue_recipient_user_id_fkey FOREIGN KEY (recipient_user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.notification_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  org_id uuid NOT NULL,
  email_booking_confirmations boolean DEFAULT true,
  email_booking_cancellations boolean DEFAULT true,
  email_event_deletions boolean DEFAULT true,
  email_session_reminders boolean DEFAULT true,
  reminder_24h_enabled boolean DEFAULT true,
  reminder_12h_enabled boolean DEFAULT true,
  reminder_3h_enabled boolean DEFAULT true,
  reminder_1h_enabled boolean DEFAULT true,
  email_commerce_notifications boolean DEFAULT true,
  email_admin_membership_created boolean DEFAULT true,
  email_admin_membership_cancelled boolean DEFAULT true,
  email_admin_package_granted boolean DEFAULT true,
  email_admin_package_cancelled boolean DEFAULT true,
  email_coach_new_booking boolean DEFAULT true,
  email_coach_booking_cancelled boolean DEFAULT true,
  sms_enabled boolean DEFAULT false,
  sms_session_reminders boolean DEFAULT false,
  in_app_enabled boolean DEFAULT true,
  push_enabled boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  push_booking_confirmations boolean DEFAULT true,
  push_booking_cancellations boolean DEFAULT true,
  push_session_reminders boolean DEFAULT true,
  push_messages boolean DEFAULT true,
  push_commerce boolean DEFAULT true,
  CONSTRAINT notification_settings_pkey PRIMARY KEY (id),
  CONSTRAINT notification_settings_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT notification_settings_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.notifications (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  org_id uuid NOT NULL,
  user_id uuid NOT NULL,
  type text NOT NULL CHECK (type = ANY (ARRAY['message'::text, 'booking'::text, 'assignment'::text, 'system'::text, 'announcement'::text])),
  title text NOT NULL,
  content text,
  action_url text,
  related_id uuid,
  is_read boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT notifications_pkey PRIMARY KEY (id),
  CONSTRAINT notifications_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.org_invite_links (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  token text NOT NULL UNIQUE,
  name text,
  max_uses integer,
  current_uses integer NOT NULL DEFAULT 0,
  expires_at timestamp with time zone,
  is_active boolean NOT NULL DEFAULT true,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT org_invite_links_pkey PRIMARY KEY (id),
  CONSTRAINT org_invite_links_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id),
  CONSTRAINT org_invite_links_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.org_invite_signups (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  invite_link_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  signed_up_at timestamp with time zone NOT NULL DEFAULT now(),
  ip_address inet,
  user_agent text,
  org_id uuid,
  CONSTRAINT org_invite_signups_pkey PRIMARY KEY (id),
  CONSTRAINT org_invite_signups_invite_link_id_fkey FOREIGN KEY (invite_link_id) REFERENCES public.org_invite_links(id),
  CONSTRAINT org_invite_signups_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.organizations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  slug text NOT NULL UNIQUE,
  timezone text DEFAULT 'America/New_York'::text,
  logo_url text,
  website text,
  phone text,
  email text,
  address_line1 text,
  address_line2 text,
  city text,
  state text,
  zip text,
  country text DEFAULT 'USA'::text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  email_provider text DEFAULT 'resend'::text,
  email_api_key text,
  email_from_address text,
  email_from_name text DEFAULT 'ASP BOOST'::text,
  vald_client_id text,
  vald_client_secret text,
  vald_tenant_id text,
  blast_motion_username text,
  blast_motion_password text,
  trackman_client_id text,
  trackman_client_secret text,
  trackman_scope text,
  membership boolean DEFAULT false,
  customer_id text,
  subscription_id text,
  subscription_identifier text,
  stripe_connect_account_id text,
  stripe_connect_charges_enabled boolean,
  stripe_connect_payouts_enabled boolean,
  stripe_platform_fee_percentage numeric,
  cumulative_revenue bigint NOT NULL DEFAULT '0'::bigint,
  CONSTRAINT organizations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.package_types (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  thumbnail_url text,
  uses integer,
  is_unlimited boolean DEFAULT (uses IS NULL),
  expiry_days integer,
  activation_policy text NOT NULL DEFAULT 'on_purchase'::text CHECK (activation_policy = ANY (ARRAY['on_purchase'::text, 'on_booking'::text])),
  eligible_category_ids ARRAY,
  eligible_template_ids ARRAY,
  eligible_location_ids ARRAY,
  limit_booking_days_ahead_override integer,
  allow_guests boolean DEFAULT false,
  max_guests integer DEFAULT 0,
  is_public boolean DEFAULT true,
  is_active boolean NOT NULL DEFAULT true,
  sale_start_date date,
  sale_end_date date,
  thank_you_message text,
  stripe_product_id text,
  stripe_price_id text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  is_grantable boolean NOT NULL DEFAULT true,
  display_order integer,
  is_purchasable boolean NOT NULL DEFAULT true,
  kind text NOT NULL DEFAULT 'package'::text CHECK (kind = ANY (ARRAY['package'::text, 'bundle'::text])),
  price_amount integer DEFAULT 0,
  price_currency text DEFAULT 'USD'::text,
  sessions_included integer,
  metadata jsonb,
  is_recurring boolean NOT NULL DEFAULT false,
  billing_interval text CHECK (billing_interval = ANY (ARRAY['weekly'::text, 'monthly'::text, 'quarterly'::text, 'annual'::text])),
  billing_interval_count integer DEFAULT 1,
  trial_days integer,
  auto_renew boolean NOT NULL DEFAULT true,
  is_seasonal boolean NOT NULL DEFAULT false,
  season_start_date date,
  season_end_date date,
  use_service_balance boolean NOT NULL DEFAULT false,
  include_processing_fee boolean DEFAULT true,
  required_restriction_tag_ids ARRAY DEFAULT '{}'::uuid[],
  auto_assign_tag_id uuid,
  auto_assign_trigger character varying DEFAULT 'purchase'::character varying CHECK (auto_assign_trigger::text = ANY (ARRAY['purchase'::character varying, 'activation'::character varying]::text[])),
  auto_assign_lifecycle_on_purchase character varying CHECK (auto_assign_lifecycle_on_purchase::text = ANY (ARRAY['assessment_scheduled'::character varying, 'assessment_completed'::character varying, 'member'::character varying, 'cancelled_membership'::character varying]::text[])),
  auto_assign_lifecycle_on_activation character varying CHECK (auto_assign_lifecycle_on_activation::text = ANY (ARRAY['assessment_scheduled'::character varying, 'assessment_completed'::character varying, 'member'::character varying, 'cancelled_membership'::character varying]::text[])),
  auto_assign_coach_ids ARRAY DEFAULT '{}'::uuid[],
  auto_assign_coach_trigger character varying DEFAULT 'purchase'::character varying CHECK (auto_assign_coach_trigger::text = ANY (ARRAY['purchase'::character varying, 'activation'::character varying]::text[])),
  enable_public_signup boolean NOT NULL DEFAULT false,
  stripe_account_id text,
  stripe_sync_status text,
  stripe_synced_at timestamp with time zone,
  CONSTRAINT package_types_pkey PRIMARY KEY (id),
  CONSTRAINT package_types_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT package_types_auto_assign_tag_id_fkey FOREIGN KEY (auto_assign_tag_id) REFERENCES public.restriction_tags(id)
);
CREATE TABLE public.package_usage_counters (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  package_id uuid NOT NULL,
  scope_type text NOT NULL CHECK (scope_type = ANY (ARRAY['category'::text, 'template'::text])),
  scope_id uuid NOT NULL,
  scope_name text,
  uses_allocated integer NOT NULL,
  uses_used integer NOT NULL DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT package_usage_counters_pkey PRIMARY KEY (id)
);
CREATE TABLE public.packages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  package_type_id uuid NOT NULL,
  uses_granted integer,
  uses_remaining integer,
  is_unlimited boolean DEFAULT (uses_granted IS NULL),
  status text NOT NULL DEFAULT 'active'::text CHECK (status = ANY (ARRAY['pending'::text, 'active'::text, 'expired'::text, 'depleted'::text, 'cancelled'::text])),
  activation_policy text NOT NULL,
  purchased_at timestamp with time zone NOT NULL DEFAULT now(),
  activated_at timestamp with time zone,
  expiry_date date,
  depleted_at timestamp with time zone,
  cancelled_at timestamp with time zone,
  cancelled_by uuid,
  cancellation_reason text,
  payment_id uuid,
  is_gift boolean DEFAULT false,
  gifted_by uuid,
  grant_reason text,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  is_subscription boolean NOT NULL DEFAULT false,
  current_period_start timestamp with time zone,
  current_period_end timestamp with time zone,
  next_billing_date timestamp with time zone,
  cancel_at_period_end boolean DEFAULT false,
  trial_start timestamp with time zone,
  trial_end timestamp with time zone,
  stripe_subscription_id text,
  stripe_customer_id text,
  assigned_by uuid,
  assignment_reason text,
  CONSTRAINT packages_pkey PRIMARY KEY (id),
  CONSTRAINT packages_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT packages_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT packages_package_type_id_fkey FOREIGN KEY (package_type_id) REFERENCES public.package_types(id),
  CONSTRAINT packages_cancelled_by_fkey FOREIGN KEY (cancelled_by) REFERENCES public.profiles(id),
  CONSTRAINT packages_gifted_by_fkey FOREIGN KEY (gifted_by) REFERENCES public.profiles(id),
  CONSTRAINT fk_packages_payment_id FOREIGN KEY (payment_id) REFERENCES public.payments(id),
  CONSTRAINT packages_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES auth.users(id)
);
CREATE TABLE public.payments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  athlete_id uuid,
  payer_email text,
  payer_name text,
  amount_cents integer NOT NULL,
  currency text NOT NULL DEFAULT 'usd'::text,
  tax_cents integer DEFAULT 0,
  total_cents integer DEFAULT (amount_cents + COALESCE(tax_cents, 0)),
  payment_method text NOT NULL CHECK (payment_method = ANY (ARRAY['stripe'::text, 'cash'::text, 'check'::text, 'bank_transfer'::text, 'comp'::text, 'other'::text])),
  stripe_payment_intent_id text,
  stripe_charge_id text,
  stripe_customer_id text,
  stripe_checkout_session_id text,
  status text NOT NULL DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'processing'::text, 'succeeded'::text, 'failed'::text, 'cancelled'::text, 'refunded'::text, 'partially_refunded'::text])),
  refund_amount_cents integer DEFAULT 0,
  refunded_at timestamp with time zone,
  refund_reason text,
  purchase_type text NOT NULL CHECK (purchase_type = ANY (ARRAY['package'::text, 'membership'::text, 'drop_in'::text, 'late_cancel_fee'::text, 'no_show_fee'::text, 'other'::text])),
  package_type_id uuid,
  event_id uuid,
  description text,
  receipt_url text,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  stripe_refund_id text,
  stripe_payment_method_id text,
  stripe_invoice_id text,
  processing_fee_cents integer DEFAULT 0,
  net_amount_cents integer,
  platform_fee_revenue integer,
  platform_fee_cents integer DEFAULT 0,
  CONSTRAINT payments_pkey PRIMARY KEY (id),
  CONSTRAINT payments_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT payments_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT payments_package_type_id_fkey FOREIGN KEY (package_type_id) REFERENCES public.package_types(id),
  CONSTRAINT payments_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.scheduling_events(id)
);
CREATE TABLE public.pitch_stuff_plus (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  pitch_uid text NOT NULL UNIQUE,
  athlete_id uuid NOT NULL,
  org_id uuid NOT NULL,
  stuff_plus double precision NOT NULL,
  whiff_probability double precision NOT NULL,
  pitch_type_group text NOT NULL,
  model_version text NOT NULL DEFAULT 'v1.0'::text,
  graded_at timestamp with time zone NOT NULL DEFAULT now(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT pitch_stuff_plus_pkey PRIMARY KEY (id),
  CONSTRAINT pitch_stuff_plus_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT pitch_stuff_plus_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.plan_assignments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  plan_id uuid,
  athlete_id uuid,
  start_date date NOT NULL,
  assigned_by uuid,
  assigned_at timestamp with time zone DEFAULT now(),
  is_active boolean DEFAULT true,
  org_id uuid,
  CONSTRAINT plan_assignments_pkey PRIMARY KEY (id),
  CONSTRAINT plan_assignments_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT plan_assignments_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.plan_reminders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  plan_id uuid NOT NULL,
  week_number integer NOT NULL,
  day_number integer NOT NULL CHECK (day_number >= 1 AND day_number <= 7),
  title text NOT NULL,
  description text,
  category text NOT NULL DEFAULT 'general'::text,
  color text NOT NULL DEFAULT '#9BDDFF'::text,
  icon text,
  org_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  created_by uuid,
  CONSTRAINT plan_reminders_pkey PRIMARY KEY (id),
  CONSTRAINT plan_reminders_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.training_plans(id)
);
CREATE TABLE public.plan_tags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  org_id uuid,
  CONSTRAINT plan_tags_pkey PRIMARY KEY (id)
);
CREATE TABLE public.ppu_tests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  test_id text NOT NULL UNIQUE,
  recorded_utc timestamp with time zone NOT NULL,
  recorded_timezone text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  body_weight_trial_value double precision,
  body_weight_trial_unit text,
  pushup_height_trial_value double precision,
  pushup_height_trial_unit text,
  pushup_depth_trial_value double precision,
  pushup_depth_trial_unit text,
  peak_takeoff_force_trial_value double precision,
  peak_takeoff_force_trial_unit text,
  peak_takeoff_power_trial_value double precision,
  peak_takeoff_power_trial_unit text,
  flight_time_trial_value double precision,
  flight_time_trial_unit text,
  beaking_concentric_duration_ratio_trial_unit text,
  beaking_concentric_duration_ratio_trial_value double precision,
  beaking_contraction_duration_ratio_trial_unit text,
  beaking_contraction_duration_ratio_trial_value double precision,
  begin_braking_phase_trial_unit text,
  begin_braking_phase_trial_value double precision,
  begin_concentric_phase_trial_unit text,
  begin_concentric_phase_trial_value double precision,
  begin_ecc_decel_phase_trial_unit text,
  begin_ecc_decel_phase_trial_value double precision,
  body_weight_lbs_trial_unit text,
  body_weight_lbs_trial_value double precision,
  bodymass_relative_mean_takeoff_force_trial_unit text,
  bodymass_relative_mean_takeoff_force_trial_value double precision,
  braking_phase_duration_trial_unit text,
  braking_phase_duration_trial_value double precision,
  concentric_duration_trial_unit text,
  concentric_duration_trial_value double precision,
  concentric_eccentric_duration_ratio_trial_unit text,
  concentric_eccentric_duration_ratio_trial_value double precision,
  concentric_rfd_100_asymm_unit text,
  concentric_rfd_100_asymm_value double precision,
  concentric_rfd_100_left_unit text,
  concentric_rfd_100_left_value double precision,
  concentric_rfd_100_right_unit text,
  concentric_rfd_100_right_value double precision,
  concentric_rfd_100_trial_unit text,
  concentric_rfd_100_trial_value double precision,
  concentric_rfd_200_asymm_unit text,
  concentric_rfd_200_asymm_value double precision,
  concentric_rfd_200_left_unit text,
  concentric_rfd_200_left_value double precision,
  concentric_rfd_200_right_unit text,
  concentric_rfd_200_right_value double precision,
  concentric_rfd_200_trial_unit text,
  concentric_rfd_200_trial_value double precision,
  concentric_rfd_50_asymm_unit text,
  concentric_rfd_50_asymm_value double precision,
  concentric_rfd_50_left_unit text,
  concentric_rfd_50_left_value double precision,
  concentric_rfd_50_right_unit text,
  concentric_rfd_50_right_value double precision,
  concentric_rfd_50_trial_unit text,
  concentric_rfd_50_trial_value double precision,
  concentric_rfd_asymm_unit text,
  concentric_rfd_asymm_value double precision,
  concentric_rfd_left_unit text,
  concentric_rfd_left_value double precision,
  concentric_rfd_right_unit text,
  concentric_rfd_right_value double precision,
  concentric_rfd_trial_unit text,
  concentric_rfd_trial_value double precision,
  contraction_time_trial_unit text,
  contraction_time_trial_value double precision,
  eccentric_accel_phase_duration_trial_unit text,
  eccentric_accel_phase_duration_trial_value double precision,
  eccentric_braking_rfd_100ms_asymm_unit text,
  eccentric_braking_rfd_100ms_asymm_value double precision,
  eccentric_braking_rfd_100ms_left_unit text,
  eccentric_braking_rfd_100ms_left_value double precision,
  eccentric_braking_rfd_100ms_right_unit text,
  eccentric_braking_rfd_100ms_right_value double precision,
  eccentric_braking_rfd_100ms_trial_unit text,
  eccentric_braking_rfd_100ms_trial_value double precision,
  eccentric_braking_rfd_asymm_unit text,
  eccentric_braking_rfd_asymm_value double precision,
  eccentric_braking_rfd_left_unit text,
  eccentric_braking_rfd_left_value double precision,
  eccentric_braking_rfd_right_unit text,
  eccentric_braking_rfd_right_value double precision,
  eccentric_braking_rfd_trial_unit text,
  eccentric_braking_rfd_trial_value double precision,
  eccentric_concentric_duration_ratio_trial_unit text,
  eccentric_concentric_duration_ratio_trial_value double precision,
  eccentric_decel_phase_duration_trial_unit text,
  eccentric_decel_phase_duration_trial_value double precision,
  eccentric_decel_rfd_asymm_unit text,
  eccentric_decel_rfd_asymm_value double precision,
  eccentric_decel_rfd_left_unit text,
  eccentric_decel_rfd_left_value double precision,
  eccentric_decel_rfd_right_unit text,
  eccentric_decel_rfd_right_value double precision,
  eccentric_decel_rfd_trial_unit text,
  eccentric_decel_rfd_trial_value double precision,
  eccentric_time_trial_unit text,
  eccentric_time_trial_value double precision,
  flight_contraction_time_ratio_trial_unit text,
  flight_contraction_time_ratio_trial_value double precision,
  flight_eccentric_time_ratio_trial_unit text,
  flight_eccentric_time_ratio_trial_value double precision,
  landing_rfd_50_trial_unit text,
  landing_rfd_50_trial_value double precision,
  landing_rfd_asymm_unit text,
  landing_rfd_asymm_value double precision,
  landing_rfd_left_unit text,
  landing_rfd_left_value double precision,
  landing_rfd_right_unit text,
  landing_rfd_right_value double precision,
  landing_rfd_trial_unit text,
  landing_rfd_trial_value double precision,
  mean_ecc_con_ratio_asymm_unit text,
  mean_ecc_con_ratio_asymm_value double precision,
  mean_ecc_con_ratio_left_unit text,
  mean_ecc_con_ratio_left_value double precision,
  mean_ecc_con_ratio_right_unit text,
  mean_ecc_con_ratio_right_value double precision,
  mean_ecc_con_ratio_trial_unit text,
  mean_ecc_con_ratio_trial_value double precision,
  mean_eccentric_braking_force_trial_unit text,
  mean_eccentric_braking_force_trial_value double precision,
  mean_eccentric_deceleration_force_trial_unit text,
  mean_eccentric_deceleration_force_trial_value double precision,
  mean_eccentric_force_asymm_unit text,
  mean_eccentric_force_asymm_value double precision,
  mean_eccentric_force_left_unit text,
  mean_eccentric_force_left_value double precision,
  mean_eccentric_force_right_unit text,
  mean_eccentric_force_right_value double precision,
  mean_eccentric_force_trial_unit text,
  mean_eccentric_force_trial_value double precision,
  mean_takeoff_force_asymm_unit text,
  mean_takeoff_force_asymm_value double precision,
  mean_takeoff_force_left_unit text,
  mean_takeoff_force_left_value double precision,
  mean_takeoff_force_right_unit text,
  mean_takeoff_force_right_value double precision,
  mean_takeoff_force_trial_unit text,
  mean_takeoff_force_trial_value double precision,
  min_eccentric_force_trial_unit text,
  min_eccentric_force_trial_value double precision,
  peak_concentric_force_asymm_unit text,
  peak_concentric_force_asymm_value double precision,
  peak_concentric_force_left_unit text,
  peak_concentric_force_left_value double precision,
  peak_concentric_force_right_unit text,
  peak_concentric_force_right_value double precision,
  peak_concentric_force_trial_unit text,
  peak_concentric_force_trial_value double precision,
  peak_eccentric_force_asymm_unit text,
  peak_eccentric_force_asymm_value double precision,
  peak_eccentric_force_left_unit text,
  peak_eccentric_force_left_value double precision,
  peak_eccentric_force_right_unit text,
  peak_eccentric_force_right_value double precision,
  peak_eccentric_force_trial_unit text,
  peak_eccentric_force_trial_value double precision,
  peak_landing_force_asymm_unit text,
  peak_landing_force_asymm_value double precision,
  peak_landing_force_left_unit text,
  peak_landing_force_left_value double precision,
  peak_landing_force_right_unit text,
  peak_landing_force_right_value double precision,
  peak_landing_force_trial_unit text,
  peak_landing_force_trial_value double precision,
  peak_takeoff_force_asymm_unit text,
  peak_takeoff_force_asymm_value double precision,
  peak_takeoff_force_left_unit text,
  peak_takeoff_force_left_value double precision,
  peak_takeoff_force_right_unit text,
  peak_takeoff_force_right_value double precision,
  pushup_height_inches_trial_unit text,
  pushup_height_inches_trial_value double precision,
  pushup_upper_body_mass_asymm_unit text,
  pushup_upper_body_mass_asymm_value double precision,
  pushup_upper_body_mass_end_trial_unit text,
  pushup_upper_body_mass_end_trial_value double precision,
  pushup_upper_body_mass_left_unit text,
  pushup_upper_body_mass_left_value double precision,
  pushup_upper_body_mass_right_unit text,
  pushup_upper_body_mass_right_value double precision,
  pushup_upper_body_mass_start_trial_unit text,
  pushup_upper_body_mass_start_trial_value double precision,
  pushup_upper_body_mass_trial_unit text,
  pushup_upper_body_mass_trial_value double precision,
  relative_concentric_rfd_trial_unit text,
  relative_concentric_rfd_trial_value double precision,
  relative_eccentric_braking_rfd_100ms_trial_unit text,
  relative_eccentric_braking_rfd_100ms_trial_value double precision,
  relative_eccentric_braking_rfd_trial_unit text,
  relative_eccentric_braking_rfd_trial_value double precision,
  relative_eccentric_decel_rfd_trial_unit text,
  relative_eccentric_decel_rfd_trial_value double precision,
  relative_peak_concentric_force_trial_unit text,
  relative_peak_concentric_force_trial_value double precision,
  relative_peak_eccentric_force_trial_unit text,
  relative_peak_eccentric_force_trial_value double precision,
  relative_peak_landing_force_trial_unit text,
  relative_peak_landing_force_trial_value double precision,
  relative_peak_takeoff_force_trial_unit text,
  relative_peak_takeoff_force_trial_value double precision,
  start_of_integration_trial_unit text,
  start_of_integration_trial_value double precision,
  start_of_movement_asymm_unit text,
  start_of_movement_asymm_value double precision,
  start_of_movement_left_unit text,
  start_of_movement_left_value double precision,
  start_of_movement_right_unit text,
  start_of_movement_right_value double precision,
  start_of_movement_threshold_trial_unit text,
  start_of_movement_threshold_trial_value double precision,
  start_of_movement_trial_unit text,
  start_of_movement_trial_value double precision,
  start_to_peak_force_time_trial_unit text,
  start_to_peak_force_time_trial_value double precision,
  time_to_braking_phase_trial_unit text,
  time_to_braking_phase_trial_value double precision,
  time_to_peak_force_asymm_unit text,
  time_to_peak_force_asymm_value double precision,
  time_to_peak_force_left_unit text,
  time_to_peak_force_left_value double precision,
  time_to_peak_force_right_unit text,
  time_to_peak_force_right_value double precision,
  time_to_peak_force_trial_unit text,
  time_to_peak_force_trial_value double precision,
  play_level text,
  concentric_rfd_max_trial_value numeric,
  concentric_rfd_max_trial_unit text,
  concentric_rfd_max_left_value numeric,
  concentric_rfd_max_left_unit text,
  concentric_rfd_max_right_value numeric,
  concentric_rfd_max_right_unit text,
  concentric_rfd_max_asymm_value numeric,
  concentric_rfd_max_asymm_unit text,
  org_id uuid,
  bw_rel_mean_takeoff_force_trial_value double precision,
  bw_rel_mean_takeoff_force_trial_unit text,
  bw_rel_peak_landing_force_trial_value double precision,
  bw_rel_peak_landing_force_trial_unit text,
  bw_rel_ecc_decel_mean_force_trial_value double precision,
  bw_rel_ecc_decel_mean_force_trial_unit text,
  bm_rel_ecc_decel_mean_force_trial_value double precision,
  bm_rel_ecc_decel_mean_force_trial_unit text,
  concentric_impulse_trial_value double precision,
  concentric_impulse_trial_unit text,
  concentric_impulse_left_value double precision,
  concentric_impulse_left_unit text,
  concentric_impulse_right_value double precision,
  concentric_impulse_right_unit text,
  concentric_impulse_asymm_value double precision,
  concentric_impulse_asymm_unit text,
  eccentric_impulse_trial_value double precision,
  eccentric_impulse_trial_unit text,
  eccentric_impulse_left_value double precision,
  eccentric_impulse_left_unit text,
  eccentric_impulse_right_value double precision,
  eccentric_impulse_right_unit text,
  eccentric_impulse_asymm_value double precision,
  eccentric_impulse_asymm_unit text,
  test_number_at_level integer DEFAULT 1,
  source_system character varying DEFAULT 'vald'::character varying,
  CONSTRAINT ppu_tests_pkey PRIMARY KEY (id),
  CONSTRAINT ppu_tests_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.prediction_models (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  model_name character varying NOT NULL UNIQUE,
  model_type character varying NOT NULL,
  model_version character varying NOT NULL,
  description text,
  algorithm character varying,
  performance_metrics jsonb,
  model_file_path character varying,
  preprocessor_file_path character varying,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT prediction_models_pkey PRIMARY KEY (id)
);
CREATE TABLE public.predictions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  model_id uuid NOT NULL,
  predicted_value numeric,
  predicted_class character varying,
  confidence_score numeric,
  prediction_details jsonb,
  input_features jsonb,
  feature_metadata jsonb,
  has_all_features boolean DEFAULT false,
  missing_features ARRAY,
  imputed_features ARRAY,
  predicted_at timestamp without time zone DEFAULT now(),
  predicted_value_low numeric,
  predicted_value_high numeric,
  input_cmj_peak_power numeric,
  input_cmj_relative_power numeric,
  input_sj_peak_power numeric,
  input_sj_relative_power numeric,
  input_imtp_peak_force numeric,
  input_imtp_relative_strength numeric,
  input_hj_mean_rsi numeric,
  input_ppu_peak_force numeric,
  input_body_weight_lbs numeric,
  CONSTRAINT predictions_pkey PRIMARY KEY (id),
  CONSTRAINT predictions_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT predictions_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT predictions_model_id_fkey FOREIGN KEY (model_id) REFERENCES public.prediction_models(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  email text NOT NULL UNIQUE,
  first_name text,
  last_name text,
  avatar_url text,
  app_role USER-DEFINED NOT NULL DEFAULT 'athlete'::app_role,
  phone text,
  timezone text DEFAULT 'America/New_York'::text,
  unit_system USER-DEFINED DEFAULT 'imperial'::unit_system,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid NOT NULL DEFAULT 'f5b702a1-7c8a-4c67-99f2-ef466cbbfb40'::uuid,
  messaging_restrictions text DEFAULT 'all_staff'::text CHECK (messaging_restrictions = ANY (ARRAY['all_staff'::text, 'assigned_coach'::text, 'admins_only'::text, 'no_restrictions'::text])),
  assigned_coach_id uuid,
  account_type text DEFAULT 'athlete'::text CHECK (account_type = ANY (ARRAY['athlete'::text, 'parent'::text])),
  account_status text DEFAULT 'active'::text CHECK (account_status = ANY (ARRAY['prospect'::text, 'active'::text, 'inactive'::text])),
  prospect_source text,
  converted_at timestamp with time zone,
  converted_by uuid,
  stripe_customer_id text,
  is_admin boolean DEFAULT false,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id),
  CONSTRAINT profiles_assigned_coach_id_fkey FOREIGN KEY (assigned_coach_id) REFERENCES public.profiles(id),
  CONSTRAINT profiles_converted_by_fkey FOREIGN KEY (converted_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.program_days (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  plan_id uuid NOT NULL,
  week_number integer NOT NULL CHECK (week_number > 0),
  day_number integer NOT NULL CHECK (day_number >= 1 AND day_number <= 7),
  workout_id uuid,
  order_index integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT program_days_pkey PRIMARY KEY (id),
  CONSTRAINT program_days_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.training_plans(id),
  CONSTRAINT program_days_workout_id_fkey FOREIGN KEY (workout_id) REFERENCES public.workouts(id)
);
CREATE TABLE public.push_tokens (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  device_token text NOT NULL UNIQUE,
  platform character varying NOT NULL CHECK (platform::text = ANY (ARRAY['ios'::character varying, 'android'::character varying, 'web'::character varying]::text[])),
  device_name text,
  app_version text,
  os_version text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  last_used_at timestamp with time zone DEFAULT now(),
  CONSTRAINT push_tokens_pkey PRIMARY KEY (id),
  CONSTRAINT push_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.relationships (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid,
  contact_a_id uuid,
  relation USER-DEFINED NOT NULL,
  contact_b_id uuid,
  athlete_id uuid,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT relationships_pkey PRIMARY KEY (id),
  CONSTRAINT relationships_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT relationships_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.reminder_assignments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  reminder_id uuid NOT NULL,
  org_id uuid NOT NULL,
  athlete_id uuid,
  group_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  start_date date,
  end_date date,
  CONSTRAINT reminder_assignments_pkey PRIMARY KEY (id),
  CONSTRAINT reminder_assignments_reminder_id_fkey FOREIGN KEY (reminder_id) REFERENCES public.reminders(id),
  CONSTRAINT reminder_assignments_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT reminder_assignments_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.groups(id)
);
CREATE TABLE public.reminder_completions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  reminder_id uuid NOT NULL,
  org_id uuid NOT NULL,
  athlete_id uuid,
  completed_by uuid NOT NULL,
  completion_date date NOT NULL,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  reminder_assignment_id uuid,
  user_type text DEFAULT 'coach'::text CHECK (user_type = ANY (ARRAY['coach'::text, 'athlete'::text, 'admin'::text, 'super_admin'::text])),
  occurrence_date date,
  completed_at timestamp with time zone DEFAULT now(),
  CONSTRAINT reminder_completions_pkey PRIMARY KEY (id),
  CONSTRAINT reminder_completions_reminder_id_fkey FOREIGN KEY (reminder_id) REFERENCES public.reminders(id),
  CONSTRAINT reminder_completions_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT reminder_completions_completed_by_fkey FOREIGN KEY (completed_by) REFERENCES public.profiles(id),
  CONSTRAINT reminder_completions_reminder_assignment_id_fkey FOREIGN KEY (reminder_assignment_id) REFERENCES public.reminder_assignments(id)
);
CREATE TABLE public.reminder_instances (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  reminder_id uuid NOT NULL,
  org_id uuid NOT NULL,
  athlete_id uuid,
  due_date date NOT NULL,
  is_completed boolean DEFAULT false,
  is_snoozed boolean DEFAULT false,
  snooze_until date,
  is_dismissed boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT reminder_instances_pkey PRIMARY KEY (id),
  CONSTRAINT reminder_instances_reminder_id_fkey FOREIGN KEY (reminder_id) REFERENCES public.reminders(id),
  CONSTRAINT reminder_instances_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.reminders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  created_by uuid NOT NULL,
  title text NOT NULL,
  description text,
  category text NOT NULL CHECK (category = ANY (ARRAY['milestone'::text, 'habit'::text, 'administrative'::text])),
  recurrence_type text NOT NULL CHECK (recurrence_type = ANY (ARRAY['once'::text, 'daily'::text, 'weekly'::text, 'biweekly'::text, 'monthly'::text, 'custom'::text])),
  recurrence_interval integer,
  recurrence_days ARRAY,
  start_date date,
  end_date date,
  visibility text NOT NULL CHECK (visibility = ANY (ARRAY['coach_only'::text, 'athlete_only'::text, 'both'::text, 'group'::text])),
  applies_to text NOT NULL CHECK (applies_to = ANY (ARRAY['specific_athletes'::text, 'specific_groups'::text, 'all_athletes'::text])),
  color text DEFAULT '#9BDDFF'::text,
  icon text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  priority text DEFAULT 'medium'::text CHECK (priority = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text])),
  CONSTRAINT reminders_pkey PRIMARY KEY (id),
  CONSTRAINT reminders_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.report_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid,
  created_by uuid,
  name text NOT NULL,
  description text,
  sections jsonb NOT NULL DEFAULT '[]'::jsonb,
  cover_page jsonb NOT NULL DEFAULT '{"showDate": true, "showLogo": true, "showSubtitle": true, "showAthletePhoto": true}'::jsonb,
  default_comparison_mode boolean DEFAULT false,
  is_system boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT report_templates_pkey PRIMARY KEY (id),
  CONSTRAINT report_templates_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT report_templates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.resources (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  uploaded_by uuid NOT NULL,
  message_id uuid,
  file_name text,
  file_type text,
  file_url text,
  file_size bigint,
  mime_type text,
  title text,
  description text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  notes text,
  resource_type character varying DEFAULT 'file'::character varying CHECK (resource_type::text = ANY (ARRAY['file'::character varying, 'bulletin'::character varying, 'note'::character varying]::text[])),
  pinned boolean DEFAULT false,
  category character varying,
  visibility character varying DEFAULT 'all'::character varying CHECK (visibility::text = ANY (ARRAY['all'::character varying, 'coaches_only'::character varying, 'athlete_only'::character varying]::text[])),
  is_group_resource boolean DEFAULT false,
  athlete_ids ARRAY,
  group_id uuid,
  CONSTRAINT resources_pkey PRIMARY KEY (id),
  CONSTRAINT resources_org_id_fkey1 FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT resources_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.profiles(id),
  CONSTRAINT resources_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.profiles(id),
  CONSTRAINT resources_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.messages(id),
  CONSTRAINT resources_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.groups(id)
);
CREATE TABLE public.restriction_tags (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  org_id uuid NOT NULL,
  name character varying NOT NULL,
  description text NOT NULL,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT restriction_tags_pkey PRIMARY KEY (id),
  CONSTRAINT restriction_tags_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.role_definitions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  role_type text NOT NULL CHECK (role_type = ANY (ARRAY['app_role'::text, 'staff_role'::text])),
  role_name text NOT NULL,
  display_name text NOT NULL,
  description text NOT NULL,
  scope text NOT NULL CHECK (scope = ANY (ARRAY['platform'::text, 'organization'::text, 'team'::text, 'self'::text])),
  hierarchy_level integer NOT NULL,
  permissions jsonb NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT role_definitions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.routine_exercises (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  routine_id uuid,
  exercise_id uuid,
  order_index integer NOT NULL,
  sets integer,
  reps_min integer,
  reps_max integer,
  time_seconds integer,
  percent_1rm numeric,
  percent_max_velo numeric,
  velocity_zone text,
  rpe_target integer CHECK (rpe_target >= 1 AND rpe_target <= 10),
  rest_seconds integer,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  is_placeholder boolean DEFAULT false,
  placeholder_id text,
  intensity_percent integer,
  intensity_type text,
  target_load numeric,
  target_rpe integer,
  target_time_seconds integer,
  target_reps text,
  set_configurations jsonb DEFAULT '[]'::jsonb,
  distance numeric,
  intensity_targets jsonb DEFAULT '[]'::jsonb,
  metric_targets jsonb DEFAULT '{}'::jsonb,
  placeholder_name text,
  enabled_measurements ARRAY,
  is_amrap boolean DEFAULT false,
  tracked_max_metrics ARRAY DEFAULT '{}'::text[],
  org_id uuid,
  tempo text,
  notes_only boolean DEFAULT false,
  CONSTRAINT routine_exercises_pkey PRIMARY KEY (id),
  CONSTRAINT routine_exercises_exercise_id_fkey FOREIGN KEY (exercise_id) REFERENCES public.exercises(id),
  CONSTRAINT routine_exercises_routine_id_fkey FOREIGN KEY (routine_id) REFERENCES public.routines(id)
);
CREATE TABLE public.routine_imports (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  workout_id uuid NOT NULL,
  source_routine_id uuid NOT NULL,
  imported_routine_id uuid NOT NULL,
  imported_at timestamp with time zone DEFAULT now(),
  imported_by uuid,
  org_id uuid,
  CONSTRAINT routine_imports_pkey PRIMARY KEY (id),
  CONSTRAINT routine_imports_workout_id_fkey FOREIGN KEY (workout_id) REFERENCES public.workouts(id),
  CONSTRAINT routine_imports_source_routine_id_fkey FOREIGN KEY (source_routine_id) REFERENCES public.routines(id),
  CONSTRAINT routine_imports_imported_routine_id_fkey FOREIGN KEY (imported_routine_id) REFERENCES public.routines(id),
  CONSTRAINT routine_imports_imported_by_fkey FOREIGN KEY (imported_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.routines (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  workout_id uuid,
  name text,
  order_index integer NOT NULL,
  set_scheme USER-DEFINED DEFAULT 'straight'::set_scheme,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  superset_block_name text,
  text_info text,
  scheme text NOT NULL DEFAULT 'straight'::text CHECK (scheme = ANY (ARRAY['straight'::text, 'superset'::text])),
  is_standalone boolean DEFAULT false,
  description text,
  created_by uuid,
  updated_at timestamp with time zone DEFAULT now(),
  placeholder_definitions jsonb DEFAULT '{"placeholders": []}'::jsonb,
  tags ARRAY DEFAULT '{}'::text[],
  category USER-DEFINED DEFAULT 'strength_conditioning'::workout_category,
  plan_id uuid,
  athlete_id uuid,
  source_routine_id uuid,
  group_id uuid,
  org_id uuid NOT NULL,
  CONSTRAINT routines_pkey PRIMARY KEY (id),
  CONSTRAINT routines_workout_id_fkey FOREIGN KEY (workout_id) REFERENCES public.workouts(id),
  CONSTRAINT routines_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT routines_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id),
  CONSTRAINT routines_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.training_plans(id),
  CONSTRAINT routines_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT routines_source_routine_id_fkey FOREIGN KEY (source_routine_id) REFERENCES public.routines(id),
  CONSTRAINT routines_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.groups(id)
);
CREATE TABLE public.scheduling_bookings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  event_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  status text NOT NULL DEFAULT 'booked'::text CHECK (status = ANY (ARRAY['booked'::text, 'waitlisted'::text, 'cancelled'::text, 'attended'::text, 'no_show'::text])),
  waitlist_position integer,
  package_id uuid,
  payment_id uuid,
  cancelled_at timestamp with time zone,
  cancelled_by uuid,
  cancellation_reason text,
  checked_in_at timestamp with time zone,
  checked_in_by uuid,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  source_type text CHECK (source_type = ANY (ARRAY['membership'::text, 'package'::text, 'drop_in'::text, 'comp'::text])),
  source_id uuid,
  CONSTRAINT scheduling_bookings_pkey PRIMARY KEY (id),
  CONSTRAINT event_bookings_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT event_bookings_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT event_bookings_cancelled_by_fkey FOREIGN KEY (cancelled_by) REFERENCES public.profiles(id),
  CONSTRAINT event_bookings_checked_in_by_fkey FOREIGN KEY (checked_in_by) REFERENCES public.profiles(id),
  CONSTRAINT scheduling_bookings_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.scheduling_events(id),
  CONSTRAINT fk_booking_package FOREIGN KEY (package_id) REFERENCES public.packages(id),
  CONSTRAINT fk_booking_payment FOREIGN KEY (payment_id) REFERENCES public.payments(id)
);
CREATE TABLE public.scheduling_categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  name text NOT NULL,
  color text NOT NULL DEFAULT '#3b82f6'::text,
  description text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  is_public boolean DEFAULT false,
  CONSTRAINT scheduling_categories_pkey PRIMARY KEY (id),
  CONSTRAINT event_categories_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.scheduling_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  event_template_id uuid NOT NULL,
  recurrence_rule_id uuid,
  start_time timestamp with time zone NOT NULL,
  end_time timestamp with time zone NOT NULL,
  location_id uuid NOT NULL,
  resource_id uuid,
  staff_id uuid,
  title text NOT NULL,
  description text,
  capacity integer NOT NULL,
  current_bookings integer NOT NULL DEFAULT 0,
  waitlist_count integer NOT NULL DEFAULT 0,
  status text NOT NULL DEFAULT 'scheduled'::text CHECK (status = ANY (ARRAY['scheduled'::text, 'in_progress'::text, 'completed'::text, 'cancelled'::text])),
  cancellation_reason text,
  cancelled_at timestamp with time zone,
  cancelled_by uuid,
  is_recurring boolean NOT NULL DEFAULT false,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  is_public boolean DEFAULT false,
  required_restriction_tag_ids ARRAY DEFAULT '{}'::uuid[],
  auto_assign_tag_id uuid,
  auto_assign_trigger text CHECK (auto_assign_trigger = ANY (ARRAY['booking'::text, 'attendance'::text])),
  auto_assign_lifecycle_on_booking text,
  auto_assign_lifecycle_on_attendance text,
  auto_assign_coach_ids ARRAY DEFAULT '{}'::uuid[],
  auto_assign_coach_trigger text CHECK (auto_assign_coach_trigger = ANY (ARRAY['booking'::text, 'attendance'::text])),
  CONSTRAINT scheduling_events_pkey PRIMARY KEY (id),
  CONSTRAINT events_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT events_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.scheduling_locations(id),
  CONSTRAINT events_resource_id_fkey FOREIGN KEY (resource_id) REFERENCES public.scheduling_resources(id),
  CONSTRAINT events_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.staff(id),
  CONSTRAINT events_cancelled_by_fkey FOREIGN KEY (cancelled_by) REFERENCES public.profiles(id),
  CONSTRAINT scheduling_events_template_id_fkey FOREIGN KEY (event_template_id) REFERENCES public.scheduling_templates(id),
  CONSTRAINT scheduling_events_recurrence_rule_id_fkey FOREIGN KEY (recurrence_rule_id) REFERENCES public.scheduling_recurrence_rules(id)
);
CREATE TABLE public.scheduling_locations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  name text NOT NULL,
  address_line1 text,
  address_line2 text,
  city text,
  state text,
  zip text,
  country text DEFAULT 'US'::text,
  timezone text NOT NULL DEFAULT 'America/New_York'::text,
  phone text,
  email text,
  capacity integer,
  operating_hours jsonb,
  amenities ARRAY,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT scheduling_locations_pkey PRIMARY KEY (id),
  CONSTRAINT locations_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.scheduling_policy_profiles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  booking_window_hours integer,
  max_booking_days_ahead integer,
  cancellation_window_hours integer,
  late_cancel_fee_cents integer,
  no_show_fee_cents integer,
  allow_rescheduling boolean DEFAULT true,
  reschedule_window_hours integer,
  max_reschedules_per_booking integer,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT scheduling_policy_profiles_pkey PRIMARY KEY (id),
  CONSTRAINT policy_profiles_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.scheduling_recurrence_rules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  event_template_id uuid,
  frequency text NOT NULL CHECK (frequency = ANY (ARRAY['daily'::text, 'weekly'::text, 'monthly'::text])),
  interval integer NOT NULL DEFAULT 1,
  days_of_week ARRAY,
  day_of_month integer,
  start_time time without time zone,
  end_time time without time zone,
  start_date date NOT NULL,
  end_date date,
  exception_dates ARRAY,
  staff_id uuid,
  location_id uuid,
  resource_id uuid,
  capacity_override integer,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  time_slots jsonb,
  CONSTRAINT scheduling_recurrence_rules_pkey PRIMARY KEY (id),
  CONSTRAINT recurrence_rules_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT recurrence_rules_event_template_id_fkey FOREIGN KEY (event_template_id) REFERENCES public.scheduling_templates(id),
  CONSTRAINT recurrence_rules_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.staff(id),
  CONSTRAINT recurrence_rules_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.scheduling_locations(id),
  CONSTRAINT recurrence_rules_resource_id_fkey FOREIGN KEY (resource_id) REFERENCES public.scheduling_resources(id)
);
CREATE TABLE public.scheduling_resources (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  location_id uuid NOT NULL,
  name text NOT NULL,
  resource_type text NOT NULL,
  capacity integer,
  equipment ARRAY,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT scheduling_resources_pkey PRIMARY KEY (id),
  CONSTRAINT resources_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT scheduling_resources_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.scheduling_locations(id)
);
CREATE TABLE public.scheduling_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  category_id uuid,
  duration_minutes integer NOT NULL,
  capacity integer NOT NULL,
  min_capacity integer DEFAULT 1,
  requires_staff boolean DEFAULT true,
  default_staff_id uuid,
  default_location_id uuid,
  default_resource_id uuid,
  policy_profile_id uuid,
  booking_window_hours integer,
  max_booking_days_ahead integer,
  drop_in_price_cents integer DEFAULT 0,
  is_public boolean DEFAULT true,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  required_restriction_tag_ids ARRAY DEFAULT '{}'::uuid[],
  auto_assign_tag_id uuid,
  auto_assign_trigger character varying DEFAULT 'attendance'::character varying CHECK (auto_assign_trigger::text = ANY (ARRAY['booking'::character varying, 'attendance'::character varying]::text[])),
  auto_assign_lifecycle_on_booking character varying CHECK (auto_assign_lifecycle_on_booking::text = ANY (ARRAY['assessment_scheduled'::character varying, 'assessment_completed'::character varying, 'member'::character varying, 'cancelled_membership'::character varying]::text[])),
  auto_assign_lifecycle_on_attendance character varying CHECK (auto_assign_lifecycle_on_attendance::text = ANY (ARRAY['assessment_scheduled'::character varying, 'assessment_completed'::character varying, 'member'::character varying, 'cancelled_membership'::character varying]::text[])),
  auto_assign_coach_ids ARRAY DEFAULT '{}'::uuid[],
  auto_assign_coach_trigger character varying DEFAULT NULL::character varying CHECK (auto_assign_coach_trigger::text = ANY (ARRAY['booking'::character varying, 'attendance'::character varying]::text[])),
  CONSTRAINT scheduling_templates_pkey PRIMARY KEY (id),
  CONSTRAINT event_templates_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT event_templates_default_staff_id_fkey FOREIGN KEY (default_staff_id) REFERENCES public.staff(id),
  CONSTRAINT event_templates_default_location_id_fkey FOREIGN KEY (default_location_id) REFERENCES public.scheduling_locations(id),
  CONSTRAINT event_templates_default_resource_id_fkey FOREIGN KEY (default_resource_id) REFERENCES public.scheduling_resources(id),
  CONSTRAINT scheduling_templates_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.scheduling_categories(id),
  CONSTRAINT scheduling_templates_policy_profile_id_fkey FOREIGN KEY (policy_profile_id) REFERENCES public.scheduling_policy_profiles(id),
  CONSTRAINT scheduling_templates_auto_assign_tag_id_fkey FOREIGN KEY (auto_assign_tag_id) REFERENCES public.restriction_tags(id)
);
CREATE TABLE public.set_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  workout_instance_id uuid NOT NULL,
  routine_exercise_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  exercise_id uuid NOT NULL,
  set_number integer NOT NULL,
  block_number integer NOT NULL DEFAULT 1,
  measurements jsonb NOT NULL DEFAULT '{}'::jsonb,
  rpe numeric,
  notes text,
  video_url text,
  is_potential_pr boolean DEFAULT false,
  pr_metric_id text,
  saved_as_max boolean DEFAULT false,
  logged_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT set_logs_pkey PRIMARY KEY (id),
  CONSTRAINT set_logs_workout_instance_id_fkey FOREIGN KEY (workout_instance_id) REFERENCES public.workout_instances(id),
  CONSTRAINT set_logs_routine_exercise_id_fkey FOREIGN KEY (routine_exercise_id) REFERENCES public.routine_exercises(id),
  CONSTRAINT set_logs_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT set_logs_exercise_id_fkey FOREIGN KEY (exercise_id) REFERENCES public.exercises(id)
);
CREATE TABLE public.sj_tests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid,
  test_id text NOT NULL UNIQUE,
  recorded_utc timestamp with time zone NOT NULL,
  recorded_timezone text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  start_of_movement_trial_value double precision,
  start_of_movement_trial_unit text,
  start_of_movement_threshold_trial_value double precision,
  start_of_movement_threshold_trial_unit text,
  start_of_integration_trial_value double precision,
  start_of_integration_trial_unit text,
  body_weight_trial_value double precision,
  body_weight_trial_unit text,
  body_weight_lbs_trial_value double precision,
  body_weight_lbs_trial_unit text,
  begin_concentric_phase_trial_value double precision,
  begin_concentric_phase_trial_unit text,
  countermovement_depth_trial_value double precision,
  countermovement_depth_trial_unit text,
  bodymass_relative_takeoff_power_trial_value double precision,
  bodymass_relative_takeoff_power_trial_unit text,
  flight_time_trial_value double precision,
  flight_time_trial_unit text,
  jump_height_trial_value double precision,
  jump_height_trial_unit text,
  jump_height_relative_landing_rfd_trial_value double precision,
  jump_height_relative_landing_rfd_trial_unit text,
  jump_height_relative_peak_landing_force_trial_value double precision,
  jump_height_relative_peak_landing_force_trial_unit text,
  impulse_jump_height_trial_value double precision,
  impulse_jump_height_trial_unit text,
  jump_height_imp_mom_trial_value double precision,
  jump_height_imp_mom_trial_unit text,
  landing_rfd_trial_value double precision,
  landing_rfd_trial_unit text,
  landing_rfd_left_value double precision,
  landing_rfd_left_unit text,
  landing_rfd_right_value double precision,
  landing_rfd_right_unit text,
  landing_rfd_asymm_value double precision,
  landing_rfd_asymm_unit text,
  jump_height_inches_trial_value double precision,
  jump_height_inches_trial_unit text,
  jump_height_inches_imp_mom_trial_value double precision,
  jump_height_inches_imp_mom_trial_unit text,
  mean_landing_acceleration_trial_value double precision,
  mean_landing_acceleration_trial_unit text,
  mean_landing_power_trial_value double precision,
  mean_landing_power_trial_unit text,
  mean_landing_velocity_trial_value double precision,
  mean_landing_velocity_trial_unit text,
  mean_takeoff_acceleration_trial_value double precision,
  mean_takeoff_acceleration_trial_unit text,
  mean_takeoff_force_trial_value double precision,
  mean_takeoff_force_trial_unit text,
  mean_takeoff_force_left_value double precision,
  mean_takeoff_force_left_unit text,
  mean_takeoff_force_right_value double precision,
  mean_takeoff_force_right_unit text,
  mean_takeoff_force_asymm_value double precision,
  mean_takeoff_force_asymm_unit text,
  mean_eccentric_force_trial_value double precision,
  mean_eccentric_force_trial_unit text,
  mean_eccentric_force_left_value double precision,
  mean_eccentric_force_left_unit text,
  mean_eccentric_force_right_value double precision,
  mean_eccentric_force_right_unit text,
  mean_eccentric_force_asymm_value double precision,
  mean_eccentric_force_asymm_unit text,
  mean_eccentric_power_trial_value double precision,
  mean_eccentric_power_trial_unit text,
  mean_ecc_con_ratio_trial_value double precision,
  mean_ecc_con_ratio_trial_unit text,
  mean_ecc_con_ratio_left_value double precision,
  mean_ecc_con_ratio_left_unit text,
  mean_ecc_con_ratio_right_value double precision,
  mean_ecc_con_ratio_right_unit text,
  mean_ecc_con_ratio_asymm_value double precision,
  mean_ecc_con_ratio_asymm_unit text,
  mean_concentric_power_trial_value double precision,
  mean_concentric_power_trial_unit text,
  bodymass_relative_mean_concentric_power_trial_value double precision,
  bodymass_relative_mean_concentric_power_trial_unit text,
  bodymass_relative_mean_eccentric_power_trial_value double precision,
  bodymass_relative_mean_eccentric_power_trial_unit text,
  mean_takeoff_velocity_trial_value double precision,
  mean_takeoff_velocity_trial_unit text,
  peak_landing_acceleration_trial_value double precision,
  peak_landing_acceleration_trial_unit text,
  peak_landing_force_trial_value double precision,
  peak_landing_force_trial_unit text,
  peak_landing_force_left_value double precision,
  peak_landing_force_left_unit text,
  peak_landing_force_right_value double precision,
  peak_landing_force_right_unit text,
  peak_landing_force_asymm_value double precision,
  peak_landing_force_asymm_unit text,
  peak_landing_power_trial_value double precision,
  peak_landing_power_trial_unit text,
  peak_landing_velocity_trial_value double precision,
  peak_landing_velocity_trial_unit text,
  peak_takeoff_acceleration_trial_value double precision,
  peak_takeoff_acceleration_trial_unit text,
  peak_takeoff_force_trial_value double precision,
  peak_takeoff_force_trial_unit text,
  peak_takeoff_force_left_value double precision,
  peak_takeoff_force_left_unit text,
  peak_takeoff_force_right_value double precision,
  peak_takeoff_force_right_unit text,
  peak_takeoff_force_asymm_value double precision,
  peak_takeoff_force_asymm_unit text,
  peak_takeoff_power_trial_value double precision,
  peak_takeoff_power_trial_unit text,
  peak_takeoff_velocity_trial_value double precision,
  peak_takeoff_velocity_trial_unit text,
  concentric_rfd_trial_value double precision,
  concentric_rfd_trial_unit text,
  concentric_rfd_left_value double precision,
  concentric_rfd_left_unit text,
  concentric_rfd_right_value double precision,
  concentric_rfd_right_unit text,
  concentric_rfd_asymm_value double precision,
  concentric_rfd_asymm_unit text,
  concentric_rfd_100_trial_value double precision,
  concentric_rfd_100_trial_unit text,
  concentric_rfd_100_left_value double precision,
  concentric_rfd_100_left_unit text,
  concentric_rfd_100_right_value double precision,
  concentric_rfd_100_right_unit text,
  concentric_rfd_100_asymm_value double precision,
  concentric_rfd_100_asymm_unit text,
  concentric_rfd_200_trial_value double precision,
  concentric_rfd_200_trial_unit text,
  concentric_rfd_200_left_value double precision,
  concentric_rfd_200_left_unit text,
  concentric_rfd_200_right_value double precision,
  concentric_rfd_200_right_unit text,
  concentric_rfd_200_asymm_value double precision,
  concentric_rfd_200_asymm_unit text,
  concentric_rfd_50_trial_value double precision,
  concentric_rfd_50_trial_unit text,
  concentric_rfd_50_left_value double precision,
  concentric_rfd_50_left_unit text,
  concentric_rfd_50_right_value double precision,
  concentric_rfd_50_right_unit text,
  concentric_rfd_50_asymm_value double precision,
  concentric_rfd_50_asymm_unit text,
  concentric_rfd_max_trial_value double precision,
  concentric_rfd_max_trial_unit text,
  concentric_rfd_max_left_value double precision,
  concentric_rfd_max_left_unit text,
  concentric_rfd_max_right_value double precision,
  concentric_rfd_max_right_unit text,
  concentric_rfd_max_asymm_value double precision,
  concentric_rfd_max_asymm_unit text,
  time_to_peak_force_trial_value double precision,
  time_to_peak_force_trial_unit text,
  time_to_peak_force_left_value double precision,
  time_to_peak_force_left_unit text,
  time_to_peak_force_right_value double precision,
  time_to_peak_force_right_unit text,
  time_to_peak_force_asymm_value double precision,
  time_to_peak_force_asymm_unit text,
  contraction_time_trial_value double precision,
  contraction_time_trial_unit text,
  eccentric_time_trial_value double precision,
  eccentric_time_trial_unit text,
  start_to_peak_force_time_trial_value double precision,
  start_to_peak_force_time_trial_unit text,
  start_to_peak_power_time_trial_value double precision,
  start_to_peak_power_time_trial_unit text,
  weight_relative_peak_landing_force_trial_value double precision,
  weight_relative_peak_landing_force_trial_unit text,
  weight_relative_peak_takeoff_force_trial_value double precision,
  weight_relative_peak_takeoff_force_trial_unit text,
  relative_concentric_rfd_trial_value double precision,
  relative_concentric_rfd_trial_unit text,
  takeoff_velocity_trial_value double precision,
  takeoff_velocity_trial_unit text,
  concentric_duration_trial_value double precision,
  concentric_duration_trial_unit text,
  concentric_eccentric_duration_ratio_trial_value double precision,
  concentric_eccentric_duration_ratio_trial_unit text,
  eccentric_concentric_duration_ratio_trial_value double precision,
  eccentric_concentric_duration_ratio_trial_unit text,
  flight_contraction_time_ratio_trial_value double precision,
  flight_contraction_time_ratio_trial_unit text,
  flight_eccentric_time_ratio_trial_value double precision,
  flight_eccentric_time_ratio_trial_unit text,
  begin_braking_phase_trial_value double precision,
  begin_braking_phase_trial_unit text,
  min_eccentric_force_trial_value double precision,
  min_eccentric_force_trial_unit text,
  braking_phase_duration_trial_value double precision,
  braking_phase_duration_trial_unit text,
  begin_ecc_decel_phase_trial_value double precision,
  begin_ecc_decel_phase_trial_unit text,
  time_to_braking_phase_trial_value double precision,
  time_to_braking_phase_trial_unit text,
  eccentric_accel_phase_duration_trial_value double precision,
  eccentric_accel_phase_duration_trial_unit text,
  eccentric_decel_phase_duration_trial_value double precision,
  eccentric_decel_phase_duration_trial_unit text,
  beaking_contraction_duration_ratio_trial_value double precision,
  beaking_contraction_duration_ratio_trial_unit text,
  beaking_concentric_duration_ratio_trial_value double precision,
  beaking_concentric_duration_ratio_trial_unit text,
  mean_eccentric_braking_force_trial_value double precision,
  mean_eccentric_braking_force_trial_unit text,
  mean_eccentric_deceleration_force_trial_value double precision,
  mean_eccentric_deceleration_force_trial_unit text,
  force_at_peak_power_trial_value double precision,
  force_at_peak_power_trial_unit text,
  force_at_peak_power_left_value double precision,
  force_at_peak_power_left_unit text,
  force_at_peak_power_right_value double precision,
  force_at_peak_power_right_unit text,
  force_at_peak_power_asymm_value double precision,
  force_at_peak_power_asymm_unit text,
  concentric_impulse_50ms_trial_value double precision,
  concentric_impulse_50ms_trial_unit text,
  concentric_impulse_50ms_left_value double precision,
  concentric_impulse_50ms_left_unit text,
  concentric_impulse_50ms_right_value double precision,
  concentric_impulse_50ms_right_unit text,
  concentric_impulse_50ms_asymm_value double precision,
  concentric_impulse_50ms_asymm_unit text,
  concentric_impulse_100ms_trial_value double precision,
  concentric_impulse_100ms_trial_unit text,
  concentric_impulse_100ms_left_value double precision,
  concentric_impulse_100ms_left_unit text,
  concentric_impulse_100ms_right_value double precision,
  concentric_impulse_100ms_right_unit text,
  concentric_impulse_100ms_asymm_value double precision,
  concentric_impulse_100ms_asymm_unit text,
  concentric_impulse_p1_trial_value double precision,
  concentric_impulse_p1_trial_unit text,
  concentric_impulse_p1_left_value double precision,
  concentric_impulse_p1_left_unit text,
  concentric_impulse_p1_right_value double precision,
  concentric_impulse_p1_right_unit text,
  concentric_impulse_p1_asymm_value double precision,
  concentric_impulse_p1_asymm_unit text,
  concentric_impulse_p2_trial_value double precision,
  concentric_impulse_p2_trial_unit text,
  concentric_impulse_p2_left_value double precision,
  concentric_impulse_p2_left_unit text,
  concentric_impulse_p2_right_value double precision,
  concentric_impulse_p2_right_unit text,
  concentric_impulse_p2_asymm_value double precision,
  concentric_impulse_p2_asymm_unit text,
  eccentric_braking_rfd_trial_value double precision,
  eccentric_braking_rfd_trial_unit text,
  eccentric_braking_rfd_left_value double precision,
  eccentric_braking_rfd_left_unit text,
  eccentric_braking_rfd_right_value double precision,
  eccentric_braking_rfd_right_unit text,
  eccentric_braking_rfd_asymm_value double precision,
  eccentric_braking_rfd_asymm_unit text,
  relative_eccentric_braking_rfd_trial_value double precision,
  relative_eccentric_braking_rfd_trial_unit text,
  eccentric_braking_rfd_100ms_trial_value double precision,
  eccentric_braking_rfd_100ms_trial_unit text,
  eccentric_braking_rfd_100ms_left_value double precision,
  eccentric_braking_rfd_100ms_left_unit text,
  eccentric_braking_rfd_100ms_right_value double precision,
  eccentric_braking_rfd_100ms_right_unit text,
  eccentric_braking_rfd_100ms_asymm_value double precision,
  eccentric_braking_rfd_100ms_asymm_unit text,
  relative_eccentric_braking_rfd_100ms_trial_value double precision,
  relative_eccentric_braking_rfd_100ms_trial_unit text,
  eccentric_decel_rfd_trial_value double precision,
  eccentric_decel_rfd_trial_unit text,
  eccentric_decel_rfd_left_value double precision,
  eccentric_decel_rfd_left_unit text,
  eccentric_decel_rfd_right_value double precision,
  eccentric_decel_rfd_right_unit text,
  eccentric_decel_rfd_asymm_value double precision,
  eccentric_decel_rfd_asymm_unit text,
  relative_eccentric_decel_rfd_trial_value double precision,
  relative_eccentric_decel_rfd_trial_unit text,
  relative_peak_takeoff_force_trial_value double precision,
  relative_peak_takeoff_force_trial_unit text,
  peak_concentric_force_trial_value double precision,
  peak_concentric_force_trial_unit text,
  peak_concentric_force_left_value double precision,
  peak_concentric_force_left_unit text,
  peak_concentric_force_right_value double precision,
  peak_concentric_force_right_unit text,
  peak_concentric_force_asymm_value double precision,
  peak_concentric_force_asymm_unit text,
  relative_peak_concentric_force_trial_value double precision,
  relative_peak_concentric_force_trial_unit text,
  peak_eccentric_force_trial_value double precision,
  peak_eccentric_force_trial_unit text,
  peak_eccentric_force_left_value double precision,
  peak_eccentric_force_left_unit text,
  peak_eccentric_force_right_value double precision,
  peak_eccentric_force_right_unit text,
  peak_eccentric_force_asymm_value double precision,
  peak_eccentric_force_asymm_unit text,
  relative_peak_eccentric_force_trial_value double precision,
  relative_peak_eccentric_force_trial_unit text,
  relative_peak_landing_force_trial_value double precision,
  relative_peak_landing_force_trial_unit text,
  mean_ecc_con_power_time_trial_value double precision,
  mean_ecc_con_power_time_trial_unit text,
  lower_limb_stiffness_trial_value double precision,
  lower_limb_stiffness_trial_unit text,
  concentric_rpd_trial_value double precision,
  concentric_rpd_trial_unit text,
  relative_concentric_rpd_trial_value double precision,
  relative_concentric_rpd_trial_unit text,
  concentric_rpd_50ms_trial_value double precision,
  concentric_rpd_50ms_trial_unit text,
  relative_concentric_rpd_50ms_trial_value double precision,
  relative_concentric_rpd_50ms_trial_unit text,
  concentric_rpd_100ms_trial_value double precision,
  concentric_rpd_100ms_trial_unit text,
  relative_concentric_rpd_100ms_trial_value double precision,
  relative_concentric_rpd_100ms_trial_unit text,
  rsi_modified_trial_value double precision,
  rsi_modified_trial_unit text,
  total_work_trial_value double precision,
  total_work_trial_unit text,
  velocity_at_peak_power_trial_value double precision,
  velocity_at_peak_power_trial_unit text,
  eccentric_peak_velocity_trial_value double precision,
  eccentric_peak_velocity_trial_unit text,
  eccentric_peak_power_trial_value double precision,
  eccentric_peak_power_trial_unit text,
  eccentric_braking_impulse_trial_value double precision,
  eccentric_braking_impulse_trial_unit text,
  eccentric_braking_impulse_left_value double precision,
  eccentric_braking_impulse_left_unit text,
  eccentric_braking_impulse_right_value double precision,
  eccentric_braking_impulse_right_unit text,
  eccentric_braking_impulse_asymm_value double precision,
  eccentric_braking_impulse_asymm_unit text,
  eccentric_decel_impulse_trial_value double precision,
  eccentric_decel_impulse_trial_unit text,
  eccentric_decel_impulse_left_value double precision,
  eccentric_decel_impulse_left_unit text,
  eccentric_decel_impulse_right_value double precision,
  eccentric_decel_impulse_right_unit text,
  eccentric_decel_impulse_asymm_value double precision,
  eccentric_decel_impulse_asymm_unit text,
  concentric_impulse_trial_value double precision,
  concentric_impulse_trial_unit text,
  concentric_impulse_left_value double precision,
  concentric_impulse_left_unit text,
  concentric_impulse_right_value double precision,
  concentric_impulse_right_unit text,
  concentric_impulse_asymm_value double precision,
  concentric_impulse_asymm_unit text,
  force_at_zero_velocity_trial_value double precision,
  force_at_zero_velocity_trial_unit text,
  force_at_zero_velocity_left_value double precision,
  force_at_zero_velocity_left_unit text,
  force_at_zero_velocity_right_value double precision,
  force_at_zero_velocity_right_unit text,
  force_at_zero_velocity_asymm_value double precision,
  force_at_zero_velocity_asymm_unit text,
  positive_impulse_trial_value double precision,
  positive_impulse_trial_unit text,
  positive_impulse_left_value double precision,
  positive_impulse_left_unit text,
  positive_impulse_right_value double precision,
  positive_impulse_right_unit text,
  positive_impulse_asymm_value double precision,
  positive_impulse_asymm_unit text,
  eccentric_unloading_impulse_trial_value double precision,
  eccentric_unloading_impulse_trial_unit text,
  eccentric_unloading_impulse_left_value double precision,
  eccentric_unloading_impulse_left_unit text,
  eccentric_unloading_impulse_right_value double precision,
  eccentric_unloading_impulse_right_unit text,
  eccentric_unloading_impulse_asymm_value double precision,
  eccentric_unloading_impulse_asymm_unit text,
  positive_takeoff_impulse_trial_value double precision,
  positive_takeoff_impulse_trial_unit text,
  positive_takeoff_impulse_left_value double precision,
  positive_takeoff_impulse_left_unit text,
  positive_takeoff_impulse_right_value double precision,
  positive_takeoff_impulse_right_unit text,
  positive_takeoff_impulse_asymm_value double precision,
  positive_takeoff_impulse_asymm_unit text,
  cmj_stiffness_trial_value double precision,
  cmj_stiffness_trial_unit text,
  cmj_stiffness_left_value double precision,
  cmj_stiffness_left_unit text,
  cmj_stiffness_right_value double precision,
  cmj_stiffness_right_unit text,
  cmj_stiffness_asymm_value double precision,
  cmj_stiffness_asymm_unit text,
  bodymass_relative_mean_takeoff_force_trial_value double precision,
  bodymass_relative_mean_takeoff_force_trial_unit text,
  bodymass_relative_eccentric_peak_power_trial_value double precision,
  bodymass_relative_eccentric_peak_power_trial_unit text,
  ecc_con_peak_power_ratio_trial_value double precision,
  ecc_con_peak_power_ratio_trial_unit text,
  con_p2_con_p1_impulse_ratio_trial_value double precision,
  con_p2_con_p1_impulse_ratio_trial_unit text,
  con_p2_con_p1_impulse_ratio_left_value double precision,
  con_p2_con_p1_impulse_ratio_left_unit text,
  con_p2_con_p1_impulse_ratio_right_value double precision,
  con_p2_con_p1_impulse_ratio_right_unit text,
  con_p2_con_p1_impulse_ratio_asymm_value double precision,
  con_p2_con_p1_impulse_ratio_asymm_unit text,
  con_100ms_con_impulse_ratio_trial_value double precision,
  con_100ms_con_impulse_ratio_trial_unit text,
  con_100ms_con_impulse_ratio_left_value double precision,
  con_100ms_con_impulse_ratio_left_unit text,
  con_100ms_con_impulse_ratio_right_value double precision,
  con_100ms_con_impulse_ratio_right_unit text,
  con_100ms_con_impulse_ratio_asymm_value double precision,
  con_100ms_con_impulse_ratio_asymm_unit text,
  landing_impulse_trial_value double precision,
  landing_impulse_trial_unit text,
  landing_impulse_left_value double precision,
  landing_impulse_left_unit text,
  landing_impulse_right_value double precision,
  landing_impulse_right_unit text,
  landing_impulse_asymm_value double precision,
  landing_impulse_asymm_unit text,
  landing_rfd_50_trial_value double precision,
  landing_rfd_50_trial_unit text,
  bodymass_relative_ecc_decel_impulse_trial_value double precision,
  bodymass_relative_ecc_decel_impulse_trial_unit text,
  displacement_at_takeoff_trial_value double precision,
  displacement_at_takeoff_trial_unit text,
  bm_rel_force_at_zero_velocity_trial_value double precision,
  bm_rel_force_at_zero_velocity_trial_unit text,
  rsi_modified_imp_mom_trial_value double precision,
  rsi_modified_imp_mom_trial_unit text,
  bm_rel_abs_con_impulse_trial_value double precision,
  bm_rel_abs_con_impulse_trial_unit text,
  play_level text,
  org_id uuid,
  bw_rel_mean_takeoff_force_trial_value double precision,
  bw_rel_mean_takeoff_force_trial_unit text,
  bw_rel_peak_landing_force_trial_value double precision,
  bw_rel_peak_landing_force_trial_unit text,
  test_number_at_level integer DEFAULT 1,
  source_system character varying DEFAULT 'vald'::character varying,
  CONSTRAINT sj_tests_pkey PRIMARY KEY (id)
);
CREATE TABLE public.staff (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  org_id uuid,
  role USER-DEFINED NOT NULL,
  title text,
  bio text,
  certifications ARRAY,
  hire_date date,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT staff_pkey PRIMARY KEY (id),
  CONSTRAINT staff_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT staff_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.staff_groups (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  staff_id uuid NOT NULL,
  group_id uuid NOT NULL,
  role text DEFAULT 'member'::text CHECK (role = ANY (ARRAY['owner'::text, 'member'::text])),
  created_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT staff_groups_pkey PRIMARY KEY (id),
  CONSTRAINT staff_groups_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.profiles(id),
  CONSTRAINT staff_groups_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.groups(id)
);
CREATE TABLE public.staff_permissions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  staff_id uuid NOT NULL UNIQUE,
  exercises_visibility text DEFAULT 'own_and_admin'::text CHECK (exercises_visibility = ANY (ARRAY['own'::text, 'own_and_admin'::text, 'all'::text])),
  workouts_visibility text DEFAULT 'own_and_admin'::text CHECK (workouts_visibility = ANY (ARRAY['own'::text, 'own_and_admin'::text, 'all'::text])),
  routines_visibility text DEFAULT 'own_and_admin'::text CHECK (routines_visibility = ANY (ARRAY['own'::text, 'own_and_admin'::text, 'all'::text])),
  athletes_visibility text DEFAULT 'assigned'::text CHECK (athletes_visibility = ANY (ARRAY['assigned'::text, 'all'::text])),
  can_create_exercises boolean DEFAULT true,
  can_edit_own_exercises boolean DEFAULT true,
  can_delete_own_exercises boolean DEFAULT false,
  can_edit_admin_exercises boolean DEFAULT false,
  can_create_workouts boolean DEFAULT true,
  can_edit_own_workouts boolean DEFAULT true,
  can_delete_own_workouts boolean DEFAULT false,
  can_edit_admin_workouts boolean DEFAULT false,
  can_create_routines boolean DEFAULT true,
  can_edit_own_routines boolean DEFAULT true,
  can_delete_own_routines boolean DEFAULT false,
  can_edit_admin_routines boolean DEFAULT false,
  can_assign_coaches boolean DEFAULT false,
  can_edit_athlete_profile boolean DEFAULT true,
  can_delete_athletes boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  can_view_staff boolean DEFAULT true,
  can_manage_staff boolean DEFAULT false,
  can_view_all_staff boolean DEFAULT true,
  can_assign_permissions boolean DEFAULT false,
  can_view_groups boolean DEFAULT true,
  can_create_groups boolean DEFAULT true,
  can_edit_own_groups boolean DEFAULT true,
  can_edit_all_groups boolean DEFAULT false,
  can_delete_own_groups boolean DEFAULT false,
  can_delete_all_groups boolean DEFAULT false,
  can_assign_athletes_to_groups boolean DEFAULT true,
  groups_visibility text DEFAULT 'all'::text CHECK (groups_visibility = ANY (ARRAY['own'::text, 'assigned'::text, 'all'::text])),
  plans_visibility text DEFAULT 'own_and_admin'::text CHECK (plans_visibility = ANY (ARRAY['own'::text, 'own_and_admin'::text, 'all'::text])),
  can_create_plans boolean DEFAULT true,
  can_edit_own_plans boolean DEFAULT true,
  can_edit_admin_plans boolean DEFAULT false,
  can_delete_own_plans boolean DEFAULT false,
  can_delete_admin_plans boolean DEFAULT false,
  can_delete_admin_exercises boolean DEFAULT false,
  can_delete_admin_workouts boolean DEFAULT false,
  can_delete_admin_routines boolean DEFAULT false,
  can_sync_force_plates boolean DEFAULT false,
  allowed_exercise_tags ARRAY,
  org_id uuid,
  CONSTRAINT staff_permissions_pkey PRIMARY KEY (id),
  CONSTRAINT staff_permissions_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.staff_team_assignments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  staff_id uuid,
  team_id uuid,
  assigned_at timestamp with time zone DEFAULT now(),
  assigned_by uuid,
  org_id uuid,
  CONSTRAINT staff_team_assignments_pkey PRIMARY KEY (id),
  CONSTRAINT staff_team_assignments_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.staff(id),
  CONSTRAINT staff_team_assignments_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT staff_team_assignments_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.stripe_webhook_events (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  org_id uuid NOT NULL,
  event_id text NOT NULL UNIQUE,
  event_type text NOT NULL,
  payload jsonb NOT NULL,
  processed boolean DEFAULT false,
  processed_at timestamp with time zone,
  error text,
  retry_count integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT stripe_webhook_events_pkey PRIMARY KEY (id),
  CONSTRAINT stripe_webhook_events_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.subscriptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  stripe_subscription_id text NOT NULL UNIQUE,
  stripe_customer_id text NOT NULL,
  livemode boolean NOT NULL DEFAULT false,
  status text NOT NULL,
  current_period_start timestamp with time zone NOT NULL,
  current_period_end timestamp with time zone NOT NULL,
  billing_cycle_anchor timestamp with time zone NOT NULL,
  cancel_at timestamp with time zone,
  cancel_at_period_end boolean NOT NULL DEFAULT false,
  card_brand text,
  card_last4 text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  addons jsonb,
  CONSTRAINT subscriptions_pkey PRIMARY KEY (id),
  CONSTRAINT subscriptions_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.tag_exercise_recommendations (
  tag_id uuid NOT NULL,
  exercise_id uuid NOT NULL,
  priority integer DEFAULT 0,
  reason text,
  created_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT tag_exercise_recommendations_pkey PRIMARY KEY (tag_id, exercise_id),
  CONSTRAINT tag_exercise_recommendations_tag_id_fkey FOREIGN KEY (tag_id) REFERENCES public.tags(id),
  CONSTRAINT tag_exercise_recommendations_exercise_id_fkey FOREIGN KEY (exercise_id) REFERENCES public.exercises(id)
);
CREATE TABLE public.tags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  description text,
  color text,
  created_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT tags_pkey PRIMARY KEY (id)
);
CREATE TABLE public.teams (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid,
  name text NOT NULL,
  level USER-DEFINED,
  sport USER-DEFINED DEFAULT 'baseball'::sport_type,
  season_year integer,
  head_coach_id uuid,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT teams_pkey PRIMARY KEY (id),
  CONSTRAINT teams_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT teams_head_coach_id_fkey FOREIGN KEY (head_coach_id) REFERENCES public.staff(id)
);
CREATE TABLE public.trackman_pitch_data (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  play_id text NOT NULL DEFAULT ''::text UNIQUE,
  pitch_uid text NOT NULL DEFAULT ''::text,
  rel_speed double precision,
  vert_rel_angle double precision,
  horz_rel_angle double precision,
  spin_rate double precision,
  spin_axis double precision,
  tilt text,
  rel_height double precision,
  rel_side double precision,
  extension double precision,
  spin_axis_3d_longitudinal_angle double precision,
  spin_axis_3d_active_spin_rate double precision,
  spin_axis_3d_spin_efficiency double precision,
  spin_axis_3d_vector_x double precision,
  spin_axis_3d_vector_y double precision,
  spin_axis_3d_vector_z double precision,
  vert_break double precision,
  induced_vert_break double precision,
  horz_break double precision,
  plate_loc_height double precision,
  plate_loc_side double precision,
  zone_speed double precision,
  vert_appr_angle double precision,
  horz_appr_angle double precision,
  zone_time double precision,
  pfxx double precision,
  pfxz double precision,
  a0_x double precision,
  a0_y double precision,
  a0_z double precision,
  v0_x double precision,
  v0_y double precision,
  v0_z double precision,
  x0_x double precision,
  x0_y double precision,
  x0_z double precision,
  eff_velocity double precision,
  athlete_first_name text,
  athlete_last_name text,
  session_id bigint NOT NULL,
  athlete_id uuid,
  org_id uuid NOT NULL,
  tagged_pitch_type text,
  pitch_call text,
  pitch_result text,
  pitch_no integer,
  pitch_session text,
  measured_tilt text,
  track_id uuid,
  source text DEFAULT 'batch'::text,
  received_at timestamp with time zone DEFAULT now(),
  video_url text,
  video_clip_id text,
  video_camera_type text,
  CONSTRAINT trackman_pitch_data_pkey PRIMARY KEY (id),
  CONSTRAINT fk_trackman_pitch_athlete FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT fk_trackman_pitch_org FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.trackman_plays (
  id bigint NOT NULL DEFAULT nextval('trackman_plays_id_seq'::regclass),
  session_id uuid NOT NULL,
  play_id uuid NOT NULL UNIQUE,
  is_warmup boolean DEFAULT false,
  sequence_number integer,
  pitcher_foreign_id text,
  pitcher_name text,
  pitcher_throws text,
  batter_foreign_id text,
  batter_name text,
  batter_handedness text,
  catcher_foreign_id text,
  catcher_name text,
  org_id uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT trackman_plays_pkey PRIMARY KEY (id),
  CONSTRAINT trackman_plays_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.trackman_session (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  session_id text NOT NULL DEFAULT ''::text UNIQUE,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  game_date_utc date,
  session_type text,
  venue_name text,
  athlete_first_name text,
  athlete_last_name text,
  athlete_id text NOT NULL,
  org_id text NOT NULL,
  session_state text,
  started_at_utc timestamp with time zone,
  started_at_local timestamp with time zone,
  ended_at_utc timestamp with time zone,
  ended_at_local timestamp with time zone,
  field_name text,
  CONSTRAINT trackman_session_pkey PRIMARY KEY (id)
);
CREATE TABLE public.trackman_session_players (
  id bigint NOT NULL DEFAULT nextval('trackman_session_players_id_seq'::regclass),
  session_id uuid NOT NULL,
  role text NOT NULL,
  tm_foreign_id text,
  player_name text NOT NULL,
  athlete_id uuid,
  org_id uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT trackman_session_players_pkey PRIMARY KEY (id),
  CONSTRAINT trackman_session_players_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT trackman_session_players_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.trackman_webhook_events (
  id bigint NOT NULL DEFAULT nextval('trackman_webhook_events_id_seq'::regclass),
  event_type text NOT NULL,
  webhook_type text NOT NULL,
  session_id uuid,
  play_id uuid,
  track_id uuid,
  payload jsonb NOT NULL,
  status text DEFAULT 'received'::text,
  error_message text,
  org_id uuid,
  received_at timestamp with time zone DEFAULT now(),
  processed_at timestamp with time zone,
  CONSTRAINT trackman_webhook_events_pkey PRIMARY KEY (id),
  CONSTRAINT trackman_webhook_events_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.trackman_webhook_health (
  id bigint NOT NULL DEFAULT nextval('trackman_webhook_health_id_seq'::regclass),
  metric_name text NOT NULL UNIQUE,
  metric_value text NOT NULL,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT trackman_webhook_health_pkey PRIMARY KEY (id)
);
CREATE TABLE public.training_plans (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  organization_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  start_date date,
  end_date date,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  program_length_weeks integer DEFAULT 4,
  tags ARRAY DEFAULT '{}'::text[],
  created_by uuid,
  org_id uuid,
  CONSTRAINT training_plans_pkey PRIMARY KEY (id),
  CONSTRAINT training_plans_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id),
  CONSTRAINT training_plans_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.vald_profile_queue (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL UNIQUE,
  status text DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'processing'::text, 'completed'::text, 'failed'::text])),
  error_message text,
  retry_count integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  processed_at timestamp with time zone,
  org_id uuid,
  CONSTRAINT vald_profile_queue_pkey PRIMARY KEY (id),
  CONSTRAINT vald_profile_queue_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.waiver_signatures (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  waiver_id uuid NOT NULL,
  waiver_version integer NOT NULL,
  athlete_id uuid NOT NULL,
  signed_by_profile_id uuid NOT NULL,
  signed_by_relationship character varying NOT NULL DEFAULT 'self'::character varying CHECK (signed_by_relationship::text = ANY (ARRAY['self'::character varying, 'parent'::character varying, 'guardian'::character varying, 'other'::character varying]::text[])),
  signature_type character varying NOT NULL CHECK (signature_type::text = ANY (ARRAY['checkbox'::character varying, 'typed_name'::character varying, 'drawn'::character varying]::text[])),
  signature_data jsonb NOT NULL,
  ip_address inet,
  user_agent text,
  signed_at timestamp with time zone NOT NULL DEFAULT now(),
  org_id uuid NOT NULL,
  CONSTRAINT waiver_signatures_pkey PRIMARY KEY (id),
  CONSTRAINT waiver_signatures_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT waiver_signatures_waiver_id_fkey FOREIGN KEY (waiver_id) REFERENCES public.waivers(id),
  CONSTRAINT waiver_signatures_signed_by_profile_id_fkey FOREIGN KEY (signed_by_profile_id) REFERENCES public.profiles(id),
  CONSTRAINT waiver_signatures_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.waivers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  org_id uuid NOT NULL,
  name character varying NOT NULL,
  description text,
  content text NOT NULL,
  version integer NOT NULL DEFAULT 1,
  is_required_on_signup boolean NOT NULL DEFAULT true,
  is_required_on_booking boolean NOT NULL DEFAULT false,
  signature_type character varying NOT NULL DEFAULT 'checkbox'::character varying CHECK (signature_type::text = ANY (ARRAY['checkbox'::character varying, 'typed_name'::character varying, 'drawn'::character varying, 'any'::character varying]::text[])),
  requires_guardian_signature boolean NOT NULL DEFAULT true,
  minor_age_threshold integer NOT NULL DEFAULT 18,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  created_by uuid,
  CONSTRAINT waivers_pkey PRIMARY KEY (id),
  CONSTRAINT waivers_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT waivers_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.workout_instances (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  assignment_id uuid,
  workout_id uuid,
  athlete_id uuid,
  scheduled_date date NOT NULL,
  status USER-DEFINED DEFAULT 'not_started'::completion_status,
  completed_at timestamp with time zone,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  placeholder_resolutions jsonb DEFAULT '{}'::jsonb,
  is_custom_override boolean DEFAULT false,
  source_type text,
  source_id uuid,
  is_synced_with_group boolean DEFAULT true,
  detached_at timestamp with time zone,
  detached_by uuid,
  org_id uuid,
  CONSTRAINT workout_instances_pkey PRIMARY KEY (id),
  CONSTRAINT workout_instances_assignment_id_fkey FOREIGN KEY (assignment_id) REFERENCES public.plan_assignments(id),
  CONSTRAINT workout_instances_workout_id_fkey FOREIGN KEY (workout_id) REFERENCES public.workouts(id),
  CONSTRAINT workout_instances_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT workout_instances_detached_by_fkey FOREIGN KEY (detached_by) REFERENCES auth.users(id)
);
CREATE TABLE public.workout_tags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT workout_tags_pkey PRIMARY KEY (id)
);
CREATE TABLE public.workout_targets (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  workout_instance_id uuid,
  routine_exercise_id uuid,
  set_number integer NOT NULL,
  target_reps integer,
  target_load numeric,
  target_velocity numeric,
  target_distance numeric,
  target_time_seconds integer,
  target_rpe integer,
  created_at timestamp with time zone DEFAULT now(),
  org_id uuid,
  CONSTRAINT workout_targets_pkey PRIMARY KEY (id),
  CONSTRAINT workout_targets_workout_instance_id_fkey FOREIGN KEY (workout_instance_id) REFERENCES public.workout_instances(id),
  CONSTRAINT workout_targets_routine_exercise_id_fkey FOREIGN KEY (routine_exercise_id) REFERENCES public.routine_exercises(id)
);
CREATE TABLE public.workouts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  plan_id uuid,
  name text NOT NULL,
  week_number integer CHECK (week_number > 0),
  day_of_week USER-DEFINED,
  notes text,
  estimated_duration_minutes integer,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  is_template boolean DEFAULT false,
  placeholder_definitions jsonb DEFAULT '{"placeholders": []}'::jsonb,
  tags ARRAY DEFAULT '{}'::text[],
  category USER-DEFINED DEFAULT 'strength_conditioning'::workout_category,
  athlete_id uuid,
  source_workout_id uuid,
  created_by uuid,
  group_id uuid,
  is_active boolean DEFAULT true,
  org_id uuid,
  CONSTRAINT workouts_pkey PRIMARY KEY (id),
  CONSTRAINT workouts_org_id_fkey FOREIGN KEY (org_id) REFERENCES public.organizations(id),
  CONSTRAINT workouts_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.training_plans(id),
  CONSTRAINT workouts_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT workouts_source_workout_id_fkey FOREIGN KEY (source_workout_id) REFERENCES public.workouts(id),
  CONSTRAINT workouts_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.groups(id),
  CONSTRAINT workouts_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);